<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R入門 - 22&nbsp; ggplot2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapter23.html" rel="next">
<link href="./chapter21.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter20.html">Rでのグラフ作成</a></li><li class="breadcrumb-item"><a href="./chapter22.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">ggplot2</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R入門</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">はじめに</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Rプログラミングの基礎</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Rのインストール</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Rを使ってみよう</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">オブジェクトと変数・定数</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">条件判断（Control structures）</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">繰り返し文（Looping）</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">ライブラリ</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">エラー処理（error handler）</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">数値</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">文字列</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">因子（factor）</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">ベクター</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">リスト・データフレーム・行列</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">データの読み込みと書き出し（I/O）</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">データセット</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Rでのデータの取り扱い</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">apply関数群</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">tidyr・dplyr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">日時データの取り扱い</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter18.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">オブジェクト指向とクラス</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter19.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">コーディング規約</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Rでのグラフ作成</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter20.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">グラフ作成：高レベルグラフィック関数</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter21.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">グラフ作成：低レベルグラフィック関数とグラフィックパラメータ</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter22.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter23.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">plotly</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">統計解析の基礎</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter24.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">確率分布と乱数</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">検定</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter26.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">相関と回帰</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter27.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">分類</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter28.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">教師なし学習</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter29.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">時系列分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter30.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">生存時間解析</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">アドバンスな手法</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter31.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">purrr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter32.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">地理空間情報</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter33.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">ネットワーク解析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter34.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">R markdown・Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter35.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Shiny</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">おわりに</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">参考文献</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#aesthetic-mappingaes" id="toc-aesthetic-mappingaes" class="nav-link active" data-scroll-target="#aesthetic-mappingaes"><span class="header-section-number">22.1</span> aesthetic mapping（aes）</a></li>
  <li><a href="#geom関数" id="toc-geom関数" class="nav-link" data-scroll-target="#geom関数"><span class="header-section-number">22.2</span> geom関数</a></li>
  <li><a href="#qplot" id="toc-qplot" class="nav-link" data-scroll-target="#qplot"><span class="header-section-number">22.3</span> qplot</a></li>
  <li><a href="#geom関数群" id="toc-geom関数群" class="nav-link" data-scroll-target="#geom関数群"><span class="header-section-number">22.4</span> geom関数群</a>
  <ul>
  <li><a href="#geom_text" id="toc-geom_text" class="nav-link" data-scroll-target="#geom_text"><span class="header-section-number">22.4.1</span> geom_text</a></li>
  <li><a href="#geom_line" id="toc-geom_line" class="nav-link" data-scroll-target="#geom_line"><span class="header-section-number">22.4.2</span> geom_line</a></li>
  <li><a href="#geom_ribbon" id="toc-geom_ribbon" class="nav-link" data-scroll-target="#geom_ribbon"><span class="header-section-number">22.4.3</span> geom_ribbon</a></li>
  <li><a href="#geom_smooth" id="toc-geom_smooth" class="nav-link" data-scroll-target="#geom_smooth"><span class="header-section-number">22.4.4</span> geom_smooth</a></li>
  <li><a href="#geom_path" id="toc-geom_path" class="nav-link" data-scroll-target="#geom_path"><span class="header-section-number">22.4.5</span> geom_path</a></li>
  <li><a href="#geom_step" id="toc-geom_step" class="nav-link" data-scroll-target="#geom_step"><span class="header-section-number">22.4.6</span> geom_step</a></li>
  <li><a href="#geom_ablinegeom_vlinegeom_hline" id="toc-geom_ablinegeom_vlinegeom_hline" class="nav-link" data-scroll-target="#geom_ablinegeom_vlinegeom_hline"><span class="header-section-number">22.4.7</span> geom_abline、geom_vline、geom_hline</a></li>
  <li><a href="#geom_bar" id="toc-geom_bar" class="nav-link" data-scroll-target="#geom_bar"><span class="header-section-number">22.4.8</span> geom_bar</a></li>
  <li><a href="#geom_histogram" id="toc-geom_histogram" class="nav-link" data-scroll-target="#geom_histogram"><span class="header-section-number">22.4.9</span> geom_histogram</a></li>
  <li><a href="#statの設定" id="toc-statの設定" class="nav-link" data-scroll-target="#statの設定"><span class="header-section-number">22.4.10</span> statの設定</a></li>
  <li><a href="#geom_col" id="toc-geom_col" class="nav-link" data-scroll-target="#geom_col"><span class="header-section-number">22.4.11</span> geom_col</a></li>
  <li><a href="#積み上げ式棒グラフ" id="toc-積み上げ式棒グラフ" class="nav-link" data-scroll-target="#積み上げ式棒グラフ"><span class="header-section-number">22.4.12</span> 積み上げ式棒グラフ</a></li>
  <li><a href="#geom_dotplot" id="toc-geom_dotplot" class="nav-link" data-scroll-target="#geom_dotplot"><span class="header-section-number">22.4.13</span> geom_dotplot</a></li>
  <li><a href="#geom_density" id="toc-geom_density" class="nav-link" data-scroll-target="#geom_density"><span class="header-section-number">22.4.14</span> geom_density</a></li>
  <li><a href="#geom_freqpoly" id="toc-geom_freqpoly" class="nav-link" data-scroll-target="#geom_freqpoly"><span class="header-section-number">22.4.15</span> geom_freqpoly</a></li>
  <li><a href="#geom_jitter" id="toc-geom_jitter" class="nav-link" data-scroll-target="#geom_jitter"><span class="header-section-number">22.4.16</span> geom_jitter</a></li>
  <li><a href="#geom_boxplot" id="toc-geom_boxplot" class="nav-link" data-scroll-target="#geom_boxplot"><span class="header-section-number">22.4.17</span> geom_boxplot</a></li>
  <li><a href="#geom_violin" id="toc-geom_violin" class="nav-link" data-scroll-target="#geom_violin"><span class="header-section-number">22.4.18</span> geom_violin</a></li>
  <li><a href="#エラーバーの描画geom_errorbargeom_linerangegeom_pointrange" id="toc-エラーバーの描画geom_errorbargeom_linerangegeom_pointrange" class="nav-link" data-scroll-target="#エラーバーの描画geom_errorbargeom_linerangegeom_pointrange"><span class="header-section-number">22.4.19</span> エラーバーの描画：geom_errorbar、geom_linerange、geom_pointrange</a>
  <ul class="collapse">
  <li><a href="#positiondodgeとエラーバーの位置" id="toc-positiondodgeとエラーバーの位置" class="nav-link" data-scroll-target="#positiondodgeとエラーバーの位置"><span class="header-section-number">22.4.19.1</span> position=“dodge”とエラーバーの位置</a></li>
  </ul></li>
  <li><a href="#geom_bin2d" id="toc-geom_bin2d" class="nav-link" data-scroll-target="#geom_bin2d"><span class="header-section-number">22.4.20</span> geom_bin2d</a></li>
  <li><a href="#geom_contour" id="toc-geom_contour" class="nav-link" data-scroll-target="#geom_contour"><span class="header-section-number">22.4.21</span> geom_contour</a></li>
  <li><a href="#geom_map" id="toc-geom_map" class="nav-link" data-scroll-target="#geom_map"><span class="header-section-number">22.4.22</span> geom_map</a></li>
  <li><a href="#geom_sf" id="toc-geom_sf" class="nav-link" data-scroll-target="#geom_sf"><span class="header-section-number">22.4.23</span> geom_sf</a></li>
  <li><a href="#geom_polygon" id="toc-geom_polygon" class="nav-link" data-scroll-target="#geom_polygon"><span class="header-section-number">22.4.24</span> geom_polygon</a></li>
  </ul></li>
  <li><a href="#色の設定" id="toc-色の設定" class="nav-link" data-scroll-target="#色の設定"><span class="header-section-number">22.5</span> 色の設定</a>
  <ul>
  <li><a href="#color-brewer" id="toc-color-brewer" class="nav-link" data-scroll-target="#color-brewer"><span class="header-section-number">22.5.1</span> color brewer</a></li>
  </ul></li>
  <li><a href="#点のサイズ" id="toc-点のサイズ" class="nav-link" data-scroll-target="#点のサイズ"><span class="header-section-number">22.6</span> 点のサイズ</a></li>
  <li><a href="#点の透明化" id="toc-点の透明化" class="nav-link" data-scroll-target="#点の透明化"><span class="header-section-number">22.7</span> 点の透明化</a></li>
  <li><a href="#線の太さとタイプ" id="toc-線の太さとタイプ" class="nav-link" data-scroll-target="#線の太さとタイプ"><span class="header-section-number">22.8</span> 線の太さとタイプ</a></li>
  <li><a href="#グラフの重ね書き" id="toc-グラフの重ね書き" class="nav-link" data-scroll-target="#グラフの重ね書き"><span class="header-section-number">22.9</span> グラフの重ね書き</a></li>
  <li><a href="#複数のグラフの表示facetting" id="toc-複数のグラフの表示facetting" class="nav-link" data-scroll-target="#複数のグラフの表示facetting"><span class="header-section-number">22.10</span> 複数のグラフの表示：facetting</a>
  <ul>
  <li><a href="#facet_wrap" id="toc-facet_wrap" class="nav-link" data-scroll-target="#facet_wrap"><span class="header-section-number">22.10.1</span> facet_wrap</a>
  <ul class="collapse">
  <li><a href="#scalesの指定" id="toc-scalesの指定" class="nav-link" data-scroll-target="#scalesの指定"><span class="header-section-number">22.10.1.1</span> scalesの指定</a></li>
  </ul></li>
  <li><a href="#facet_grid" id="toc-facet_grid" class="nav-link" data-scroll-target="#facet_grid"><span class="header-section-number">22.10.2</span> facet_grid</a></li>
  </ul></li>
  <li><a href="#軸のラベルの調整labs" id="toc-軸のラベルの調整labs" class="nav-link" data-scroll-target="#軸のラベルの調整labs"><span class="header-section-number">22.11</span> 軸のラベルの調整：labs</a></li>
  <li><a href="#軸スケールの変換対数化など" id="toc-軸スケールの変換対数化など" class="nav-link" data-scroll-target="#軸スケールの変換対数化など"><span class="header-section-number">22.12</span> 軸スケールの変換（対数化など）</a></li>
  <li><a href="#グラフの並び順の変更" id="toc-グラフの並び順の変更" class="nav-link" data-scroll-target="#グラフの並び順の変更"><span class="header-section-number">22.13</span> グラフの並び順の変更</a></li>
  <li><a href="#円グラフの作成" id="toc-円グラフの作成" class="nav-link" data-scroll-target="#円グラフの作成"><span class="header-section-number">22.14</span> 円グラフの作成</a></li>
  <li><a href="#theme" id="toc-theme" class="nav-link" data-scroll-target="#theme"><span class="header-section-number">22.15</span> theme</a></li>
  <li><a href="#グラフの保存ggsave" id="toc-グラフの保存ggsave" class="nav-link" data-scroll-target="#グラフの保存ggsave"><span class="header-section-number">22.16</span> グラフの保存：ggsave</a></li>
  <li><a href="#extensions" id="toc-extensions" class="nav-link" data-scroll-target="#extensions"><span class="header-section-number">22.17</span> Extensions</a>
  <ul>
  <li><a href="#patchwork" id="toc-patchwork" class="nav-link" data-scroll-target="#patchwork"><span class="header-section-number">22.17.1</span> patchwork</a></li>
  <li><a href="#gganimate" id="toc-gganimate" class="nav-link" data-scroll-target="#gganimate"><span class="header-section-number">22.17.2</span> gganimate</a></li>
  <li><a href="#ggally" id="toc-ggally" class="nav-link" data-scroll-target="#ggally"><span class="header-section-number">22.17.3</span> GGally</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter20.html">Rでのグラフ作成</a></li><li class="breadcrumb-item"><a href="./chapter22.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">ggplot2</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">ggplot2</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>現在のRでは、デフォルトのグラフ作成関数はデータの確認に用いられていることが多く、プレゼンテーションや論文など、人に見せるためのきれいなグラフを作成する場合には、ほとんどの場合<strong><code>ggplot2</code></strong>が用いられています。<code>ggplot2</code>を用いると、美しいグラフを統一感のある記法で簡単に描画することができます。</p>
<p><code>ggplot2</code>には、その使い方についてのみ書かれた教科書が多数出ているぐらいに沢山の関数・引数が設定されています。この章での解説は<code>ggplot2</code>の紹介に留めますが、興味のある方は<a href="https://ggplot2.tidyverse.org/reference/">リファレンス</a>や<a href="https://rstudio.github.io/cheatsheets/data-visualization.pdf">チートシート</a>、教科書（<a href="https://ggplot2-book.org/index.html">ggplot2: Elegant Graphics for Data Analysis</a>、<a href="https://www.maruzen-publishing.co.jp/item/?book_no=294192">ggplot2: Elegant Graphics for Data Analysis 日本語版</a>、<a href="https://r-graphics.org/">R graphic cookbook</a>、<a href="https://www.oreilly.co.jp/books/9784873118925/">R graphic cookbook 日本語版</a>など）を読むことをお勧めします。</p>
<p><code>ggplot2</code>は<code>tidyverse</code>に含まれるライブラリの一つですので、<code>tidyverse</code>を呼び出すことで使用することができます。他の<code>tidyverese</code>の機能である、<code>dplyr</code>や<code>tidyr</code>、パイプ演算子などとも相性が良く、これらを<code>ggplot2</code>と同時に用いるのが一般的です。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>ライブラリの読み出し</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><code>ggplot2</code>では、まず<code>ggplot</code>関数にデータフレームを引数として与えます。<code>ggplot2</code>では、<strong>データはほぼ常にデータフレームで与える</strong>必要があります。<code>ggplot</code>関数はデータの設定のための関数で、データフレームを引数にして<code>ggplot</code>関数だけを実行しても、空白が表示されるだけです。<code>ggplot</code>関数は第一引数にデータフレームを取るため、パイプ演算子を用いてデータフレームを<code>ggplot</code>関数につなぐのが一般的です。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>ggplot関数のみを用いる</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot関数だけでは何も表示されない</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> iris <span class="sc">|&gt;</span> <span class="fu">ggplot</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="chapter22_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<section id="aesthetic-mappingaes" class="level2" data-number="22.1">
<h2 data-number="22.1" class="anchored" data-anchor-id="aesthetic-mappingaes"><span class="header-section-number">22.1</span> aesthetic mapping（aes）</h2>
<p><code>ggplot</code>関数は、引数に<code>aes</code>関数を取ります。この<code>aes</code>は<strong>aesthetic（エステティック）mapping</strong>の略です。この「エステティック」というのは、美容のエステと同じ言葉で、「美的な」という意味を持ちます。<code>ggplot2</code>では、<code>aes</code>関数内でグラフのx軸、y軸の値などの要素、色や点のサイズ等を指定します。この指定には、<code>ggplot</code>関数の引数であるデータフレームの列名を文字列ではなく、そのまま使用することができます。</p>
<p>下の例では、データフレームである<code>iris</code>の列から、<code>Sepal.Length</code>を<code>x</code>に、<code>Sepal.Width</code>を<code>y</code>に設定したものです。<code>aes</code>関数を引数にして<code>ggplot</code>関数を実行すると、点や線などのグラフの要素は表示されませんが、縦と横の軸だけは表示されます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>aesでグラフの要素を指定</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 軸だけが表記される</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-3-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="chapter22_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom関数" class="level2" data-number="22.2">
<h2 data-number="22.2" class="anchored" data-anchor-id="geom関数"><span class="header-section-number">22.2</span> geom関数</h2>
<p><code>ggplot2</code>でグラフを表示するためには、グラフの種類を指定する関数である、<strong><code>geom</code>関数</strong>を用いる必要があります。例えば、散布図を描画するための<code>geom</code>関数は、<code>geom_point</code>関数です。この<code>geom</code>関数の中でも、データフレームや<code>aes</code>を設定することができます。ただし、この<code>geom</code>関数だけでは、グラフを表示することはできません。先程説明した、<code>ggplot</code>関数と組み合わせる必要があります。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># geom関数だけではグラフを記述できない</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>mapping: x = ~Sepal.Length, y = ~Sepal.Width 
geom_point: na.rm = FALSE
stat_identity: na.rm = FALSE
position_identity </code></pre>
</div>
</div>
<p><code>geom</code>関数は、<code>ggplot</code>関数に<code>+</code>でつなぐ必要があります。まず、データフレームを引数にした<code>ggplot</code>関数を準備し、その関数に足し算で<code>geom_point</code>関数をつなぎ、<code>ggplot</code>関数内もしくは<code>geom_point</code>関数内で<code>aes</code>を設定すると、グラフが表示されます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>ggplot関数とgeom関数を+でつなぐ</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># geom関数内でaesを設定する</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-5-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="chapter22_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>ggplot関数内でaesを指定する</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot関数内でaesを設定する（上と同じ）</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-6-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="chapter22_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ggplot2の+記号
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p><code>ggplot2</code>では、<code>ggplot</code>関数と<code>geom</code>関数をつなぐために、<code>+</code>の記号を用います。この<code>+</code>はジェネリック関数として設定されており、<code>ggplot2</code>内では足し算とは異なる機能を持ちます。詳しくは<a href="https://ggplot2.tidyverse.org/reference/gg-add.html">ggplot2のリファレンス</a>をご一読ください。</p>
</div>
</div>
</div>
<p>以下の表1に、代表的な<code>geom</code>関数の一覧を示します。</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>表1：代表的なgeom関数</caption>
<colgroup>
<col style="width: 16%">
<col style="width: 41%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">geom関数</th>
<th style="text-align: left;">グラフの種類</th>
<th style="text-align: left;">aesで必須となる引数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">geom_point</td>
<td style="text-align: left;">散布図</td>
<td style="text-align: left;">x, y</td>
</tr>
<tr class="even">
<td style="text-align: left;">geom_text</td>
<td style="text-align: left;">文字の散布図</td>
<td style="text-align: left;">x, y, label</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geom_line</td>
<td style="text-align: left;">線グラフ（x軸の小さいものからつなぐ）</td>
<td style="text-align: left;">x, y</td>
</tr>
<tr class="even">
<td style="text-align: left;">geom_ribbon</td>
<td style="text-align: left;">リボン</td>
<td style="text-align: left;">xmax, xmin, ymax, ymin（xかyのどちらか）</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geom_path</td>
<td style="text-align: left;">線グラフ（データフレームの行順につなぐ）</td>
<td style="text-align: left;">x, y</td>
</tr>
<tr class="even">
<td style="text-align: left;">geom_step</td>
<td style="text-align: left;">ステップ関数</td>
<td style="text-align: left;">x, y</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geom_abline</td>
<td style="text-align: left;">直線（傾きと切片で指定）</td>
<td style="text-align: left;">intercept, slope</td>
</tr>
<tr class="even">
<td style="text-align: left;">geom_hline</td>
<td style="text-align: left;">水平線（横線）</td>
<td style="text-align: left;">yintercept</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geom_vline</td>
<td style="text-align: left;">垂直の線（縦線）</td>
<td style="text-align: left;">xintercept</td>
</tr>
<tr class="even">
<td style="text-align: left;">geom_bar</td>
<td style="text-align: left;">棒グラフ</td>
<td style="text-align: left;">x, y</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geom_dotplot</td>
<td style="text-align: left;">ドットプロット</td>
<td style="text-align: left;">x, y（片方のみ）</td>
</tr>
<tr class="even">
<td style="text-align: left;">geom_function</td>
<td style="text-align: left;">関数を線形で表記</td>
<td style="text-align: left;">fun</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geom_boxplot</td>
<td style="text-align: left;">箱ひげ図</td>
<td style="text-align: left;">x, y（片方でも可）</td>
</tr>
<tr class="even">
<td style="text-align: left;">geom_histogram</td>
<td style="text-align: left;">ヒストグラム</td>
<td style="text-align: left;">x, y（片方のみ）</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geom_density</td>
<td style="text-align: left;">確率密度</td>
<td style="text-align: left;">x, y（片方のみ）</td>
</tr>
<tr class="even">
<td style="text-align: left;">geom_jitter</td>
<td style="text-align: left;">ジッタープロット</td>
<td style="text-align: left;">x, y（片方でも可）</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geom_violin</td>
<td style="text-align: left;">バイオリンプロット</td>
<td style="text-align: left;">x, y（片方でも可）</td>
</tr>
<tr class="even">
<td style="text-align: left;">geom_errorbar</td>
<td style="text-align: left;">エラーバー</td>
<td style="text-align: left;">xmax, xmin, ymax, ymin</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geom_linerange</td>
<td style="text-align: left;">エラーバー（横棒無し）</td>
<td style="text-align: left;">xmax, xmin, ymax, ymin</td>
</tr>
<tr class="even">
<td style="text-align: left;">geom_pointrange</td>
<td style="text-align: left;">フォレストプロット（点と線）</td>
<td style="text-align: left;">x, y, xmax, xmin, ymax, ymin</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geom_bin_2d</td>
<td style="text-align: left;">ヒートマップ</td>
<td style="text-align: left;">x. y</td>
</tr>
<tr class="even">
<td style="text-align: left;">geom_contour</td>
<td style="text-align: left;">等高線</td>
<td style="text-align: left;">x, y</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geom_map</td>
<td style="text-align: left;">地図表記</td>
<td style="text-align: left;">map_id</td>
</tr>
<tr class="even">
<td style="text-align: left;">geom_polygon</td>
<td style="text-align: left;">多角形</td>
<td style="text-align: left;">x, y</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="qplot" class="level2" data-number="22.3">
<h2 data-number="22.3" class="anchored" data-anchor-id="qplot"><span class="header-section-number">22.3</span> qplot</h2>
<p><code>ggplot2</code>には、<code>qplot</code>という関数も準備されています。<code>qplot</code>関数は「Quick plot」の略で、<code>plot</code>関数のように1つの関数だけでグラフの作成が完了します。ただし、この<code>qplot</code>関数で凝ったグラフを作成することは難しいため、現在ではその使用は非推奨とされています。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>qplot関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 上と同じグラフをqplotで描画</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(Sepal.Length, Sepal.Width, <span class="at">data =</span> iris, <span class="at">geom=</span><span class="st">"point"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `qplot()` was deprecated in ggplot2 3.4.0.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-8-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="chapter22_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom関数群" class="level2" data-number="22.4">
<h2 data-number="22.4" class="anchored" data-anchor-id="geom関数群"><span class="header-section-number">22.4</span> geom関数群</h2>
<p>表1に示した通り、<code>geom</code>関数には<code>geom_point</code>以外にもたくさんの関数が設定されています。以下に各<code>geom</code>関数を用いて作成できるグラフを紹介します。</p>
<section id="geom_text" class="level3" data-number="22.4.1">
<h3 data-number="22.4.1" class="anchored" data-anchor-id="geom_text"><span class="header-section-number">22.4.1</span> geom_text</h3>
<p><code>geom_text</code>は、テキストをグラフ上に表示するための関数です。<code>geom_text</code>は<code>aes</code>に<code>x</code>、<code>y</code>、<code>label</code>の3つの引数を設定し、その<code>x</code>、<code>y</code>の位置に<code>label</code>で指定した文字列を表示します。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_text関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">label =</span> Species)) <span class="sc">+</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-9-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="chapter22_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_line" class="level3" data-number="22.4.2">
<h3 data-number="22.4.2" class="anchored" data-anchor-id="geom_line"><span class="header-section-number">22.4.2</span> geom_line</h3>
<p><code>geom_line</code>は<code>aes</code>の<code>x</code>、<code>y</code>に設定した点を結ぶ線、つまり線グラフを描画するための関数です。<code>geom_line</code>では、線は必ずxの小さい値から大きい値へと点を繋いでいく形で線が描画されます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_line関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>economics <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pop, <span class="at">y =</span> pce)) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-10-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="chapter22_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_ribbon" class="level3" data-number="22.4.3">
<h3 data-number="22.4.3" class="anchored" data-anchor-id="geom_ribbon"><span class="header-section-number">22.4.3</span> geom_ribbon</h3>
<p><code>geom_ribbon</code>は、幅のあるグラフ（リボン）を描画するための関数です。<code>geom_ribbon</code>は<code>x</code>、<code>ymin</code>、<code>ymax</code>の3つの引数を取り、<code>x</code>で指定した位置に<code>ymin</code>－<code>ymax</code>の間を幅とするリボンを描画します。引数として、<code>y</code>、<code>xmin</code>、<code>xmax</code>の3つを取ることもできます。<code>ymin</code>、<code>ymax</code>を指定した場合にはリボンは横向き、<code>xmin</code>、<code>xmax</code>を指定した場合にはリボンは縦向きになります。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_ribbon関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">time</span>(Nile) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(), </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Nile100 =</span> Nile <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(), </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Nile90 =</span> Nile <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>() <span class="sc">*</span> <span class="fl">0.9</span> , </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Nile110 =</span> Nile <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>() <span class="sc">*</span> <span class="fl">1.1</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">ymax =</span> Nile110, <span class="at">ymin =</span> Nile90)) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="chapter22_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_smooth" class="level3" data-number="22.4.4">
<h3 data-number="22.4.4" class="anchored" data-anchor-id="geom_smooth"><span class="header-section-number">22.4.4</span> geom_smooth</h3>
<p><code>geom_smooth</code>は<code>geom_point</code>等で表示した点に対して、回帰の式をあてはめ、そのグラフを表示するための関数です。特に引数を指定していない場合、<a href="./chapter26.html">26章</a>で説明するloess回帰をあてはめ、回帰を行った線を表示します。また、95%信頼区間を<code>geom_ribbon</code>と同様の表記で示します。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_smooth関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-12-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="chapter22_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>直線での回帰を行う場合には、引数に<code>method="lm"</code>を指定します。また、<code>se</code>引数を<code>FALSE</code>に指定すると、信頼区間の表示を消すことができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_smoothで直線回帰</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-13-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="chapter22_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>データフレームの因子の列に従ってグラフを分けて回帰したい場合には、<code>aes</code>関数内で<code>group</code>引数にその因子を設定します。以下の例では<code>iris</code>の<code>Species</code>を<code>group</code>引数に設定し、アヤメの種ごとに回帰を行っています。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>group引数を設定する</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">group =</span> Species)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="chapter22_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><code>aes</code>に<code>color</code>や<code>fill</code>を設定することでも因子ごとに回帰を行うことができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>color引数やfill引数を設定する</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> Species, <span class="at">fill =</span> Species)) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-15-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="chapter22_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_path" class="level3" data-number="22.4.5">
<h3 data-number="22.4.5" class="anchored" data-anchor-id="geom_path"><span class="header-section-number">22.4.5</span> geom_path</h3>
<p><code>geom_path</code>は、xの大きさに関わらず、データフレームの上の行から線をつなぐ関数です。データフレームを時系列に並べておき、2変数の時間変化を追うような場合に利用します。</p>
<p><code>geom_path</code>を用いる場合には、一色の線では線のどちらの端が上の行で、どちらが下の行かわからないため、通常は行の順番にそって線の色を変えることになります。色を指定したい場合には、<code>aes</code>の引数に<code>color</code>を設定します。<code>color</code>には、データフレームの列のうち、日時などを設定します。このように設定することで、日時と共に線の色が変わるようなグラフを作成することができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_path関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>economics <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> uempmed, <span class="at">y =</span> pce, <span class="at">color =</span> date)) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-16-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="chapter22_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_step" class="level3" data-number="22.4.6">
<h3 data-number="22.4.6" class="anchored" data-anchor-id="geom_step"><span class="header-section-number">22.4.6</span> geom_step</h3>
<p>Rの<code>step</code>関数を用いた場合と同様のグラフを記述する場合には、<code>geom_step</code>関数を用います。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_step関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">150</span>, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_step</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-17-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="chapter22_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_ablinegeom_vlinegeom_hline" class="level3" data-number="22.4.7">
<h3 data-number="22.4.7" class="anchored" data-anchor-id="geom_ablinegeom_vlinegeom_hline"><span class="header-section-number">22.4.7</span> geom_abline、geom_vline、geom_hline</h3>
<p>グラフ上に直線を描く場合には、<code>geom_abline</code>、<code>geom_vline</code>、<code>geom_hline</code>を用います。<code>geom_abline</code>は切片（<code>intercept</code>）と傾き（<code>slope</code>）を指定し、その切片・傾きを持つ直線を引くものです。<code>geom_vline</code>は垂直な線（vertical line）、<code>geom_hline</code>は水平な線（horizontal line）を描画します。<code>geom_vline</code>はx軸と交わるため、x軸の切片（<code>xintercept</code>）の設定が必要です。同様に<code>geom_hline</code>はy軸と交わるため、y軸の切片（<code>yintercept</code>）を設定します。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_abline関数など</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">10</span>, <span class="at">slope =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-18-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="chapter22_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_bar" class="level3" data-number="22.4.8">
<h3 data-number="22.4.8" class="anchored" data-anchor-id="geom_bar"><span class="header-section-number">22.4.8</span> geom_bar</h3>
<p><code>geom_bar</code>は、棒グラフを作成するための関数です。<code>geom_bar</code>を引数なしで実行すると、ヒストグラムが描画されます。これは、<code>geom_bar</code>の引数のうち、<code>stat</code>引数が<code>"count"</code>に設定されているためです。この<code>stat</code>引数は、グラフを記述する際に実施する統計的な処理を指定するための引数です。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_bar関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="co"># ヒストグラムを表示（stat="count"）</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-19-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="chapter22_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_histogram" class="level3" data-number="22.4.9">
<h3 data-number="22.4.9" class="anchored" data-anchor-id="geom_histogram"><span class="header-section-number">22.4.9</span> geom_histogram</h3>
<p><code>ggplot2</code>には、ヒストグラムを描画するための専用の関数である、<code>geom_histogram</code>もあります。ヒストグラムを描くのが目的であれば、こちらの<code>geom_histogram</code>の方が名前と目的が一致しており、使いやすいかと思います。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_histogram関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-20-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="chapter22_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="statの設定" class="level3" data-number="22.4.10">
<h3 data-number="22.4.10" class="anchored" data-anchor-id="statの設定"><span class="header-section-number">22.4.10</span> statの設定</h3>
<p><code>geom_bar</code>関数で1つの値に対して1つの棒グラフを描画する、要は通常の棒グラフを描画する場合には、<code>stat="identity"</code>を指定します。棒グラフを描画するときには、まずx軸とy軸の数値・ラベルを含むデータフレームを作成します。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>tidyrd、dplyrでデータフレームの前準備</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> iris <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Species) <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mSepal.Length =</span> <span class="fu">mean</span>(Sepal.Length), </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sSepal.Length =</span> <span class="fu">sd</span>(Sepal.Length))</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  Species    mSepal.Length sSepal.Length
  &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;
1 setosa              5.01         0.352
2 versicolor          5.94         0.516
3 virginica           6.59         0.636</code></pre>
</div>
</div>
<p>後は、<code>aes</code>でx軸に配置する値、y軸に配置する値を指定し、<code>geom_bar</code>関数内で<code>stat="identity”</code>を指定します。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>stat="identity"を指定</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> mSepal.Length)) <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-22-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="chapter22_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_col" class="level3" data-number="22.4.11">
<h3 data-number="22.4.11" class="anchored" data-anchor-id="geom_col"><span class="header-section-number">22.4.11</span> geom_col</h3>
<p><code>ggplot2</code>には、直接棒グラフ（column plot）を描画するための専用の関数である、<code>geom_col</code>もあります。名前から直感的に理解できるなら、こちらを用いてもよいでしょう。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_col関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> mSepal.Length)) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-23-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="chapter22_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="積み上げ式棒グラフ" class="level3" data-number="22.4.12">
<h3 data-number="22.4.12" class="anchored" data-anchor-id="積み上げ式棒グラフ"><span class="header-section-number">22.4.12</span> 積み上げ式棒グラフ</h3>
<p><code>geom_bar</code>関数は積み上げ式棒グラフを作成する際にも用いることができます。積み上げ式棒グラフを描画するときには、特に引数を指定する必要はありませんが、色分けをしないと積み上げたグラフを見分けることができません。積み上げ式グラフを記述するときには、<code>color</code>とともに、棒の中身の色を設定する<code>fill</code>という引数で、色を指定するのが良いでしょう。</p>
<p><code>geom_bar</code>で積み上げ式グラフが記述されるのは、<code>geom_bar</code>の<code>position</code>引数のデフォルトが<code>position="stack"</code>だからです。<code>position="dodge"</code>を指定すると、横並びにしたグラフが表示されます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_bar関数で積み上げ式棒グラフ</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">"1"</span>, <span class="at">y =</span> mSepal.Length, <span class="at">color =</span> Species, <span class="at">fill =</span> Species)) <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-24-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="chapter22_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>position="dodge"で横並びの棒グラフ</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">"1"</span>, <span class="at">y =</span> mSepal.Length, <span class="at">color =</span> Species, <span class="at">fill =</span> Species)) <span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-25-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="chapter22_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_dotplot" class="level3" data-number="22.4.13">
<h3 data-number="22.4.13" class="anchored" data-anchor-id="geom_dotplot"><span class="header-section-number">22.4.13</span> geom_dotplot</h3>
<p><code>geom_dotplot</code>はドットプロットという、ヒストグラムを点で描いたようなグラフを作成するときに用いる関数です。ドットの数がその値の範囲に存在する値の個数を示します。縦軸の単位がよくわからないものになりますので、通常はヒストグラムの方が使い勝手が良いでしょう。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_dotplot関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dotplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Bin width defaults to 1/30 of the range of the data. Pick better value with
`binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-26-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="chapter22_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_density" class="level3" data-number="22.4.14">
<h3 data-number="22.4.14" class="anchored" data-anchor-id="geom_density"><span class="header-section-number">22.4.14</span> geom_density</h3>
<p><code>geom_density</code>はヒストグラムと類似していますが、単に度数を返すのではなく、カーネル密度関数に変換した上で度数分布を示してくれる関数です。<code>geom_density</code>では、縦軸の値は確率密度となり、実際のデータが少ない部分にも実際の頻度より高めの確率密度が与えられるため、かなりデータが多い場合以外は正確性に欠くことになります。データが少ない場合にはヒストグラムの方が使い勝手が良いでしょう。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_density関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-27-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="chapter22_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_freqpoly" class="level3" data-number="22.4.15">
<h3 data-number="22.4.15" class="anchored" data-anchor-id="geom_freqpoly"><span class="header-section-number">22.4.15</span> geom_freqpoly</h3>
<p>ヒストグラムを棒グラフではなく、線で表記するのが<code>geom_freqpoly</code>です。こちらもヒストグラムほど使い勝手は良くないように思います。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_freqpoly関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-28-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img src="chapter22_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_jitter" class="level3" data-number="22.4.16">
<h3 data-number="22.4.16" class="anchored" data-anchor-id="geom_jitter"><span class="header-section-number">22.4.16</span> geom_jitter</h3>
<p>データの分布は単に散布図でも表示できます。ただし、<code>geom_point</code>で単に表記すると、点が重なってしまって正しいデータ分布を示すことはできません。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_point関数で点が重なる場合</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># geom_pointでは点が重なる</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-29-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img src="chapter22_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>このような場合に、点の重なりを抑えるため、データの表示にランダムな幅を持たせるのが<code>geom_jitter</code>です。<code>x</code>か<code>y</code>のどちらかのみが数値の場合には、数値以外の値には幅を持たせず、両方が数値の場合にはx軸・y軸方向に幅を持たせることになります。ですので、<code>x</code>、<code>y</code>の両方が数値の場合には、点は正確な位置には配置されません。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_jitter関数で点をバラつかせる</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-30-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26"><img src="chapter22_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_boxplot" class="level3" data-number="22.4.17">
<h3 data-number="22.4.17" class="anchored" data-anchor-id="geom_boxplot"><span class="header-section-number">22.4.17</span> geom_boxplot</h3>
<p>データが十分に多い場合には、箱ひげ図を用いてデータの分布を表示することもできます。<code>ggplot2</code>では、<code>geom_boxplot</code>を用いて箱ひげ図を描画することができます。<code>geom_boxplot</code>に数値ベクターを与えれば、自動的に箱ひげ図を描画してくれます。また、<code>lower</code>、<code>upper</code>、<code>middle</code>、 <code>min</code>、<code>max</code>という引数を与えると、その引数に設定した数値に従い箱ひげ図を描画することもできます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_boxplot関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-31-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27"><img src="chapter22_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_violin" class="level3" data-number="22.4.18">
<h3 data-number="22.4.18" class="anchored" data-anchor-id="geom_violin"><span class="header-section-number">22.4.18</span> geom_violin</h3>
<p>確率密度を90度回転させ、左右対称に配置した形のグラフのことを、<strong>バイオリンプロット</strong>と呼びます。<code>ggplot2</code>では、このバイオリンプロットを<code>geom_violin</code>で描画することができます。描画の仕組みは<code>geom_density</code>によく似ています。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_violin関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-32-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28"><img src="chapter22_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="エラーバーの描画geom_errorbargeom_linerangegeom_pointrange" class="level3" data-number="22.4.19">
<h3 data-number="22.4.19" class="anchored" data-anchor-id="エラーバーの描画geom_errorbargeom_linerangegeom_pointrange"><span class="header-section-number">22.4.19</span> エラーバーの描画：geom_errorbar、geom_linerange、geom_pointrange</h3>
<p><code>ggplot2</code>で結果にエラーバーを付ける時には、<code>geom_errorbar</code>を用います。<code>geom_errorbar</code>では、<code>aes</code>の引数として、<code>ymin</code>と<code>ymax</code>、もしくは<code>xmin</code>と<code>xmax</code>を設定します。<code>ymin</code>と<code>ymax</code>はy軸方向の、<code>xmin</code>と<code>xmax</code>はx軸方向のエラーバーを設定する際に用います。また、<code>geom_errorbar</code>には<code>width</code>という引数もあり、エラーバーの横棒のサイズを設定することができます。</p>
<p><code>geom_errorbar</code>は通常、<code>geom_point</code>で描画した点グラフや、<code>geom_bar</code>で描画した棒グラフに重ねて表示することで用います。重ね書きする際には、<code>ggplot</code>に<code>+</code>で<code>geom_point</code>をつないだ後に、さらに<code>+</code>で<code>geom_errorbar</code>をつなぐことになります。このように<code>+</code>でつなぐと、<code>ggplot2</code>では<code>geom_point</code>の点グラフの上に、<code>geom_errorbar</code>が重ね描きされます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>エラーバーを表示する</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Species, </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> mSepal.Length, </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymax =</span> mSepal.Length <span class="sc">+</span> sSepal.Length,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymin =</span> mSepal.Length <span class="sc">-</span> sSepal.Length))</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_errorbar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-33-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29"><img src="chapter22_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><code>geom_errorbar</code>ではエラーバーに横線が付き、よく見るエラーバーの形となります。ただし、この横線は必ずしも必要なものではありません。横線のないエラーバーを付けたいときには、<code>geom_linerange</code>を用います。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_linerange関数でエラーバーをつける</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_linerange</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-34-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30"><img src="chapter22_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><code>geom_errorbar</code>や<code>geom_linerange</code>は点が備わっておらず、別途<code>geom_point</code>で点を書く必要があります。この点と線を同時に描画するのが、<code>geom_pointrange</code>です。<code>geom_pointrange</code>を用いると、<code>geom_point</code>を別途描画しなくても、点とエラーバーが付いたグラフを作成することができます。このような、点と線のみで記述するグラフのことを<strong>フォレストプロット</strong>と呼び、<a href="https://ja.wikipedia.org/wiki/%E3%83%A1%E3%82%BF%E3%82%A2%E3%83%8A%E3%83%AA%E3%82%B7%E3%82%B9">メタ解析</a>などでよく用いられています。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_pointrange関数でフォレストプロット</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_pointrange</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-35-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31"><img src="chapter22_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>棒グラフにもエラーバーを付けることはできます。棒グラフにエラーバーを付ける時には、<code>stat="identity"</code>で指定した<code>geom_bar</code>に、<code>+</code>で<code>geom_errorbar</code>や<code>geom_linerange</code>をつなげます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>棒グラフにエラーバーをつける</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-36-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-32"><img src="chapter22_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<section id="positiondodgeとエラーバーの位置" class="level4" data-number="22.4.19.1">
<h4 data-number="22.4.19.1" class="anchored" data-anchor-id="positiondodgeとエラーバーの位置"><span class="header-section-number">22.4.19.1</span> position=“dodge”とエラーバーの位置</h4>
<p>複数のタイプのデータに対して棒グラフを横に並べて描画し、その棒グラフにエラーバーを付けたい、という場合もあります。<code>geom_bar</code>のデフォルトは<code>position="stack"</code>ですので、複数のタイプのデータを表示するときには積み上げ式の棒グラフが描画されます。横に棒グラフを並べる場合には、<code>position="dodge"</code>を指定する必要があります。</p>
<p>では、具体的に<code>position="dodge"</code>の棒グラフにエラーバーを付与する手順を見ていきましょう。まずは、データフレームでデータを準備する必要があります。<code>dplyr</code>や<code>tidyr</code>を用いることで、データの準備を比較的簡単に行うことができます。</p>
<p>下の例では、<code>iris</code>の<code>Species</code>以外のデータ（<code>Sepal.Length</code>、<code>Sepal.Width</code>、<code>Petal.Length</code>、<code>Petal.Width</code>）を<code>pivot_longer</code>を用いて縦持ちに変換し、データ名と<code>Species</code>でグループ化した後、それぞれの平均値と標準偏差を求めています。棒グラフやフォレストプロットの描画の準備では、<code>pivot_longer</code>、<code>group_by</code>、<code>summarise</code>を用いることが多く、データの要約を求める際にも便利な組み合わせです。</p>
<p>具体的にどのように変換しているのか分かりにくければ、<code>pivot_longer</code>までと、それ以降を切り離して実行してみると良いでしょう。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>要約したデータの準備</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  iris <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name, Species) <span class="sc">|&gt;</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mvalue =</span> <span class="fu">mean</span>(value), <span class="at">svalue =</span> <span class="fu">sd</span>(value))</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>d1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
# Groups:   name [4]
   name         Species    mvalue svalue
   &lt;chr&gt;        &lt;fct&gt;       &lt;dbl&gt;  &lt;dbl&gt;
 1 Petal.Length setosa      1.46   0.174
 2 Petal.Length versicolor  4.26   0.470
 3 Petal.Length virginica   5.55   0.552
 4 Petal.Width  setosa      0.246  0.105
 5 Petal.Width  versicolor  1.33   0.198
 6 Petal.Width  virginica   2.03   0.275
 7 Sepal.Length setosa      5.01   0.352
 8 Sepal.Length versicolor  5.94   0.516
 9 Sepal.Length virginica   6.59   0.636
10 Sepal.Width  setosa      3.43   0.379
11 Sepal.Width  versicolor  2.77   0.314
12 Sepal.Width  virginica   2.97   0.322</code></pre>
</div>
</div>
<p>上で作成したデータフレームを用いて、<code>ggplot2</code>でグラフを描画します。まずは<code>ggplot</code>関数で<code>aes</code>を設定していきます。<code>x</code>軸に<code>Species</code>、<code>y</code>軸に平均値とエラーバーの要素に平均値±標準偏差（<code>ymin</code>、<code>ymax</code>）、棒の枠の色（<code>color</code>）と棒の中身の色（<code>fill</code>）にデータ名を設定しておきます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>ggplot関数の準備</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> d1 <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Species, </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">y  =</span>mvalue, </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymax =</span> mvalue <span class="sc">+</span> svalue, </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymin =</span> mvalue <span class="sc">-</span> svalue,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> name,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> name</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>この<code>ggplot</code>関数に、<code>geom_bar</code>と<code>geom_linerange</code>を<code>+</code>でつなげると、下の図のように、積み上げ式棒グラフの下の方にエラーバーが重なって表示される、変なグラフが作成されます。これは、<code>geom_bar</code>の引数の設定が<code>position="stack"</code>であるため積み上げ式棒グラフとなる一方で、<code>geom_linerange</code>などのエラーバーを指定する<code>geom</code>関数には積み上げ式の設定がないためです。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>positionを指定しない場合</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># positionを指定しないと、積み上げ式棒グラフになる</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-39-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-33"><img src="chapter22_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><code>position</code>に<code>"dodge"</code>を指定すると、棒グラフは積み上げ式ではなく、横に並べる形となります。このとき、エラーバーは棒グラフの真ん中に配置されてしまい、どの棒グラフのエラーバーなのかわからなくなります。これは、<code>geom_linerange</code>の<code>position</code>の設定が正しく行われていないためです。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>positionをdodgeに指定した場合</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position=</span><span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-40-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34"><img src="chapter22_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><code>geom_linerange</code>を含む、エラーバーを描画するための<code>geom</code>関数の<code>position</code>の指定には、<code>position_dodge</code>関数を用います。<code>position=position_dodge(width=0.9)</code>という形で<code>geom_linerange</code>の<code>position</code>を指定すると、エラーバーが正しい位置（棒グラフの真ん中）に配置されます。やや複雑ですし、<code>width=0.9</code>の意味はよくわからないのですが、この方法は<code>ggplot2</code>の<a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">Reference</a>にも記載されています。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>position_dodge(width=0.9)を指定</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-41-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35"><img src="chapter22_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
棒グラフとエラーバー
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>上記のように、棒グラフとエラーバーの色を同じにすると、エラーバーの下側が見えなくなります。このようなグラフ（ダイナマイトっぽい形をしているので、ダイナマイトプロットと呼ばれます）では、エラーバーで示したい範囲が不明瞭となるため、データ表示の方法としては良くないとされています。点と線で表すフォレストプロット（<code>geom_pointrange</code>）を用いたほうが、棒グラフとエラーバーを用いるより、データの表示方法としては優れています。</p>
</div>
</div>
</div>
</section>
</section>
<section id="geom_bin2d" class="level3" data-number="22.4.20">
<h3 data-number="22.4.20" class="anchored" data-anchor-id="geom_bin2d"><span class="header-section-number">22.4.20</span> geom_bin2d</h3>
<p><code>geom_bin2d</code>は<code>x</code>軸、<code>y</code>軸に値を設定し、<code>x</code>・<code>y</code>それぞれの値のデータを度数分布に変換した上で、度数を2次元グラフ上に色で示すものです。2次元で表示するヒストグラムにあたります。ただし、下の図のようにデータが多く、分布が薄く広がっている場合には度数の差が分かりにくくなってしまいます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_bin2dで二次元ヒストグラム</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>price)) <span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bin2d</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-42-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-36"><img src="chapter22_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>このようなデータで度数を調べる場合には、<code>geom_point</code>と透明化を指定する引数である<code>alpha</code>を用いるのが良いでしょう。<code>alpha</code>を小さい値に指定すると、度数の多いところは濃い色で、度数が小さいところは薄い色で表示されます。下のグラフは上の<code>geom_bin2d</code>と同じものを表現していますが、こちらの方がデータの分布としては理解しやすいことがわかるかと思います。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>alphaで半透明化</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">|&gt;</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>carat, <span class="at">y=</span>price)) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.004</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-43-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-37"><img src="chapter22_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>棒グラフと同様に、<code>geom_bin2d</code>も<code>stat="identity"</code>と指定することで、数値をそのまま色とするグラフを作成することができます。下の例では、<code>volcano</code>データセット（マウンガファウの南北・東西の位置と標高のデータ）を変形し、<code>geom_bin2d</code>で描画したものです。このように<code>stat="identity"</code>を用いれば、<code>geom_bin2d</code>を用いてヒートマップを作成することもできます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_bin2dでヒートマップを描画</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>volcano <span class="sc">|&gt;</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(volcano)) <span class="sc">|&gt;</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(volcano), <span class="at">values_to =</span> <span class="st">"altitude"</span>, <span class="at">names_to =</span> <span class="st">"x"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove_all</span>(x, <span class="st">"V"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(x), <span class="at">y =</span> y, <span class="at">color =</span> altitude, <span class="at">fill =</span> altitude)) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bin2d</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-44-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-38"><img src="chapter22_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_contour" class="level3" data-number="22.4.21">
<h3 data-number="22.4.21" class="anchored" data-anchor-id="geom_contour"><span class="header-section-number">22.4.21</span> geom_contour</h3>
<p><code>geom_contour</code>はRの<code>contour</code>関数と同じく、標高線で示された図を表記するのに用いる関数です。<code>geom_bin2d</code>とは異なり、<code>aes</code>には3つの値（<code>x</code>、<code>y</code>、<code>z</code>）を指定する必要があります。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_contourで等高線グラフを作成</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>volcano <span class="sc">|&gt;</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(volcano)) <span class="sc">|&gt;</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(volcano), <span class="at">values_to =</span> <span class="st">"altitude"</span>, <span class="at">names_to =</span> <span class="st">"x"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove_all</span>(x, <span class="st">"V"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(x), <span class="at">y =</span> y, <span class="at">z =</span> altitude)) <span class="sc">+</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_contour</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-45-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-39"><img src="chapter22_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Rデフォルトの<code>filled.contour</code>関数と同様に、等高線に色を合わせて表示するようなグラフを作成する場合には、<code>geom_contour_filled</code>を用います。<code>geom_contour_filled</code>を用いることで、<code>z</code>の値に従い色分けされたグラフを描画することができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_contour_filledで色付き等高線グラフを作成</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>volcano <span class="sc">|&gt;</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(volcano)) <span class="sc">|&gt;</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(volcano), <span class="at">values_to =</span> <span class="st">"altitude"</span>, <span class="at">names_to =</span> <span class="st">"x"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove_all</span>(x, <span class="st">"V"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(x), <span class="at">y =</span> y, <span class="at">z =</span> altitude)) <span class="sc">+</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_contour_filled</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-46-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-40"><img src="chapter22_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_map" class="level3" data-number="22.4.22">
<h3 data-number="22.4.22" class="anchored" data-anchor-id="geom_map"><span class="header-section-number">22.4.22</span> geom_map</h3>
<p><code>geom_map</code>は地図を表示するための関数です。地図を表記するためには、地図データ、つまり緯度、経度とその場所のIDを記録したもの、を準備する必要があります。</p>
<p>Rで地図データを用いる場合には、<code>maps</code>パッケージ<span class="citation" data-cites="maps_bib">(<a href="references.html#ref-maps_bib" role="doc-biblioref">Richard A. Becker, Ray Brownrigg. Enhancements by Thomas P Minka, and CRAN team. 2023</a>)</span>を利用するのが比較的簡単です。<code>maps</code>パッケージには世界地図、アメリカの州の地図、フランスやイタリア、ニュージーランドなどの地図が登録されています。<code>maps</code>パッケージの地図を<code>ggplot2</code>で用いる場合には、<code>ggplot2</code>で使用できるデータフレームに変換してくれる<code>maps</code>パッケージの関数である、<code>map_data</code>を用います。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>mapパッケージで地図データの読み込み</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(maps)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"state"</span>) <span class="co"># アメリカの州データをggplot用に変換</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(state) <span class="co"># 緯度（lat）、経度（long）などを含むデータフレーム</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       long      lat group order  region subregion
1 -87.46201 30.38968     1     1 alabama      &lt;NA&gt;
2 -87.48493 30.37249     1     2 alabama      &lt;NA&gt;
3 -87.52503 30.37249     1     3 alabama      &lt;NA&gt;
4 -87.53076 30.33239     1     4 alabama      &lt;NA&gt;
5 -87.57087 30.32665     1     5 alabama      &lt;NA&gt;
6 -87.58806 30.32665     1     6 alabama      &lt;NA&gt;</code></pre>
</div>
</div>
<p><code>ggplot2</code>では、<code>map_data</code>で変換したデータフレームを<code>ggplot</code>関数の引数にするのではなく、<code>map_data</code>で<code>region</code>に指定されているラベル（地域）を含むデータフレームを用います。</p>
<p><code>USArrests</code>はアメリカの州別の10万人あたりの犯罪件数を記録したデータフレームです。このデータフレームの行名が州名になっているので、これをデータフレームの列に追加し、<code>state</code>と表記を合わせるために小文字に変換します。</p>
<p><code>aes</code>では、<code>map_id=state</code>とし、地図IDを指定します。さらに、<code>fill</code>には<code>USArrests</code>の列名である<code>Murder</code>（殺人の件数）を指定します。この形で指定することで、<code>Murder</code>の値が色で示されることになります。</p>
<p><code>geom_map</code>では、さらに<code>map</code>という引数に、<code>map_data</code>の返り値（<code>state</code>）を指定する必要があります。こうすることで、<code>geom_map</code>は<code>state</code>を基準に地図を描画し、地図の色に<code>fill</code>で指定した<code>Murder</code>の値を適用します。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_map関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># coord_sfを用いるためにsfパッケージをロードする</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>USArrests <span class="sc">|&gt;</span> </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">tolower</span>(<span class="fu">rownames</span>(USArrests))) <span class="sc">|&gt;</span> </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">map_id =</span> state, <span class="at">fill =</span> Murder)) <span class="sc">+</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_map</span>(<span class="at">map =</span> state) <span class="sc">+</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">crs =</span> <span class="dv">5070</span>, <span class="at">default_crs =</span> <span class="dv">4326</span>,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>, <span class="sc">-</span><span class="dv">70</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">52</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-48-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-41"><img src="chapter22_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_sf" class="level3" data-number="22.4.23">
<h3 data-number="22.4.23" class="anchored" data-anchor-id="geom_sf"><span class="header-section-number">22.4.23</span> geom_sf</h3>
<p>上記のようにすれば、地図を表記することはできますが、やや煩雑です。近年のRでは、地図データを扱う際には、地図データ取り扱いの専用クラスである<strong><code>sf</code>（simple features）</strong>を用いるのが一般的になっています。この<code>sf</code>を用いれば、グラフをより簡単に作成することができます。</p>
<p><code>sf</code>クラスは、<code>sf</code>パッケージ<span class="citation" data-cites="sf_bib1 sf_bib2">(<a href="references.html#ref-sf_bib1" role="doc-biblioref">Pebesma and Bivand 2023</a>; <a href="references.html#ref-sf_bib2" role="doc-biblioref">Pebesma 2018</a>)</span>で定義されているクラスです。<code>sf</code>を使用する際には、まず<code>sf</code>パッケージを読み込みます。</p>
<p><code>sf</code>パッケージをインストールすると、<code>sf</code>パッケージ内にある地図データにアクセスできます。下の例では、<code>sf</code>パッケージのフォルダ内にある地図データ（North Carolinaのsfデータ）を読み込んでいます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>sfパッケージのデータを読み込み</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># system.fileはパッケージからフルパスを読み込む関数</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>fname <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"shape/nc.shp"</span>, <span class="at">package=</span><span class="st">"sf"</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>nc <span class="ot">&lt;-</span> <span class="fu">st_read</span>(fname) <span class="co"># North Carolinaのsfデータ</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `nc' from data source 
  `C:\Program Files\R\R-4.4.0\library\sf\shape\nc.shp' using driver `ESRI Shapefile'
Simple feature collection with 100 features and 14 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965
Geodetic CRS:  NAD27</code></pre>
</div>
</div>
<p><code>sf</code>は基本的にデータフレームで、<code>geometry</code>という列を持っています。この列は、<code>sfc</code>クラスのデータです。<code>sfc</code>クラスはその行に対応する緯度・経度のセットを専用の表記法で示したものとなります。<code>sf</code>を用いる場合には、この<code>geometry</code>が地図データを表現する列になります。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>sfのデータ</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(nc) <span class="co"># sfはデータフレームの一種</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>nc <span class="co"># geometryという列に地図データが格納されている</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 100 features and 14 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965
Geodetic CRS:  NAD27
First 10 features:
    AREA PERIMETER CNTY_ CNTY_ID        NAME  FIPS FIPSNO CRESS_ID BIR74 SID74
1  0.114     1.442  1825    1825        Ashe 37009  37009        5  1091     1
2  0.061     1.231  1827    1827   Alleghany 37005  37005        3   487     0
3  0.143     1.630  1828    1828       Surry 37171  37171       86  3188     5
4  0.070     2.968  1831    1831   Currituck 37053  37053       27   508     1
5  0.153     2.206  1832    1832 Northampton 37131  37131       66  1421     9
6  0.097     1.670  1833    1833    Hertford 37091  37091       46  1452     7
7  0.062     1.547  1834    1834      Camden 37029  37029       15   286     0
8  0.091     1.284  1835    1835       Gates 37073  37073       37   420     0
9  0.118     1.421  1836    1836      Warren 37185  37185       93   968     4
10 0.124     1.428  1837    1837      Stokes 37169  37169       85  1612     1
   NWBIR74 BIR79 SID79 NWBIR79                       geometry
1       10  1364     0      19 MULTIPOLYGON (((-81.47276 3...
2       10   542     3      12 MULTIPOLYGON (((-81.23989 3...
3      208  3616     6     260 MULTIPOLYGON (((-80.45634 3...
4      123   830     2     145 MULTIPOLYGON (((-76.00897 3...
5     1066  1606     3    1197 MULTIPOLYGON (((-77.21767 3...
6      954  1838     5    1237 MULTIPOLYGON (((-76.74506 3...
7      115   350     2     139 MULTIPOLYGON (((-76.00897 3...
8      254   594     2     371 MULTIPOLYGON (((-76.56251 3...
9      748  1190     2     844 MULTIPOLYGON (((-78.30876 3...
10     160  2038     5     176 MULTIPOLYGON (((-80.02567 3...</code></pre>
</div>
</div>
<p><code>ggplot2</code>で<code>sf</code>を用いてグラフを描画する場合には、<code>geom_sf</code>関数を用います。<code>geom_sf</code>関数を用いてグラフを作成する場合には、<code>ggplot</code>関数の引数となるデータフレームに<code>sf</code>、<code>aes</code>に<code>sf</code>に含まれる列を指定します。<code>sf</code>を用いれば、このようなシンプルな表記法で<code>geom_map</code>よりも簡単に地図を表記することができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_sf関数でsfデータを描画</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sfを用いたグラフの表記</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>nc <span class="sc">|&gt;</span> </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> AREA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-51-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-42"><img src="chapter22_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rでの地図描画ライブラリ
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>sf</code>は2018年に発表された、比較的新しいパッケージです。<code>sf</code>が出てくるまでは、Rで地図データを取り扱う方法は様々で、統一されているという感はありませんでしたが、今後は<code>sf</code>がデフォルトの地図データ取り扱い方法になっていくのではないかと思います。地図データの取扱いに関してはオンラインの英語の教科書（<a href="https://bookdown.org/robinlovelace/geocompr/">Geocomputation with R</a>）があり、日本語訳（<a href="http://124.219.182.167/geo/">Geocomputation with R (日本語版)</a>）も公開されています。</p>
<p>地図表示のためのライブラリには<code>ggplot2</code>だけでなく、<a href="https://rstudio.github.io/leaflet/">Leaflet for R</a>というJavascriptの地図ライブラリをRで利用できるようにしたものや、<code>ggplot2</code>風の記法で色々なデザインのグラフを描画できる<a href="https://r-tmap.github.io/tmap/">tmap</a>などもあります。<code>sf</code>、<code>leaflet</code>、<code>tmap</code>については<a href="./chapter32.html">32章</a>で説明します。</p>
</div>
</div>
</div>
</section>
<section id="geom_polygon" class="level3" data-number="22.4.24">
<h3 data-number="22.4.24" class="anchored" data-anchor-id="geom_polygon"><span class="header-section-number">22.4.24</span> geom_polygon</h3>
<p><code>geom_polygon</code>は多角形を描画するための関数です。データフレームには、多角形の各頂点に当たるxとyの座標を指定します。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_polygon関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 頂点のx、y座標を指定する</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.25</span>, <span class="fl">1.75</span>, <span class="dv">2</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>d2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     x y
1 1.00 1
2 1.25 2
3 1.75 2
4 2.00 1</code></pre>
</div>
</div>
<p><code>aes</code>で頂点の<code>x</code>、<code>y</code>座標を指定すると、多角形を描画することができます。低レベルグラフィック関数である<code>polygon</code>関数と類似した描画の方法になっています。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_polygonで多角形を描画</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">|&gt;</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-53-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-43"><img src="chapter22_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="色の設定" class="level2" data-number="22.5">
<h2 data-number="22.5" class="anchored" data-anchor-id="色の設定"><span class="header-section-number">22.5</span> 色の設定</h2>
<p>上で説明したように、<code>ggplot2</code>で色を指定するときには、<code>aes</code>中で<code>color</code>、<code>fill</code>の引数を指定します。<code>color</code>、<code>fill</code>は数値または因子を指定することができ、点や面を数値・因子に対応した色で表示することができます。</p>
<p><code>geom_point</code>などの点を描画する場合では、<code>color</code>のみを指定します。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>colorに因子を指定</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-54-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-44"><img src="chapter22_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><code>color</code>引数に数値を指定すると、数値に従い色の濃度が変わります。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>colorに数値を指定</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> Petal.Length)) <span class="sc">+</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-55-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-45"><img src="chapter22_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><code>geom_bar</code>では、<code>color</code>だけを指定すると、棒グラフの枠だけに色がつきます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_barでcolorだけを指定した場合</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="sc">|&gt;</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> mvalue, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-56-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-46"><img src="chapter22_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><code>geom_bar</code>で、棒グラフの中身の色を変えたい時には、<code>fill</code>引数を指定する必要があります。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_barでfillを指定した場合</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="sc">|&gt;</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> mvalue, <span class="at">color =</span> name, <span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-57-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-47"><img src="chapter22_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<section id="color-brewer" class="level3" data-number="22.5.1">
<h3 data-number="22.5.1" class="anchored" data-anchor-id="color-brewer"><span class="header-section-number">22.5.1</span> color brewer</h3>
<p><code>ggplot2</code>では、<code>color</code>や<code>fill</code>に引数を指定すれば、特に色の指定をしなくても、いい感じの色でグラフを作成してくれます。ただし、デフォルトの色では見にくい時や、デザイン的に別の色を用いたい場合もあります。色を別途指定したい場合には、<a href="https://colorbrewer2.org/#type=sequential&amp;scheme=BuGn&amp;n=3">ColorBrewer</a>を用いた色の設定を行います。</p>
<p><code>ggplot2</code>でColorBrewerに従った色を用いる場合には、<code>scale_color_brewer</code>を用います。通常の<code>geom</code>関数と同様に、<code>scale_color_brewer</code>も<code>+</code>で繋いで用います。同様に、<code>fill</code>に指定した色の配色を変えたい場合には、<code>scale_fill_brewer</code>を用います。</p>
<p>色の指定には<code>palette</code>引数を用います。<code>palette</code>引数には、カラーパレットを指定する文字列を指定します。カラーパレットの種類はヘルプ（<code>?scale_color_brewer</code>）から確認できます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>scale_color_brewerで色を変更</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-58-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-48"><img src="chapter22_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><code>color</code>に数値を指定した場合には、<code>scale_color_distiller</code>で色を指定します。<code>fill</code>に数値を指定する場合には、<code>scale_fill_distiller</code>を用います。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>scale_color_distillerで色を変更</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> Petal.Length)) <span class="sc">+</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"RdYlBu"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-59-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-49"><img src="chapter22_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="点のサイズ" class="level2" data-number="22.6">
<h2 data-number="22.6" class="anchored" data-anchor-id="点のサイズ"><span class="header-section-number">22.6</span> 点のサイズ</h2>
<p><code>geom_point</code>などで点のサイズを変更する場合には、<code>size</code>引数を指定します。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>sizeで点のサイズを指定</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-60-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-50"><img src="chapter22_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><code>size</code>引数は<code>aes</code>内で、数値の列名を取る形でも宣言できます。<code>aes</code>内で数値で指定した場合には、その数値に応じた点のサイズで表示されます。このように点のサイズを列名で指定することで、3つの要素（<code>x</code>、<code>y</code>、<code>size</code>）を3次元グラフを用いることなく表現することができます。このようなグラフのことを<strong>バブルチャート</strong>と呼びます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>sizeに数値を指定する</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> Species, <span class="at">size =</span> Petal.Length)) <span class="sc">+</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-61-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-51"><img src="chapter22_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="点の透明化" class="level2" data-number="22.7">
<h2 data-number="22.7" class="anchored" data-anchor-id="点の透明化"><span class="header-section-number">22.7</span> 点の透明化</h2>
<p>点が大きくなると、重なった点は見えなくなります。重なった点を表示する方法には、ジッタープロット（<code>geom_jitter</code>）などがありますが、x軸もy軸も数値の場合には、位置がランダムに変化することで正確な値を示さなくなります。</p>
<p>重なった点を適切に表示する場合、<strong>透明化</strong>が有効となる場合があります。上で説明した通り、透明化を指定する引数は<code>alpha</code>です。<code>alpha</code>には0～1までの値を指定することができ、0では完全に透明、1では完全に不透明の点を表示することになります。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>geom_point中でalphaを指定</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-62-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-52"><img src="chapter22_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="線の太さとタイプ" class="level2" data-number="22.8">
<h2 data-number="22.8" class="anchored" data-anchor-id="線の太さとタイプ"><span class="header-section-number">22.8</span> 線の太さとタイプ</h2>
<p><code>geom_line</code>等の線グラフで線の太さを指定する場合には<code>linewidth</code>引数を、線のタイプを指定する場合には、<code>linetype</code>引数を用います。<code>linewidth</code>引数には太さを数値で指定します。<code>linetype</code>には、<code>"solid"</code>、<code>"dashed"</code>、<code>"dotted"</code>、<code>"dotdash"</code>、<code>"longdash"</code>、<code>"twodash"</code>の各タイプがあり、それぞれ文字列で指定します。線タイプの詳細については、<code>vignette("ggplot2-specs")</code>を実行することで確認できます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>線の太さとタイプの指定</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-63-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-53"><img src="chapter22_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="グラフの重ね書き" class="level2" data-number="22.9">
<h2 data-number="22.9" class="anchored" data-anchor-id="グラフの重ね書き"><span class="header-section-number">22.9</span> グラフの重ね書き</h2>
<p>グラフの重ね書きを行う場合には、複数の<code>geom</code>関数を<code>+</code>で繋ぎます。後に指定した<code>geom</code>関数が重ね書きの上層（上のレイヤー）に表示されることになります。重ね書きしたグラフの色が下層のグラフの色と同一だと見えなくなってしまうため、通常は色を変えて表示します。</p>
<p>重ね書きするグラフの間でデータが異なる場合には、<code>ggplot</code>関数でデータフレーム・<code>aes</code>を設定せず、<code>geom</code>関数内でそれぞれ<code>data</code>・<code>aes</code>を指定します。<code>data</code>にはデータフレームを指定します。<code>geom</code>関数内で別の<code>data</code>を指定することで、それぞれの<code>geom</code>関数のグラフに別のデータフレームからのデータを用いることもできます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>boxplotとjitterplotを重ね書き</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> Species), <span class="at">width =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-64-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-54"><img src="chapter22_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="複数のグラフの表示facetting" class="level2" data-number="22.10">
<h2 data-number="22.10" class="anchored" data-anchor-id="複数のグラフの表示facetting"><span class="header-section-number">22.10</span> 複数のグラフの表示：facetting</h2>
<p>データフレームに異なる要素（因子）のデータが保存されており、要素ごとに別々にグラフにしたい場合には、facetting（facet：宝石のカットの面のこと）を用います。facettingには、<code>facet_wrap</code>と<code>facet_grid</code>の2つの関数ががあります。<code>facet_wrap</code>はデータフレームの要素で分けたグラフを単に並べたもの、<code>facet_grid</code>はx、y方向に要素がそろったグラフ群を作成する関数です。</p>
<section id="facet_wrap" class="level3" data-number="22.10.1">
<h3 data-number="22.10.1" class="anchored" data-anchor-id="facet_wrap"><span class="header-section-number">22.10.1</span> facet_wrap</h3>
<p>以下は<code>facet_wrap</code>の例です。グラフを分ける要素は、<code>facet_wrap</code>内でチルダ（<code>~</code>）を用いて指定します。チルダの左側、右側のどちらに要素をおいても問題ありませんが、右側の要素を入力しない場合には、ピリオド（<code>.</code>）を入力しておきます。グラフはよい感じに縦・横に並べられ、表示されます。並べる順番は要素の因子（factor）のレベル順となります。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>facet_wrap関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="sc">|&gt;</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> mvalue)) <span class="sc">+</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-65-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-55"><img src="chapter22_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<section id="scalesの指定" class="level4" data-number="22.10.1.1">
<h4 data-number="22.10.1.1" class="anchored" data-anchor-id="scalesの指定"><span class="header-section-number">22.10.1.1</span> scalesの指定</h4>
<p><code>facet_wrap</code>を用いたときに、表示するグラフごとに縦軸のスケールを調整する場合には、<code>scales</code>引数を指定します。<code>scales</code>引数は<code>facet_wrap</code>関数内で指定し、<code>scales="free_y"</code>ならy方向のスケールが、<code>scales="free_x"</code>ならx方向のスケールが、<code>scales="free"</code>ならx、y両方のスケールが自動的に調整されます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>facet_wrapでscalesを指定</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scalesを指定すると、y軸のスケールがグラフごとに自動調整される</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>d1 <span class="sc">|&gt;</span> </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> mvalue)) <span class="sc">+</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">"free_y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-66-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-56"><img src="chapter22_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="facet_grid" class="level3" data-number="22.10.2">
<h3 data-number="22.10.2" class="anchored" data-anchor-id="facet_grid"><span class="header-section-number">22.10.2</span> facet_grid</h3>
<p><code>facet_grid</code>では、チルダの左と右の要素でそれぞれy軸方向、x軸方向を指定することになります。縦－横方向の軸の値もそろえられます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>facet_grid関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="sc">|&gt;</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> mvalue)) <span class="sc">+</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Species <span class="sc">~</span> name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-67-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-57"><img src="chapter22_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="軸のラベルの調整labs" class="level2" data-number="22.11">
<h2 data-number="22.11" class="anchored" data-anchor-id="軸のラベルの調整labs"><span class="header-section-number">22.11</span> 軸のラベルの調整：labs</h2>
<p>軸のラベルやタイトル等を設定する場合には、<code>labs</code>関数を用います。<code>labs</code>関数も<code>+</code>で繋いで用います。<code>x</code>、<code>y</code>、<code>title</code>、<code>subtitle</code>、<code>caption</code>引数を指定することでそれぞれx軸ラベル、y軸ラベル、メインタイトル、サブタイトル、キャプション（注釈）をグラフに追加することができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>labsでラベルの編集</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"length"</span>, </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"count"</span>, </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"main title"</span>, </span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"sub title"</span>, </span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"caption"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-68-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-58"><img src="chapter22_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="軸スケールの変換対数化など" class="level2" data-number="22.12">
<h2 data-number="22.12" class="anchored" data-anchor-id="軸スケールの変換対数化など"><span class="header-section-number">22.12</span> 軸スケールの変換（対数化など）</h2>
<p>x軸、y軸の数値を対数変換する場合には、<code>scale_x_log10</code>、<code>scale_y_log10</code>を用います。他の<code>ggplot2</code>の関数と同様に、<code>scale_x_log10</code>、<code>scale_y_log10</code>も<code>+</code>で繋ぐことで、x軸、y軸が対数変換されます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>軸スケールの変換</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">|&gt;</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> price)) <span class="sc">+</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-69-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-59"><img src="chapter22_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>同様の軸の変換の関数には、<code>scale_x_reverse</code>、<code>scale_x_sqrt</code>などがあります。それぞれ軸を正負反転、平方根に変換するのに用います。</p>
</section>
<section id="グラフの並び順の変更" class="level2" data-number="22.13">
<h2 data-number="22.13" class="anchored" data-anchor-id="グラフの並び順の変更"><span class="header-section-number">22.13</span> グラフの並び順の変更</h2>
<p>x軸に因子を指定した場合の棒グラフなどの並び順は、その因子のレベルの順番で決まります。ですので、<code>forcat</code>パッケージの<code>fct_reorder</code>を用いて並べ替えることができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>fct_reorderで順番を変更する</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(Species, <span class="fu">c</span>(<span class="st">"virginica"</span>, <span class="st">"setosa"</span>, <span class="st">"versicolor"</span>)), <span class="at">y =</span> mSepal.Length)) <span class="sc">+</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-70-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-60"><img src="chapter22_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><code>fct_reorder</code>関数は他の数値を参照して、その数値の順番で並べ替えることもできます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>fct_reorderで数値に従い並べ替え</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(Species, mSepal.Length, <span class="at">.desc=</span><span class="cn">TRUE</span>), <span class="at">y =</span> mSepal.Length)) <span class="sc">+</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-71-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-61"><img src="chapter22_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>同様の数値による順番の変更は、<code>reorder</code>関数を用いても行うことができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>reorder関数で並べ替え</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Species, mSepal.Length, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), <span class="at">y =</span> mSepal.Length)) <span class="sc">+</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-72-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-62"><img src="chapter22_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="円グラフの作成" class="level2" data-number="22.14">
<h2 data-number="22.14" class="anchored" data-anchor-id="円グラフの作成"><span class="header-section-number">22.14</span> 円グラフの作成</h2>
<p><code>ggplot2</code>で円グラフを作成する場合には、<code>coord_polar</code>を用います。<code>coord_polar</code>は軸を円形に配置する関数で、棒グラフを描画し、<code>coord_polar</code>の引数に<code>theta="y"</code>を指定すると、円グラフが描画されます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>coord_polarで円グラフの指定</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">"1"</span>, <span class="at">y =</span> mSepal.Length, <span class="at">color =</span> Species, <span class="at">fill=</span>Species)) <span class="sc">+</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-73-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-63"><img src="chapter22_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>棒を複数描画するような場合には、中心からいくつかの層に分かれて円グラフが描画されます。<code>position="fill"</code>を指定すると、棒グラフの高さがそろい、値は割合に変化するため、異なる要素間での比較を示すことができます。ただし、<code>pie</code>関数のhelpに記載されている通り、円グラフではデータの比較が難しくなります。基本的に円グラフを用いない方が良いでしょう。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>coord_polarでは見にくい場合</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position=</span><span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-74-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-64"><img src="chapter22_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="theme" class="level2" data-number="22.15">
<h2 data-number="22.15" class="anchored" data-anchor-id="theme"><span class="header-section-number">22.15</span> theme</h2>
<p><code>theme</code>は、グラフのもっと細かな要素を調整するための関数です。<code>theme</code>には非常に多くの引数が設定されており、<code>theme</code>を用いることで軸ラベルなどのフォントサイズや色、回転、凡例の位置等を調整することができます。代表的な例として、<code>theme</code>関数の<code>legend.position</code>引数を用いて、凡例をグラフの下に表示した場合を下に示します。凡例を消す場合には、<code>legend.position="none"</code>を指定します。<code>theme</code>の引数には関数を取るものあり、設定はやや複雑ですが、うまく指定すれば様々なグラフの要素を調整することができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>themeの指定</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span> </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-75-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-65"><img src="chapter22_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p><code>theme</code>には、グラフのデザインを丸ごと変えることができる関数が別途用意されています。例えば、<code>theme_bw</code>ででは背景が白いグラフ、<code>theme_light</code>ででは明るめ、<code>theme_dark</code>では暗めの背景を用いたグラフを作成できます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>theme_bw関数で背景を白にする</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span> </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-76-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-66"><img src="chapter22_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="グラフの保存ggsave" class="level2" data-number="22.16">
<h2 data-number="22.16" class="anchored" data-anchor-id="グラフの保存ggsave"><span class="header-section-number">22.16</span> グラフの保存：ggsave</h2>
<p><code>ggplot2</code>のグラフを保存する時には、<code>ggsave</code>関数を用います。<code>ggsave</code>関数は第一引数にファイル名、第二引数に<code>ggplot2</code>のプロットのオブジェクトを取ります。ファイルの形式はファイル名の拡張子に従い決定します。例えば、ファイル名が「.pdf」で終わっていればPDF、「.jpg」で終わっていればJPEGでグラフが保存されます。</p>
<p>グラフのサイズは<code>width</code>、<code>height</code>引数で、解像度は<code>dpi</code>で指定します。<code>limitsize=FALSE</code>と指定することで、縦横が50インチ以上の非常に大きいグラフを保存することもできます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>ggsave関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># プロットのオブジェクトをpに代入</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  iris <span class="sc">|&gt;</span> </span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="co"># pをpdfで保存</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plot_iris_Sepal.pdf"</span>, p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="extensions" class="level2" data-number="22.17">
<h2 data-number="22.17" class="anchored" data-anchor-id="extensions"><span class="header-section-number">22.17</span> Extensions</h2>
<p><code>ggplot2</code>には、<code>ggplot2</code>に機能を追加する<a href="https://exts.ggplot2.tidyverse.org/gallery/">Extensions</a>というライブラリがたくさん存在します。代表的なExtensionsを以下に紹介します。</p>
<section id="patchwork" class="level3" data-number="22.17.1">
<h3 data-number="22.17.1" class="anchored" data-anchor-id="patchwork"><span class="header-section-number">22.17.1</span> patchwork</h3>
<p>まずは、複数のグラフを1つのデバイスにまとめて表示する<code>patchwork</code><span class="citation" data-cites="patchwork_bib">(<a href="references.html#ref-patchwork_bib" role="doc-biblioref">Pedersen 2023</a>)</span>です。<code>patchwork</code>を用いれば、位置・幅等を簡単に調整しながら、2つ以上のグラフをまとめることができます。</p>
<p><code>patchwork</code>を用いる時には、まず<code>ggplot2</code>のオブジェクトを変数に代入しておくとよいでしょう。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>ggplot2オブジェクトを変数に代入</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(patchwork)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> iris <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> iris <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Petal.Length)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> iris <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Petal.Width)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> iris <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Petal.Length, <span class="at">color =</span> Species, <span class="at">fill =</span> Species)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>グラフを横に並べて表示するときには、<code>+</code>でオブジェクトを繋ぎます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>グラフを横に並べる</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-79-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-67"><img src="chapter22_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>同様にカッコで囲えば表示を一部まとめておくことができます。また、<code>|</code>は横並び、<code>/</code>は縦並びにグラフを配置する場合に用います。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>グラフを縦横に配置する</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">|</span> p2) <span class="sc">/</span> p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-80-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-68"><img src="chapter22_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>カッコ、<code>|</code>、<code>/</code>を組み合わせれば、グラフを様々な配置に並べて表示することができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>カッコを用いて配置する</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">|</span> p2) <span class="sc">/</span> (p3 <span class="sc">|</span> p4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-81-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-69"><img src="chapter22_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gganimate" class="level3" data-number="22.17.2">
<h3 data-number="22.17.2" class="anchored" data-anchor-id="gganimate"><span class="header-section-number">22.17.2</span> gganimate</h3>
<p><code>gganimate</code><span class="citation" data-cites="gganimate_bib">(<a href="references.html#ref-gganimate_bib" role="doc-biblioref">Pedersen and Robinson 2022</a>)</span>はアニメーションを利用したグラフを作成するためのライブラリです。下の例では、<code>gamminder</code>（各国の年別のGDPと寿命、人口のデータ）をバブルチャートとし、年毎にアニメーションとしたものです。<code>transition_time</code>という部分でアニメーションのフレームとなる変数を設定し、<code>ease_aes</code>という部分でフレームの間隔を表現します。</p>
<p>アニメーションをgifで保存する場合には、<code>anim_save</code>関数を用います。<code>anim_save</code>関数の引数の指定は<code>ggsave</code>と類似していますが、グラフオブジェクトを<code>animate</code>関数の引数とした上で、<code>renderer</code>という引数を設定する必要があります。<code>renderer</code>には保存するファイル形式を指定します。gifアニメーションを作成するときには<code>renderer=gifski_renderer()</code>を指定します。この<code>gifski_renderer</code>を用いるためには、<code>gifski</code>パッケージ<span class="citation" data-cites="gifski_bib">(<a href="references.html#ref-gifski_bib" role="doc-biblioref">Ooms, Kornel Lesi?ski, and Authors of the dependency Rust crates 2023</a>)</span>を呼び出しておく必要があります。gif以外にもmpegなどのファイルにも保存できますが、別途ライブラリの呼び出しが必要です。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>gganimate関数でgifを作成</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(gganimate, gifski, gapminder)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(gdpPercap, lifeExp, <span class="at">size =</span> pop, <span class="at">colour =</span> country)) <span class="sc">+</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> country_colors) <span class="sc">+</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> continent) <span class="sc">+</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Year: {frame_time}'</span>, <span class="at">x =</span> <span class="st">'GDP per capita'</span>, <span class="at">y =</span> <span class="st">'life expectancy'</span>) <span class="sc">+</span> <span class="co"># frame_timeで描画を指定</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_time</span>(year) <span class="sc">+</span> <span class="co"># yearの列をフレームとする</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ease_aes</span>(<span class="st">'linear'</span>) <span class="co"># yearごとのフレーム間隔は一定</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">"p.gif"</span>, <span class="fu">animate</span>(p, <span class="at">renderer =</span> <span class="fu">gifski_renderer</span>())) <span class="co"># 描画の方法を指定</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><a href="p.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-70"><img src="p.gif" class="img-fluid"></a></p>
</section>
<section id="ggally" class="level3" data-number="22.17.3">
<h3 data-number="22.17.3" class="anchored" data-anchor-id="ggally"><span class="header-section-number">22.17.3</span> GGally</h3>
<p><code>GGally</code><span class="citation" data-cites="GGally_bib">(<a href="references.html#ref-GGally_bib" role="doc-biblioref">Schloerke et al. 2023</a>)</span>は<code>ggplot2</code>を使って、相関行列を描画するためのExtensionです。各列のデータの型に従い、表示するグラフの形を変えてくれたり、相関係数を表示してくれたりします。<code>pairs</code>関数を用いてグラフを書くよりもデータの特徴をとらえやすい相関行列の図を簡単に作成することができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>GGally::ggpairs関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(GGally)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(iris, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">color=</span>Species))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="chapter22_files/figure-html/unnamed-chunk-83-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-71"><img src="chapter22_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
他言語のグラフ作成との比較
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>R以外の言語にも、グラフ作成のライブラリが備わっています。例えばPythonでは、<a href="https://matplotlib.org/stable/">matplotlib</a>や<a href="https://seaborn.pydata.org/index.html">seaborn</a>、<a href="https://plotly.com/graphing-libraries/">plotly</a>などがあります。Juliaでは<a href="https://docs.juliaplots.org/stable/gallery/gr/">Julia Plots</a>がデフォルトのグラフ作成ライブラリです。いずれもどちらかと言えばRのデフォルトに近い関数を用いてグラフを作成するようです。</p>
<p><code>ggplot2</code>では、データ、aes、グラフの形をそれぞれ<code>ggplot</code>、<code>aes</code>、<code>geom</code>関数で表現し、ジェネリック関数として設定された<code>+</code>で繋ぐ点が特徴です。特徴が他のライブラリとは異なるため、記法に慣れるまでは他のライブラリよりグラフを作成するのが難しく感じるかもしれません。しかし、<code>ggplot2</code>の経験を積み、慣れてしまえば表現したいグラフを他のライブラリよりスムーズに作成することができます。</p>
</div>
</div>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-gifski_bib" class="csl-entry" role="listitem">
Ooms, Jeroen, Kornel Lesi?ski, and Authors of the dependency Rust crates. 2023. <em>Gifski: Highest Quality GIF Encoder</em>. <a href="https://CRAN.R-project.org/package=gifski">https://CRAN.R-project.org/package=gifski</a>.
</div>
<div id="ref-sf_bib2" class="csl-entry" role="listitem">
Pebesma, Edzer. 2018. <span>“<span class="nocase">Simple Features for R: Standardized Support for Spatial Vector Data</span>.”</span> <em><span>The R Journal</span></em> 10 (1): 439–46. <a href="https://doi.org/10.32614/RJ-2018-009">https://doi.org/10.32614/RJ-2018-009</a>.
</div>
<div id="ref-sf_bib1" class="csl-entry" role="listitem">
Pebesma, Edzer, and Roger Bivand. 2023. <em><span class="nocase">Spatial Data Science: With applications in R</span></em>. <span>Chapman and Hall/CRC</span>. <a href="https://doi.org/10.1201/9780429459016">https://doi.org/10.1201/9780429459016</a>.
</div>
<div id="ref-patchwork_bib" class="csl-entry" role="listitem">
Pedersen, Thomas Lin. 2023. <em>Patchwork: The Composer of Plots</em>. <a href="https://CRAN.R-project.org/package=patchwork">https://CRAN.R-project.org/package=patchwork</a>.
</div>
<div id="ref-gganimate_bib" class="csl-entry" role="listitem">
Pedersen, Thomas Lin, and David Robinson. 2022. <em>Gganimate: A Grammar of Animated Graphics</em>. <a href="https://CRAN.R-project.org/package=gganimate">https://CRAN.R-project.org/package=gganimate</a>.
</div>
<div id="ref-maps_bib" class="csl-entry" role="listitem">
Richard A. Becker, Original S code by, Allan R. Wilks. R version by Ray Brownrigg. Enhancements by Thomas P Minka, and Alex Deckmyn. Fixes by the CRAN team. 2023. <em>Maps: Draw Geographical Maps</em>. <a href="https://CRAN.R-project.org/package=maps">https://CRAN.R-project.org/package=maps</a>.
</div>
<div id="ref-GGally_bib" class="csl-entry" role="listitem">
Schloerke, Barret, Di Cook, Joseph Larmarange, Francois Briatte, Moritz Marbach, Edwin Thoen, Amos Elberg, and Jason Crowley. 2023. <em>GGally: Extension to ’Ggplot2’</em>. <a href="https://CRAN.R-project.org/package=GGally">https://CRAN.R-project.org/package=GGally</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter21.html" class="pagination-link" aria-label="グラフ作成：低レベルグラフィック関数とグラフィックパラメータ">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">グラフ作成：低レベルグラフィック関数とグラフィックパラメータ</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chapter23.html" class="pagination-link" aria-label="plotly">
        <span class="nav-page-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">plotly</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb102" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># ggplot2</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>現在のRでは、デフォルトのグラフ作成関数はデータの確認に用いられていることが多く、プレゼンテーションや論文など、人に見せるためのきれいなグラフを作成する場合には、ほとんどの場合**`ggplot2`**が用いられています。<span class="in">`ggplot2`</span>を用いると、美しいグラフを統一感のある記法で簡単に描画することができます。</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>には、その使い方についてのみ書かれた教科書が多数出ているぐらいに沢山の関数・引数が設定されています。この章での解説は<span class="in">`ggplot2`</span>の紹介に留めますが、興味のある方は<span class="co">[</span><span class="ot">リファレンス</span><span class="co">](https://ggplot2.tidyverse.org/reference/)</span>や<span class="co">[</span><span class="ot">チートシート</span><span class="co">](https://rstudio.github.io/cheatsheets/data-visualization.pdf)</span>、教科書（<span class="co">[</span><span class="ot">ggplot2: Elegant Graphics for Data Analysis</span><span class="co">](https://ggplot2-book.org/index.html)</span>、<span class="co">[</span><span class="ot">ggplot2: Elegant Graphics for Data Analysis 日本語版</span><span class="co">](https://www.maruzen-publishing.co.jp/item/?book_no=294192)</span>、<span class="co">[</span><span class="ot">R graphic cookbook</span><span class="co">](https://r-graphics.org/)</span>、<span class="co">[</span><span class="ot">R graphic cookbook 日本語版</span><span class="co">](https://www.oreilly.co.jp/books/9784873118925/)</span>など）を読むことをお勧めします。</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>は<span class="in">`tidyverse`</span>に含まれるライブラリの一つですので、<span class="in">`tidyverse`</span>を呼び出すことで使用することができます。他の<span class="in">`tidyverese`</span>の機能である、<span class="in">`dplyr`</span>や<span class="in">`tidyr`</span>、パイプ演算子などとも相性が良く、これらを<span class="in">`ggplot2`</span>と同時に用いるのが一般的です。</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="ライブラリの読み出し"}</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="in">pacman::p_load(tidyverse)</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>では、まず<span class="in">`ggplot`</span>関数にデータフレームを引数として与えます。<span class="in">`ggplot2`</span>では、**データはほぼ常にデータフレームで与える**必要があります。<span class="in">`ggplot`</span>関数はデータの設定のための関数で、データフレームを引数にして<span class="in">`ggplot`</span>関数だけを実行しても、空白が表示されるだけです。<span class="in">`ggplot`</span>関数は第一引数にデータフレームを取るため、パイプ演算子を用いてデータフレームを<span class="in">`ggplot`</span>関数につなぐのが一般的です。</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="ggplot関数のみを用いる"}</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a><span class="in"># ggplot関数だけでは何も表示されない</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- iris |&gt; ggplot()</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a><span class="in">p</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a><span class="fu">## aesthetic mapping（aes）</span></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot`</span>関数は、引数に<span class="in">`aes`</span>関数を取ります。この<span class="in">`aes`</span>は**aesthetic（エステティック）mapping**の略です。この「エステティック」というのは、美容のエステと同じ言葉で、「美的な」という意味を持ちます。<span class="in">`ggplot2`</span>では、<span class="in">`aes`</span>関数内でグラフのx軸、y軸の値などの要素、色や点のサイズ等を指定します。この指定には、<span class="in">`ggplot`</span>関数の引数であるデータフレームの列名を文字列ではなく、そのまま使用することができます。</span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a>下の例では、データフレームである<span class="in">`iris`</span>の列から、<span class="in">`Sepal.Length`</span>を<span class="in">`x`</span>に、<span class="in">`Sepal.Width`</span>を<span class="in">`y`</span>に設定したものです。<span class="in">`aes`</span>関数を引数にして<span class="in">`ggplot`</span>関数を実行すると、点や線などのグラフの要素は表示されませんが、縦と横の軸だけは表示されます。</span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="aesでグラフの要素を指定"}</span></span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a><span class="in"># 軸だけが表記される</span></span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; ggplot(aes(x = Sepal.Length, y = Sepal.Width))</span></span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-32"><a href="#cb102-32" aria-hidden="true" tabindex="-1"></a><span class="fu">## geom関数</span></span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-34"><a href="#cb102-34" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>でグラフを表示するためには、グラフの種類を指定する関数である、**`geom`関数**を用いる必要があります。例えば、散布図を描画するための<span class="in">`geom`</span>関数は、<span class="in">`geom_point`</span>関数です。この<span class="in">`geom`</span>関数の中でも、データフレームや<span class="in">`aes`</span>を設定することができます。ただし、この<span class="in">`geom`</span>関数だけでは、グラフを表示することはできません。先程説明した、<span class="in">`ggplot`</span>関数と組み合わせる必要があります。</span>
<span id="cb102-35"><a href="#cb102-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-36"><a href="#cb102-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom関数"}</span></span>
<span id="cb102-37"><a href="#cb102-37" aria-hidden="true" tabindex="-1"></a><span class="in"># geom関数だけではグラフを記述できない</span></span>
<span id="cb102-38"><a href="#cb102-38" aria-hidden="true" tabindex="-1"></a><span class="in">geom_point(data = iris, aes(x = Sepal.Length, y = Sepal.Width))</span></span>
<span id="cb102-39"><a href="#cb102-39" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-40"><a href="#cb102-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-41"><a href="#cb102-41" aria-hidden="true" tabindex="-1"></a><span class="in">`geom`</span>関数は、<span class="in">`ggplot`</span>関数に<span class="in">`+`</span>でつなぐ必要があります。まず、データフレームを引数にした<span class="in">`ggplot`</span>関数を準備し、その関数に足し算で<span class="in">`geom_point`</span>関数をつなぎ、<span class="in">`ggplot`</span>関数内もしくは<span class="in">`geom_point`</span>関数内で<span class="in">`aes`</span>を設定すると、グラフが表示されます。</span>
<span id="cb102-42"><a href="#cb102-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-43"><a href="#cb102-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="ggplot関数とgeom関数を+でつなぐ"}</span></span>
<span id="cb102-44"><a href="#cb102-44" aria-hidden="true" tabindex="-1"></a><span class="in"># geom関数内でaesを設定する</span></span>
<span id="cb102-45"><a href="#cb102-45" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-46"><a href="#cb102-46" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot() + </span></span>
<span id="cb102-47"><a href="#cb102-47" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(aes(x = Sepal.Length, y = Sepal.Width))</span></span>
<span id="cb102-48"><a href="#cb102-48" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-49"><a href="#cb102-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-50"><a href="#cb102-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="ggplot関数内でaesを指定する"}</span></span>
<span id="cb102-51"><a href="#cb102-51" aria-hidden="true" tabindex="-1"></a><span class="in"># ggplot関数内でaesを設定する（上と同じ）</span></span>
<span id="cb102-52"><a href="#cb102-52" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-53"><a href="#cb102-53" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width)) + </span></span>
<span id="cb102-54"><a href="#cb102-54" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point()</span></span>
<span id="cb102-55"><a href="#cb102-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-56"><a href="#cb102-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-57"><a href="#cb102-57" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip collapse=<span class="in">`true`</span>}</span>
<span id="cb102-58"><a href="#cb102-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-59"><a href="#cb102-59" aria-hidden="true" tabindex="-1"></a><span class="fu">## ggplot2の+記号</span></span>
<span id="cb102-60"><a href="#cb102-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-61"><a href="#cb102-61" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>では、<span class="in">`ggplot`</span>関数と<span class="in">`geom`</span>関数をつなぐために、<span class="in">`+`</span>の記号を用います。この<span class="in">`+`</span>はジェネリック関数として設定されており、<span class="in">`ggplot2`</span>内では足し算とは異なる機能を持ちます。詳しくは<span class="co">[</span><span class="ot">ggplot2のリファレンス</span><span class="co">](https://ggplot2.tidyverse.org/reference/gg-add.html)</span>をご一読ください。</span>
<span id="cb102-62"><a href="#cb102-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-63"><a href="#cb102-63" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb102-64"><a href="#cb102-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-65"><a href="#cb102-65" aria-hidden="true" tabindex="-1"></a>以下の表1に、代表的な<span class="in">`geom`</span>関数の一覧を示します。</span>
<span id="cb102-66"><a href="#cb102-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-67"><a href="#cb102-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb102-68"><a href="#cb102-68" aria-hidden="true" tabindex="-1"></a><span class="in">d &lt;- readxl::read_excel("./data/chapter20_ggplot2.xlsx", sheet=1)</span></span>
<span id="cb102-69"><a href="#cb102-69" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(d, caption="表1：代表的なgeom関数")</span></span>
<span id="cb102-70"><a href="#cb102-70" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-71"><a href="#cb102-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-72"><a href="#cb102-72" aria-hidden="true" tabindex="-1"></a><span class="fu">## qplot</span></span>
<span id="cb102-73"><a href="#cb102-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-74"><a href="#cb102-74" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>には、<span class="in">`qplot`</span>という関数も準備されています。<span class="in">`qplot`</span>関数は「Quick plot」の略で、<span class="in">`plot`</span>関数のように1つの関数だけでグラフの作成が完了します。ただし、この<span class="in">`qplot`</span>関数で凝ったグラフを作成することは難しいため、現在ではその使用は非推奨とされています。</span>
<span id="cb102-75"><a href="#cb102-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-76"><a href="#cb102-76" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="qplot関数"}</span></span>
<span id="cb102-77"><a href="#cb102-77" aria-hidden="true" tabindex="-1"></a><span class="in"># 上と同じグラフをqplotで描画</span></span>
<span id="cb102-78"><a href="#cb102-78" aria-hidden="true" tabindex="-1"></a><span class="in">qplot(Sepal.Length, Sepal.Width, data = iris, geom="point")</span></span>
<span id="cb102-79"><a href="#cb102-79" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-80"><a href="#cb102-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-81"><a href="#cb102-81" aria-hidden="true" tabindex="-1"></a><span class="fu">## geom関数群</span></span>
<span id="cb102-82"><a href="#cb102-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-83"><a href="#cb102-83" aria-hidden="true" tabindex="-1"></a>表1に示した通り、<span class="in">`geom`</span>関数には<span class="in">`geom_point`</span>以外にもたくさんの関数が設定されています。以下に各<span class="in">`geom`</span>関数を用いて作成できるグラフを紹介します。</span>
<span id="cb102-84"><a href="#cb102-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-85"><a href="#cb102-85" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_text</span></span>
<span id="cb102-86"><a href="#cb102-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-87"><a href="#cb102-87" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_text`</span>は、テキストをグラフ上に表示するための関数です。<span class="in">`geom_text`</span>は<span class="in">`aes`</span>に<span class="in">`x`</span>、<span class="in">`y`</span>、<span class="in">`label`</span>の3つの引数を設定し、その<span class="in">`x`</span>、<span class="in">`y`</span>の位置に<span class="in">`label`</span>で指定した文字列を表示します。</span>
<span id="cb102-88"><a href="#cb102-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-89"><a href="#cb102-89" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_text関数"}</span></span>
<span id="cb102-90"><a href="#cb102-90" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-91"><a href="#cb102-91" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width, label = Species)) + </span></span>
<span id="cb102-92"><a href="#cb102-92" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text()</span></span>
<span id="cb102-93"><a href="#cb102-93" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-94"><a href="#cb102-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-95"><a href="#cb102-95" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_line</span></span>
<span id="cb102-96"><a href="#cb102-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-97"><a href="#cb102-97" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_line`</span>は<span class="in">`aes`</span>の<span class="in">`x`</span>、<span class="in">`y`</span>に設定した点を結ぶ線、つまり線グラフを描画するための関数です。<span class="in">`geom_line`</span>では、線は必ずxの小さい値から大きい値へと点を繋いでいく形で線が描画されます。</span>
<span id="cb102-98"><a href="#cb102-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-99"><a href="#cb102-99" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_line関数"}</span></span>
<span id="cb102-100"><a href="#cb102-100" aria-hidden="true" tabindex="-1"></a><span class="in">economics |&gt; </span></span>
<span id="cb102-101"><a href="#cb102-101" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = pop, y = pce)) +</span></span>
<span id="cb102-102"><a href="#cb102-102" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line()</span></span>
<span id="cb102-103"><a href="#cb102-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-104"><a href="#cb102-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-105"><a href="#cb102-105" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_ribbon</span></span>
<span id="cb102-106"><a href="#cb102-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-107"><a href="#cb102-107" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_ribbon`</span>は、幅のあるグラフ（リボン）を描画するための関数です。<span class="in">`geom_ribbon`</span>は<span class="in">`x`</span>、<span class="in">`ymin`</span>、<span class="in">`ymax`</span>の3つの引数を取り、<span class="in">`x`</span>で指定した位置に<span class="in">`ymin`</span>－<span class="in">`ymax`</span>の間を幅とするリボンを描画します。引数として、<span class="in">`y`</span>、<span class="in">`xmin`</span>、<span class="in">`xmax`</span>の3つを取ることもできます。<span class="in">`ymin`</span>、<span class="in">`ymax`</span>を指定した場合にはリボンは横向き、<span class="in">`xmin`</span>、<span class="in">`xmax`</span>を指定した場合にはリボンは縦向きになります。</span>
<span id="cb102-108"><a href="#cb102-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-109"><a href="#cb102-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_ribbon関数"}</span></span>
<span id="cb102-110"><a href="#cb102-110" aria-hidden="true" tabindex="-1"></a><span class="in">d &lt;- data.frame(</span></span>
<span id="cb102-111"><a href="#cb102-111" aria-hidden="true" tabindex="-1"></a><span class="in">  time = time(Nile) |&gt; as.numeric(), </span></span>
<span id="cb102-112"><a href="#cb102-112" aria-hidden="true" tabindex="-1"></a><span class="in">  Nile100 = Nile |&gt; as.numeric(), </span></span>
<span id="cb102-113"><a href="#cb102-113" aria-hidden="true" tabindex="-1"></a><span class="in">  Nile90 = Nile |&gt; as.numeric() * 0.9 , </span></span>
<span id="cb102-114"><a href="#cb102-114" aria-hidden="true" tabindex="-1"></a><span class="in">  Nile110 = Nile |&gt; as.numeric() * 1.1)</span></span>
<span id="cb102-115"><a href="#cb102-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-116"><a href="#cb102-116" aria-hidden="true" tabindex="-1"></a><span class="in">d |&gt; </span></span>
<span id="cb102-117"><a href="#cb102-117" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = time, ymax = Nile110, ymin = Nile90)) +</span></span>
<span id="cb102-118"><a href="#cb102-118" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_ribbon()</span></span>
<span id="cb102-119"><a href="#cb102-119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-120"><a href="#cb102-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-121"><a href="#cb102-121" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_smooth</span></span>
<span id="cb102-122"><a href="#cb102-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-123"><a href="#cb102-123" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_smooth`</span>は<span class="in">`geom_point`</span>等で表示した点に対して、回帰の式をあてはめ、そのグラフを表示するための関数です。特に引数を指定していない場合、<span class="co">[</span><span class="ot">26章</span><span class="co">](./chapter26.html)</span>で説明するloess回帰をあてはめ、回帰を行った線を表示します。また、95%信頼区間を<span class="in">`geom_ribbon`</span>と同様の表記で示します。</span>
<span id="cb102-124"><a href="#cb102-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-125"><a href="#cb102-125" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_smooth関数"}</span></span>
<span id="cb102-126"><a href="#cb102-126" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-127"><a href="#cb102-127" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width)) +</span></span>
<span id="cb102-128"><a href="#cb102-128" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(size = 2) +</span></span>
<span id="cb102-129"><a href="#cb102-129" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth()</span></span>
<span id="cb102-130"><a href="#cb102-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-131"><a href="#cb102-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-132"><a href="#cb102-132" aria-hidden="true" tabindex="-1"></a>直線での回帰を行う場合には、引数に<span class="in">`method="lm"`</span>を指定します。また、<span class="in">`se`</span>引数を<span class="in">`FALSE`</span>に指定すると、信頼区間の表示を消すことができます。</span>
<span id="cb102-133"><a href="#cb102-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-134"><a href="#cb102-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_smoothで直線回帰"}</span></span>
<span id="cb102-135"><a href="#cb102-135" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-136"><a href="#cb102-136" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width)) +</span></span>
<span id="cb102-137"><a href="#cb102-137" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(size = 2) +</span></span>
<span id="cb102-138"><a href="#cb102-138" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = FALSE)</span></span>
<span id="cb102-139"><a href="#cb102-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-140"><a href="#cb102-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-141"><a href="#cb102-141" aria-hidden="true" tabindex="-1"></a>データフレームの因子の列に従ってグラフを分けて回帰したい場合には、<span class="in">`aes`</span>関数内で<span class="in">`group`</span>引数にその因子を設定します。以下の例では<span class="in">`iris`</span>の<span class="in">`Species`</span>を<span class="in">`group`</span>引数に設定し、アヤメの種ごとに回帰を行っています。</span>
<span id="cb102-142"><a href="#cb102-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-143"><a href="#cb102-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="group引数を設定する"}</span></span>
<span id="cb102-144"><a href="#cb102-144" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-145"><a href="#cb102-145" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width, group = Species)) +</span></span>
<span id="cb102-146"><a href="#cb102-146" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(size = 2) +</span></span>
<span id="cb102-147"><a href="#cb102-147" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm")</span></span>
<span id="cb102-148"><a href="#cb102-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-149"><a href="#cb102-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-150"><a href="#cb102-150" aria-hidden="true" tabindex="-1"></a><span class="in">`aes`</span>に<span class="in">`color`</span>や<span class="in">`fill`</span>を設定することでも因子ごとに回帰を行うことができます。</span>
<span id="cb102-151"><a href="#cb102-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-152"><a href="#cb102-152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="color引数やfill引数を設定する"}</span></span>
<span id="cb102-153"><a href="#cb102-153" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-154"><a href="#cb102-154" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width, color = Species, fill = Species)) +</span></span>
<span id="cb102-155"><a href="#cb102-155" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(size = 2) +</span></span>
<span id="cb102-156"><a href="#cb102-156" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm")</span></span>
<span id="cb102-157"><a href="#cb102-157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-158"><a href="#cb102-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-159"><a href="#cb102-159" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_path</span></span>
<span id="cb102-160"><a href="#cb102-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-161"><a href="#cb102-161" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_path`</span>は、xの大きさに関わらず、データフレームの上の行から線をつなぐ関数です。データフレームを時系列に並べておき、2変数の時間変化を追うような場合に利用します。</span>
<span id="cb102-162"><a href="#cb102-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-163"><a href="#cb102-163" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_path`</span>を用いる場合には、一色の線では線のどちらの端が上の行で、どちらが下の行かわからないため、通常は行の順番にそって線の色を変えることになります。色を指定したい場合には、<span class="in">`aes`</span>の引数に<span class="in">`color`</span>を設定します。<span class="in">`color`</span>には、データフレームの列のうち、日時などを設定します。このように設定することで、日時と共に線の色が変わるようなグラフを作成することができます。</span>
<span id="cb102-164"><a href="#cb102-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-165"><a href="#cb102-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_path関数"}</span></span>
<span id="cb102-166"><a href="#cb102-166" aria-hidden="true" tabindex="-1"></a><span class="in">economics |&gt; </span></span>
<span id="cb102-167"><a href="#cb102-167" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = uempmed, y = pce, color = date)) +</span></span>
<span id="cb102-168"><a href="#cb102-168" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_path()</span></span>
<span id="cb102-169"><a href="#cb102-169" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-170"><a href="#cb102-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-171"><a href="#cb102-171" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_step</span></span>
<span id="cb102-172"><a href="#cb102-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-173"><a href="#cb102-173" aria-hidden="true" tabindex="-1"></a>Rの<span class="in">`step`</span>関数を用いた場合と同様のグラフを記述する場合には、<span class="in">`geom_step`</span>関数を用います。</span>
<span id="cb102-174"><a href="#cb102-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-175"><a href="#cb102-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_step関数"}</span></span>
<span id="cb102-176"><a href="#cb102-176" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-177"><a href="#cb102-177" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = 1:150, y = Sepal.Length)) + </span></span>
<span id="cb102-178"><a href="#cb102-178" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_step()</span></span>
<span id="cb102-179"><a href="#cb102-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-180"><a href="#cb102-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-181"><a href="#cb102-181" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_abline、geom_vline、geom_hline</span></span>
<span id="cb102-182"><a href="#cb102-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-183"><a href="#cb102-183" aria-hidden="true" tabindex="-1"></a>グラフ上に直線を描く場合には、<span class="in">`geom_abline`</span>、<span class="in">`geom_vline`</span>、<span class="in">`geom_hline`</span>を用います。<span class="in">`geom_abline`</span>は切片（<span class="in">`intercept`</span>）と傾き（<span class="in">`slope`</span>）を指定し、その切片・傾きを持つ直線を引くものです。<span class="in">`geom_vline`</span>は垂直な線（vertical line）、<span class="in">`geom_hline`</span>は水平な線（horizontal line）を描画します。<span class="in">`geom_vline`</span>はx軸と交わるため、x軸の切片（<span class="in">`xintercept`</span>）の設定が必要です。同様に<span class="in">`geom_hline`</span>はy軸と交わるため、y軸の切片（<span class="in">`yintercept`</span>）を設定します。</span>
<span id="cb102-184"><a href="#cb102-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-185"><a href="#cb102-185" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_abline関数など"}</span></span>
<span id="cb102-186"><a href="#cb102-186" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot()+ </span></span>
<span id="cb102-187"><a href="#cb102-187" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_abline(intercept = 10, slope = -1) +</span></span>
<span id="cb102-188"><a href="#cb102-188" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 10, color = "red") +</span></span>
<span id="cb102-189"><a href="#cb102-189" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_hline(yintercept = 10, color = "blue") +</span></span>
<span id="cb102-190"><a href="#cb102-190" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(0, 15) +</span></span>
<span id="cb102-191"><a href="#cb102-191" aria-hidden="true" tabindex="-1"></a><span class="in">  ylim(0, 15)</span></span>
<span id="cb102-192"><a href="#cb102-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-193"><a href="#cb102-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-194"><a href="#cb102-194" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_bar</span></span>
<span id="cb102-195"><a href="#cb102-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-196"><a href="#cb102-196" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_bar`</span>は、棒グラフを作成するための関数です。<span class="in">`geom_bar`</span>を引数なしで実行すると、ヒストグラムが描画されます。これは、<span class="in">`geom_bar`</span>の引数のうち、<span class="in">`stat`</span>引数が<span class="in">`"count"`</span>に設定されているためです。この<span class="in">`stat`</span>引数は、グラフを記述する際に実施する統計的な処理を指定するための引数です。</span>
<span id="cb102-197"><a href="#cb102-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-198"><a href="#cb102-198" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_bar関数"}</span></span>
<span id="cb102-199"><a href="#cb102-199" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-200"><a href="#cb102-200" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length)) +</span></span>
<span id="cb102-201"><a href="#cb102-201" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar() # ヒストグラムを表示（stat="count"）</span></span>
<span id="cb102-202"><a href="#cb102-202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-203"><a href="#cb102-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-204"><a href="#cb102-204" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_histogram</span></span>
<span id="cb102-205"><a href="#cb102-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-206"><a href="#cb102-206" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>には、ヒストグラムを描画するための専用の関数である、<span class="in">`geom_histogram`</span>もあります。ヒストグラムを描くのが目的であれば、こちらの<span class="in">`geom_histogram`</span>の方が名前と目的が一致しており、使いやすいかと思います。</span>
<span id="cb102-207"><a href="#cb102-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-208"><a href="#cb102-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_histogram関数"}</span></span>
<span id="cb102-209"><a href="#cb102-209" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-210"><a href="#cb102-210" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length)) +</span></span>
<span id="cb102-211"><a href="#cb102-211" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram()</span></span>
<span id="cb102-212"><a href="#cb102-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-213"><a href="#cb102-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-214"><a href="#cb102-214" aria-hidden="true" tabindex="-1"></a><span class="fu">### statの設定</span></span>
<span id="cb102-215"><a href="#cb102-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-216"><a href="#cb102-216" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_bar`</span>関数で1つの値に対して1つの棒グラフを描画する、要は通常の棒グラフを描画する場合には、<span class="in">`stat="identity"`</span>を指定します。棒グラフを描画するときには、まずx軸とy軸の数値・ラベルを含むデータフレームを作成します。</span>
<span id="cb102-217"><a href="#cb102-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-218"><a href="#cb102-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="tidyrd、dplyrでデータフレームの前準備"}</span></span>
<span id="cb102-219"><a href="#cb102-219" aria-hidden="true" tabindex="-1"></a><span class="in">d &lt;- iris |&gt; </span></span>
<span id="cb102-220"><a href="#cb102-220" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Species) |&gt; </span></span>
<span id="cb102-221"><a href="#cb102-221" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(</span></span>
<span id="cb102-222"><a href="#cb102-222" aria-hidden="true" tabindex="-1"></a><span class="in">    mSepal.Length = mean(Sepal.Length), </span></span>
<span id="cb102-223"><a href="#cb102-223" aria-hidden="true" tabindex="-1"></a><span class="in">    sSepal.Length = sd(Sepal.Length))</span></span>
<span id="cb102-224"><a href="#cb102-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-225"><a href="#cb102-225" aria-hidden="true" tabindex="-1"></a><span class="in">d</span></span>
<span id="cb102-226"><a href="#cb102-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-227"><a href="#cb102-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-228"><a href="#cb102-228" aria-hidden="true" tabindex="-1"></a>後は、<span class="in">`aes`</span>でx軸に配置する値、y軸に配置する値を指定し、<span class="in">`geom_bar`</span>関数内で<span class="in">`stat="identity”`</span>を指定します。</span>
<span id="cb102-229"><a href="#cb102-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-230"><a href="#cb102-230" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="stat=\"identity\"を指定"}</span></span>
<span id="cb102-231"><a href="#cb102-231" aria-hidden="true" tabindex="-1"></a><span class="in">d |&gt; </span></span>
<span id="cb102-232"><a href="#cb102-232" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Species, y = mSepal.Length)) +</span></span>
<span id="cb102-233"><a href="#cb102-233" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity")</span></span>
<span id="cb102-234"><a href="#cb102-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-235"><a href="#cb102-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-236"><a href="#cb102-236" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_col</span></span>
<span id="cb102-237"><a href="#cb102-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-238"><a href="#cb102-238" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>には、直接棒グラフ（column plot）を描画するための専用の関数である、<span class="in">`geom_col`</span>もあります。名前から直感的に理解できるなら、こちらを用いてもよいでしょう。</span>
<span id="cb102-239"><a href="#cb102-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-240"><a href="#cb102-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_col関数"}</span></span>
<span id="cb102-241"><a href="#cb102-241" aria-hidden="true" tabindex="-1"></a><span class="in">d |&gt; </span></span>
<span id="cb102-242"><a href="#cb102-242" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Species, y = mSepal.Length)) +</span></span>
<span id="cb102-243"><a href="#cb102-243" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_col()</span></span>
<span id="cb102-244"><a href="#cb102-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-245"><a href="#cb102-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-246"><a href="#cb102-246" aria-hidden="true" tabindex="-1"></a><span class="fu">### 積み上げ式棒グラフ</span></span>
<span id="cb102-247"><a href="#cb102-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-248"><a href="#cb102-248" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_bar`</span>関数は積み上げ式棒グラフを作成する際にも用いることができます。積み上げ式棒グラフを描画するときには、特に引数を指定する必要はありませんが、色分けをしないと積み上げたグラフを見分けることができません。積み上げ式グラフを記述するときには、<span class="in">`color`</span>とともに、棒の中身の色を設定する<span class="in">`fill`</span>という引数で、色を指定するのが良いでしょう。</span>
<span id="cb102-249"><a href="#cb102-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-250"><a href="#cb102-250" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_bar`</span>で積み上げ式グラフが記述されるのは、<span class="in">`geom_bar`</span>の<span class="in">`position`</span>引数のデフォルトが<span class="in">`position="stack"`</span>だからです。<span class="in">`position="dodge"`</span>を指定すると、横並びにしたグラフが表示されます。</span>
<span id="cb102-251"><a href="#cb102-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-252"><a href="#cb102-252" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_bar関数で積み上げ式棒グラフ"}</span></span>
<span id="cb102-253"><a href="#cb102-253" aria-hidden="true" tabindex="-1"></a><span class="in">d |&gt; </span></span>
<span id="cb102-254"><a href="#cb102-254" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = "1", y = mSepal.Length, color = Species, fill = Species)) +</span></span>
<span id="cb102-255"><a href="#cb102-255" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity")</span></span>
<span id="cb102-256"><a href="#cb102-256" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-257"><a href="#cb102-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-258"><a href="#cb102-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="position=\"dodge\"で横並びの棒グラフ"}</span></span>
<span id="cb102-259"><a href="#cb102-259" aria-hidden="true" tabindex="-1"></a><span class="in">d |&gt; </span></span>
<span id="cb102-260"><a href="#cb102-260" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = "1", y = mSepal.Length, color = Species, fill = Species)) +</span></span>
<span id="cb102-261"><a href="#cb102-261" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity", position = "dodge")</span></span>
<span id="cb102-262"><a href="#cb102-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-263"><a href="#cb102-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-264"><a href="#cb102-264" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_dotplot</span></span>
<span id="cb102-265"><a href="#cb102-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-266"><a href="#cb102-266" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_dotplot`</span>はドットプロットという、ヒストグラムを点で描いたようなグラフを作成するときに用いる関数です。ドットの数がその値の範囲に存在する値の個数を示します。縦軸の単位がよくわからないものになりますので、通常はヒストグラムの方が使い勝手が良いでしょう。</span>
<span id="cb102-267"><a href="#cb102-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-268"><a href="#cb102-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_dotplot関数"}</span></span>
<span id="cb102-269"><a href="#cb102-269" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-270"><a href="#cb102-270" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length)) +</span></span>
<span id="cb102-271"><a href="#cb102-271" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dotplot()</span></span>
<span id="cb102-272"><a href="#cb102-272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-273"><a href="#cb102-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-274"><a href="#cb102-274" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_density</span></span>
<span id="cb102-275"><a href="#cb102-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-276"><a href="#cb102-276" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_density`</span>はヒストグラムと類似していますが、単に度数を返すのではなく、カーネル密度関数に変換した上で度数分布を示してくれる関数です。<span class="in">`geom_density`</span>では、縦軸の値は確率密度となり、実際のデータが少ない部分にも実際の頻度より高めの確率密度が与えられるため、かなりデータが多い場合以外は正確性に欠くことになります。データが少ない場合にはヒストグラムの方が使い勝手が良いでしょう。</span>
<span id="cb102-277"><a href="#cb102-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-278"><a href="#cb102-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_density関数"}</span></span>
<span id="cb102-279"><a href="#cb102-279" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-280"><a href="#cb102-280" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length)) +</span></span>
<span id="cb102-281"><a href="#cb102-281" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density()</span></span>
<span id="cb102-282"><a href="#cb102-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-283"><a href="#cb102-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-284"><a href="#cb102-284" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_freqpoly</span></span>
<span id="cb102-285"><a href="#cb102-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-286"><a href="#cb102-286" aria-hidden="true" tabindex="-1"></a>ヒストグラムを棒グラフではなく、線で表記するのが<span class="in">`geom_freqpoly`</span>です。こちらもヒストグラムほど使い勝手は良くないように思います。</span>
<span id="cb102-287"><a href="#cb102-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-288"><a href="#cb102-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_freqpoly関数"}</span></span>
<span id="cb102-289"><a href="#cb102-289" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-290"><a href="#cb102-290" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length)) +</span></span>
<span id="cb102-291"><a href="#cb102-291" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_freqpoly()</span></span>
<span id="cb102-292"><a href="#cb102-292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-293"><a href="#cb102-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-294"><a href="#cb102-294" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_jitter</span></span>
<span id="cb102-295"><a href="#cb102-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-296"><a href="#cb102-296" aria-hidden="true" tabindex="-1"></a>データの分布は単に散布図でも表示できます。ただし、<span class="in">`geom_point`</span>で単に表記すると、点が重なってしまって正しいデータ分布を示すことはできません。</span>
<span id="cb102-297"><a href="#cb102-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-298"><a href="#cb102-298" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_point関数で点が重なる場合"}</span></span>
<span id="cb102-299"><a href="#cb102-299" aria-hidden="true" tabindex="-1"></a><span class="in"># geom_pointでは点が重なる</span></span>
<span id="cb102-300"><a href="#cb102-300" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt;</span></span>
<span id="cb102-301"><a href="#cb102-301" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Species, y = Sepal.Length, color = Species)) +</span></span>
<span id="cb102-302"><a href="#cb102-302" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point()</span></span>
<span id="cb102-303"><a href="#cb102-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-304"><a href="#cb102-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-305"><a href="#cb102-305" aria-hidden="true" tabindex="-1"></a>このような場合に、点の重なりを抑えるため、データの表示にランダムな幅を持たせるのが<span class="in">`geom_jitter`</span>です。<span class="in">`x`</span>か<span class="in">`y`</span>のどちらかのみが数値の場合には、数値以外の値には幅を持たせず、両方が数値の場合にはx軸・y軸方向に幅を持たせることになります。ですので、<span class="in">`x`</span>、<span class="in">`y`</span>の両方が数値の場合には、点は正確な位置には配置されません。</span>
<span id="cb102-306"><a href="#cb102-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-307"><a href="#cb102-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_jitter関数で点をバラつかせる"}</span></span>
<span id="cb102-308"><a href="#cb102-308" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-309"><a href="#cb102-309" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Species, y = Sepal.Length, color = Species)) +</span></span>
<span id="cb102-310"><a href="#cb102-310" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_jitter()</span></span>
<span id="cb102-311"><a href="#cb102-311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-312"><a href="#cb102-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-313"><a href="#cb102-313" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_boxplot</span></span>
<span id="cb102-314"><a href="#cb102-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-315"><a href="#cb102-315" aria-hidden="true" tabindex="-1"></a>データが十分に多い場合には、箱ひげ図を用いてデータの分布を表示することもできます。<span class="in">`ggplot2`</span>では、<span class="in">`geom_boxplot`</span>を用いて箱ひげ図を描画することができます。<span class="in">`geom_boxplot`</span>に数値ベクターを与えれば、自動的に箱ひげ図を描画してくれます。また、<span class="in">`lower`</span>、<span class="in">`upper`</span>、<span class="in">`middle`</span>、 <span class="in">`min`</span>、<span class="in">`max`</span>という引数を与えると、その引数に設定した数値に従い箱ひげ図を描画することもできます。</span>
<span id="cb102-316"><a href="#cb102-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-317"><a href="#cb102-317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_boxplot関数"}</span></span>
<span id="cb102-318"><a href="#cb102-318" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-319"><a href="#cb102-319" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Species, y = Sepal.Length)) +</span></span>
<span id="cb102-320"><a href="#cb102-320" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot()</span></span>
<span id="cb102-321"><a href="#cb102-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-322"><a href="#cb102-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-323"><a href="#cb102-323" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_violin</span></span>
<span id="cb102-324"><a href="#cb102-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-325"><a href="#cb102-325" aria-hidden="true" tabindex="-1"></a>確率密度を90度回転させ、左右対称に配置した形のグラフのことを、**バイオリンプロット**と呼びます。<span class="in">`ggplot2`</span>では、このバイオリンプロットを<span class="in">`geom_violin`</span>で描画することができます。描画の仕組みは<span class="in">`geom_density`</span>によく似ています。</span>
<span id="cb102-326"><a href="#cb102-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-327"><a href="#cb102-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_violin関数"}</span></span>
<span id="cb102-328"><a href="#cb102-328" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-329"><a href="#cb102-329" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Species, y = Sepal.Length)) +</span></span>
<span id="cb102-330"><a href="#cb102-330" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_violin()</span></span>
<span id="cb102-331"><a href="#cb102-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-332"><a href="#cb102-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-333"><a href="#cb102-333" aria-hidden="true" tabindex="-1"></a><span class="fu">### エラーバーの描画：geom_errorbar、geom_linerange、geom_pointrange</span></span>
<span id="cb102-334"><a href="#cb102-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-335"><a href="#cb102-335" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>で結果にエラーバーを付ける時には、<span class="in">`geom_errorbar`</span>を用います。<span class="in">`geom_errorbar`</span>では、<span class="in">`aes`</span>の引数として、<span class="in">`ymin`</span>と<span class="in">`ymax`</span>、もしくは<span class="in">`xmin`</span>と<span class="in">`xmax`</span>を設定します。<span class="in">`ymin`</span>と<span class="in">`ymax`</span>はy軸方向の、<span class="in">`xmin`</span>と<span class="in">`xmax`</span>はx軸方向のエラーバーを設定する際に用います。また、<span class="in">`geom_errorbar`</span>には<span class="in">`width`</span>という引数もあり、エラーバーの横棒のサイズを設定することができます。</span>
<span id="cb102-336"><a href="#cb102-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-337"><a href="#cb102-337" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_errorbar`</span>は通常、<span class="in">`geom_point`</span>で描画した点グラフや、<span class="in">`geom_bar`</span>で描画した棒グラフに重ねて表示することで用います。重ね書きする際には、<span class="in">`ggplot`</span>に<span class="in">`+`</span>で<span class="in">`geom_point`</span>をつないだ後に、さらに<span class="in">`+`</span>で<span class="in">`geom_errorbar`</span>をつなぐことになります。このように<span class="in">`+`</span>でつなぐと、<span class="in">`ggplot2`</span>では<span class="in">`geom_point`</span>の点グラフの上に、<span class="in">`geom_errorbar`</span>が重ね描きされます。</span>
<span id="cb102-338"><a href="#cb102-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-339"><a href="#cb102-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="エラーバーを表示する"}</span></span>
<span id="cb102-340"><a href="#cb102-340" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- d |&gt; </span></span>
<span id="cb102-341"><a href="#cb102-341" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(</span></span>
<span id="cb102-342"><a href="#cb102-342" aria-hidden="true" tabindex="-1"></a><span class="in">    aes(</span></span>
<span id="cb102-343"><a href="#cb102-343" aria-hidden="true" tabindex="-1"></a><span class="in">      x = Species, </span></span>
<span id="cb102-344"><a href="#cb102-344" aria-hidden="true" tabindex="-1"></a><span class="in">      y = mSepal.Length, </span></span>
<span id="cb102-345"><a href="#cb102-345" aria-hidden="true" tabindex="-1"></a><span class="in">      ymax = mSepal.Length + sSepal.Length,</span></span>
<span id="cb102-346"><a href="#cb102-346" aria-hidden="true" tabindex="-1"></a><span class="in">      ymin = mSepal.Length - sSepal.Length))</span></span>
<span id="cb102-347"><a href="#cb102-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-348"><a href="#cb102-348" aria-hidden="true" tabindex="-1"></a><span class="in">p + geom_point() + geom_errorbar()</span></span>
<span id="cb102-349"><a href="#cb102-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-350"><a href="#cb102-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-351"><a href="#cb102-351" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_errorbar`</span>ではエラーバーに横線が付き、よく見るエラーバーの形となります。ただし、この横線は必ずしも必要なものではありません。横線のないエラーバーを付けたいときには、<span class="in">`geom_linerange`</span>を用います。</span>
<span id="cb102-352"><a href="#cb102-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-353"><a href="#cb102-353" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_linerange関数でエラーバーをつける"}</span></span>
<span id="cb102-354"><a href="#cb102-354" aria-hidden="true" tabindex="-1"></a><span class="in">p + geom_point() + geom_linerange()</span></span>
<span id="cb102-355"><a href="#cb102-355" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-356"><a href="#cb102-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-357"><a href="#cb102-357" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_errorbar`</span>や<span class="in">`geom_linerange`</span>は点が備わっておらず、別途<span class="in">`geom_point`</span>で点を書く必要があります。この点と線を同時に描画するのが、<span class="in">`geom_pointrange`</span>です。<span class="in">`geom_pointrange`</span>を用いると、<span class="in">`geom_point`</span>を別途描画しなくても、点とエラーバーが付いたグラフを作成することができます。このような、点と線のみで記述するグラフのことを**フォレストプロット**と呼び、<span class="co">[</span><span class="ot">メタ解析</span><span class="co">](https://ja.wikipedia.org/wiki/%E3%83%A1%E3%82%BF%E3%82%A2%E3%83%8A%E3%83%AA%E3%82%B7%E3%82%B9)</span>などでよく用いられています。</span>
<span id="cb102-358"><a href="#cb102-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-359"><a href="#cb102-359" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_pointrange関数でフォレストプロット"}</span></span>
<span id="cb102-360"><a href="#cb102-360" aria-hidden="true" tabindex="-1"></a><span class="in">p + geom_pointrange()</span></span>
<span id="cb102-361"><a href="#cb102-361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-362"><a href="#cb102-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-363"><a href="#cb102-363" aria-hidden="true" tabindex="-1"></a>棒グラフにもエラーバーを付けることはできます。棒グラフにエラーバーを付ける時には、<span class="in">`stat="identity"`</span>で指定した<span class="in">`geom_bar`</span>に、<span class="in">`+`</span>で<span class="in">`geom_errorbar`</span>や<span class="in">`geom_linerange`</span>をつなげます。</span>
<span id="cb102-364"><a href="#cb102-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-365"><a href="#cb102-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="棒グラフにエラーバーをつける"}</span></span>
<span id="cb102-366"><a href="#cb102-366" aria-hidden="true" tabindex="-1"></a><span class="in">p +</span></span>
<span id="cb102-367"><a href="#cb102-367" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity") +</span></span>
<span id="cb102-368"><a href="#cb102-368" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_linerange()</span></span>
<span id="cb102-369"><a href="#cb102-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-370"><a href="#cb102-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-371"><a href="#cb102-371" aria-hidden="true" tabindex="-1"></a><span class="fu">#### position="dodge"とエラーバーの位置</span></span>
<span id="cb102-372"><a href="#cb102-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-373"><a href="#cb102-373" aria-hidden="true" tabindex="-1"></a>複数のタイプのデータに対して棒グラフを横に並べて描画し、その棒グラフにエラーバーを付けたい、という場合もあります。<span class="in">`geom_bar`</span>のデフォルトは<span class="in">`position="stack"`</span>ですので、複数のタイプのデータを表示するときには積み上げ式の棒グラフが描画されます。横に棒グラフを並べる場合には、<span class="in">`position="dodge"`</span>を指定する必要があります。</span>
<span id="cb102-374"><a href="#cb102-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-375"><a href="#cb102-375" aria-hidden="true" tabindex="-1"></a>では、具体的に<span class="in">`position="dodge"`</span>の棒グラフにエラーバーを付与する手順を見ていきましょう。まずは、データフレームでデータを準備する必要があります。<span class="in">`dplyr`</span>や<span class="in">`tidyr`</span>を用いることで、データの準備を比較的簡単に行うことができます。</span>
<span id="cb102-376"><a href="#cb102-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-377"><a href="#cb102-377" aria-hidden="true" tabindex="-1"></a>下の例では、<span class="in">`iris`</span>の<span class="in">`Species`</span>以外のデータ（<span class="in">`Sepal.Length`</span>、<span class="in">`Sepal.Width`</span>、<span class="in">`Petal.Length`</span>、<span class="in">`Petal.Width`</span>）を<span class="in">`pivot_longer`</span>を用いて縦持ちに変換し、データ名と<span class="in">`Species`</span>でグループ化した後、それぞれの平均値と標準偏差を求めています。棒グラフやフォレストプロットの描画の準備では、<span class="in">`pivot_longer`</span>、<span class="in">`group_by`</span>、<span class="in">`summarise`</span>を用いることが多く、データの要約を求める際にも便利な組み合わせです。</span>
<span id="cb102-378"><a href="#cb102-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-379"><a href="#cb102-379" aria-hidden="true" tabindex="-1"></a>具体的にどのように変換しているのか分かりにくければ、<span class="in">`pivot_longer`</span>までと、それ以降を切り離して実行してみると良いでしょう。</span>
<span id="cb102-380"><a href="#cb102-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-381"><a href="#cb102-381" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="要約したデータの準備", message=FALSE, warning=FALSE}</span></span>
<span id="cb102-382"><a href="#cb102-382" aria-hidden="true" tabindex="-1"></a><span class="in">d1 &lt;- </span></span>
<span id="cb102-383"><a href="#cb102-383" aria-hidden="true" tabindex="-1"></a><span class="in">  iris |&gt; </span></span>
<span id="cb102-384"><a href="#cb102-384" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(1:4) |&gt; </span></span>
<span id="cb102-385"><a href="#cb102-385" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(name, Species) |&gt; </span></span>
<span id="cb102-386"><a href="#cb102-386" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(mvalue = mean(value), svalue = sd(value))</span></span>
<span id="cb102-387"><a href="#cb102-387" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb102-388"><a href="#cb102-388" aria-hidden="true" tabindex="-1"></a><span class="in">d1</span></span>
<span id="cb102-389"><a href="#cb102-389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-390"><a href="#cb102-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-391"><a href="#cb102-391" aria-hidden="true" tabindex="-1"></a>上で作成したデータフレームを用いて、<span class="in">`ggplot2`</span>でグラフを描画します。まずは<span class="in">`ggplot`</span>関数で<span class="in">`aes`</span>を設定していきます。<span class="in">`x`</span>軸に<span class="in">`Species`</span>、<span class="in">`y`</span>軸に平均値とエラーバーの要素に平均値±標準偏差（<span class="in">`ymin`</span>、<span class="in">`ymax`</span>）、棒の枠の色（<span class="in">`color`</span>）と棒の中身の色（<span class="in">`fill`</span>）にデータ名を設定しておきます。</span>
<span id="cb102-392"><a href="#cb102-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-393"><a href="#cb102-393" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="ggplot関数の準備"}</span></span>
<span id="cb102-394"><a href="#cb102-394" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- d1 |&gt; </span></span>
<span id="cb102-395"><a href="#cb102-395" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(</span></span>
<span id="cb102-396"><a href="#cb102-396" aria-hidden="true" tabindex="-1"></a><span class="in">    aes(</span></span>
<span id="cb102-397"><a href="#cb102-397" aria-hidden="true" tabindex="-1"></a><span class="in">      x = Species, </span></span>
<span id="cb102-398"><a href="#cb102-398" aria-hidden="true" tabindex="-1"></a><span class="in">      y  =mvalue, </span></span>
<span id="cb102-399"><a href="#cb102-399" aria-hidden="true" tabindex="-1"></a><span class="in">      ymax = mvalue + svalue, </span></span>
<span id="cb102-400"><a href="#cb102-400" aria-hidden="true" tabindex="-1"></a><span class="in">      ymin = mvalue - svalue,</span></span>
<span id="cb102-401"><a href="#cb102-401" aria-hidden="true" tabindex="-1"></a><span class="in">      color = name,</span></span>
<span id="cb102-402"><a href="#cb102-402" aria-hidden="true" tabindex="-1"></a><span class="in">      fill = name</span></span>
<span id="cb102-403"><a href="#cb102-403" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb102-404"><a href="#cb102-404" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb102-405"><a href="#cb102-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-406"><a href="#cb102-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-407"><a href="#cb102-407" aria-hidden="true" tabindex="-1"></a>この<span class="in">`ggplot`</span>関数に、<span class="in">`geom_bar`</span>と<span class="in">`geom_linerange`</span>を<span class="in">`+`</span>でつなげると、下の図のように、積み上げ式棒グラフの下の方にエラーバーが重なって表示される、変なグラフが作成されます。これは、<span class="in">`geom_bar`</span>の引数の設定が<span class="in">`position="stack"`</span>であるため積み上げ式棒グラフとなる一方で、<span class="in">`geom_linerange`</span>などのエラーバーを指定する<span class="in">`geom`</span>関数には積み上げ式の設定がないためです。</span>
<span id="cb102-408"><a href="#cb102-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-409"><a href="#cb102-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="positionを指定しない場合"}</span></span>
<span id="cb102-410"><a href="#cb102-410" aria-hidden="true" tabindex="-1"></a><span class="in"># positionを指定しないと、積み上げ式棒グラフになる</span></span>
<span id="cb102-411"><a href="#cb102-411" aria-hidden="true" tabindex="-1"></a><span class="in">p1 +</span></span>
<span id="cb102-412"><a href="#cb102-412" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity") +</span></span>
<span id="cb102-413"><a href="#cb102-413" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_linerange()</span></span>
<span id="cb102-414"><a href="#cb102-414" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-415"><a href="#cb102-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-416"><a href="#cb102-416" aria-hidden="true" tabindex="-1"></a><span class="in">`position`</span>に<span class="in">`"dodge"`</span>を指定すると、棒グラフは積み上げ式ではなく、横に並べる形となります。このとき、エラーバーは棒グラフの真ん中に配置されてしまい、どの棒グラフのエラーバーなのかわからなくなります。これは、<span class="in">`geom_linerange`</span>の<span class="in">`position`</span>の設定が正しく行われていないためです。</span>
<span id="cb102-417"><a href="#cb102-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-418"><a href="#cb102-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="positionをdodgeに指定した場合"}</span></span>
<span id="cb102-419"><a href="#cb102-419" aria-hidden="true" tabindex="-1"></a><span class="in">p1 +</span></span>
<span id="cb102-420"><a href="#cb102-420" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity", position="dodge") +</span></span>
<span id="cb102-421"><a href="#cb102-421" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_linerange()</span></span>
<span id="cb102-422"><a href="#cb102-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-423"><a href="#cb102-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-424"><a href="#cb102-424" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_linerange`</span>を含む、エラーバーを描画するための<span class="in">`geom`</span>関数の<span class="in">`position`</span>の指定には、<span class="in">`position_dodge`</span>関数を用います。<span class="in">`position=position_dodge(width=0.9)`</span>という形で<span class="in">`geom_linerange`</span>の<span class="in">`position`</span>を指定すると、エラーバーが正しい位置（棒グラフの真ん中）に配置されます。やや複雑ですし、<span class="in">`width=0.9`</span>の意味はよくわからないのですが、この方法は<span class="in">`ggplot2`</span>の<span class="co">[</span><span class="ot">Reference</span><span class="co">](https://ggplot2.tidyverse.org/reference/geom_linerange.html)</span>にも記載されています。</span>
<span id="cb102-425"><a href="#cb102-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-426"><a href="#cb102-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="position_dodge(width=0.9)を指定"}</span></span>
<span id="cb102-427"><a href="#cb102-427" aria-hidden="true" tabindex="-1"></a><span class="in">p1 +</span></span>
<span id="cb102-428"><a href="#cb102-428" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity", position = "dodge") +</span></span>
<span id="cb102-429"><a href="#cb102-429" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_linerange(position = position_dodge(width = 0.9))</span></span>
<span id="cb102-430"><a href="#cb102-430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-431"><a href="#cb102-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-432"><a href="#cb102-432" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip collapse="true"}</span>
<span id="cb102-433"><a href="#cb102-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-434"><a href="#cb102-434" aria-hidden="true" tabindex="-1"></a><span class="fu">## 棒グラフとエラーバー</span></span>
<span id="cb102-435"><a href="#cb102-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-436"><a href="#cb102-436" aria-hidden="true" tabindex="-1"></a>上記のように、棒グラフとエラーバーの色を同じにすると、エラーバーの下側が見えなくなります。このようなグラフ（ダイナマイトっぽい形をしているので、ダイナマイトプロットと呼ばれます）では、エラーバーで示したい範囲が不明瞭となるため、データ表示の方法としては良くないとされています。点と線で表すフォレストプロット（<span class="in">`geom_pointrange`</span>）を用いたほうが、棒グラフとエラーバーを用いるより、データの表示方法としては優れています。</span>
<span id="cb102-437"><a href="#cb102-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-438"><a href="#cb102-438" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb102-439"><a href="#cb102-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-440"><a href="#cb102-440" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_bin2d</span></span>
<span id="cb102-441"><a href="#cb102-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-442"><a href="#cb102-442" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_bin2d`</span>は<span class="in">`x`</span>軸、<span class="in">`y`</span>軸に値を設定し、<span class="in">`x`</span>・<span class="in">`y`</span>それぞれの値のデータを度数分布に変換した上で、度数を2次元グラフ上に色で示すものです。2次元で表示するヒストグラムにあたります。ただし、下の図のようにデータが多く、分布が薄く広がっている場合には度数の差が分かりにくくなってしまいます。</span>
<span id="cb102-443"><a href="#cb102-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-444"><a href="#cb102-444" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_bin2dで二次元ヒストグラム"}</span></span>
<span id="cb102-445"><a href="#cb102-445" aria-hidden="true" tabindex="-1"></a><span class="in">diamonds |&gt; </span></span>
<span id="cb102-446"><a href="#cb102-446" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x=carat, y=price)) +</span></span>
<span id="cb102-447"><a href="#cb102-447" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bin2d()</span></span>
<span id="cb102-448"><a href="#cb102-448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-449"><a href="#cb102-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-450"><a href="#cb102-450" aria-hidden="true" tabindex="-1"></a>このようなデータで度数を調べる場合には、<span class="in">`geom_point`</span>と透明化を指定する引数である<span class="in">`alpha`</span>を用いるのが良いでしょう。<span class="in">`alpha`</span>を小さい値に指定すると、度数の多いところは濃い色で、度数が小さいところは薄い色で表示されます。下のグラフは上の<span class="in">`geom_bin2d`</span>と同じものを表現していますが、こちらの方がデータの分布としては理解しやすいことがわかるかと思います。</span>
<span id="cb102-451"><a href="#cb102-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-452"><a href="#cb102-452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="alphaで半透明化"}</span></span>
<span id="cb102-453"><a href="#cb102-453" aria-hidden="true" tabindex="-1"></a><span class="in">diamonds |&gt; </span></span>
<span id="cb102-454"><a href="#cb102-454" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x=carat, y=price)) +</span></span>
<span id="cb102-455"><a href="#cb102-455" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(alpha=0.004)</span></span>
<span id="cb102-456"><a href="#cb102-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-457"><a href="#cb102-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-458"><a href="#cb102-458" aria-hidden="true" tabindex="-1"></a>棒グラフと同様に、<span class="in">`geom_bin2d`</span>も<span class="in">`stat="identity"`</span>と指定することで、数値をそのまま色とするグラフを作成することができます。下の例では、<span class="in">`volcano`</span>データセット（マウンガファウの南北・東西の位置と標高のデータ）を変形し、<span class="in">`geom_bin2d`</span>で描画したものです。このように<span class="in">`stat="identity"`</span>を用いれば、<span class="in">`geom_bin2d`</span>を用いてヒートマップを作成することもできます。</span>
<span id="cb102-459"><a href="#cb102-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-460"><a href="#cb102-460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_bin2dでヒートマップを描画"}</span></span>
<span id="cb102-461"><a href="#cb102-461" aria-hidden="true" tabindex="-1"></a><span class="in">volcano |&gt; </span></span>
<span id="cb102-462"><a href="#cb102-462" aria-hidden="true" tabindex="-1"></a><span class="in">  as.data.frame() |&gt; </span></span>
<span id="cb102-463"><a href="#cb102-463" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(y = 1:nrow(volcano)) |&gt; </span></span>
<span id="cb102-464"><a href="#cb102-464" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(1:ncol(volcano), values_to = "altitude", names_to = "x") |&gt; </span></span>
<span id="cb102-465"><a href="#cb102-465" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(x = as.numeric(str_remove_all(x, "V"))) |&gt; </span></span>
<span id="cb102-466"><a href="#cb102-466" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = as.numeric(x), y = y, color = altitude, fill = altitude)) +</span></span>
<span id="cb102-467"><a href="#cb102-467" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_bin2d(stat = "identity")</span></span>
<span id="cb102-468"><a href="#cb102-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-469"><a href="#cb102-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-470"><a href="#cb102-470" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_contour</span></span>
<span id="cb102-471"><a href="#cb102-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-472"><a href="#cb102-472" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_contour`</span>はRの<span class="in">`contour`</span>関数と同じく、標高線で示された図を表記するのに用いる関数です。<span class="in">`geom_bin2d`</span>とは異なり、<span class="in">`aes`</span>には3つの値（<span class="in">`x`</span>、<span class="in">`y`</span>、<span class="in">`z`</span>）を指定する必要があります。</span>
<span id="cb102-473"><a href="#cb102-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-474"><a href="#cb102-474" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_contourで等高線グラフを作成"}</span></span>
<span id="cb102-475"><a href="#cb102-475" aria-hidden="true" tabindex="-1"></a><span class="in">volcano |&gt; </span></span>
<span id="cb102-476"><a href="#cb102-476" aria-hidden="true" tabindex="-1"></a><span class="in">  as.data.frame() |&gt; </span></span>
<span id="cb102-477"><a href="#cb102-477" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(y = 1:nrow(volcano)) |&gt; </span></span>
<span id="cb102-478"><a href="#cb102-478" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(1:ncol(volcano), values_to = "altitude", names_to = "x") |&gt; </span></span>
<span id="cb102-479"><a href="#cb102-479" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(x = as.numeric(str_remove_all(x, "V"))) |&gt; </span></span>
<span id="cb102-480"><a href="#cb102-480" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = as.numeric(x), y = y, z = altitude)) +</span></span>
<span id="cb102-481"><a href="#cb102-481" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_contour()</span></span>
<span id="cb102-482"><a href="#cb102-482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-483"><a href="#cb102-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-484"><a href="#cb102-484" aria-hidden="true" tabindex="-1"></a>Rデフォルトの<span class="in">`filled.contour`</span>関数と同様に、等高線に色を合わせて表示するようなグラフを作成する場合には、<span class="in">`geom_contour_filled`</span>を用います。<span class="in">`geom_contour_filled`</span>を用いることで、<span class="in">`z`</span>の値に従い色分けされたグラフを描画することができます。</span>
<span id="cb102-485"><a href="#cb102-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-486"><a href="#cb102-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_contour_filledで色付き等高線グラフを作成"}</span></span>
<span id="cb102-487"><a href="#cb102-487" aria-hidden="true" tabindex="-1"></a><span class="in">volcano |&gt; </span></span>
<span id="cb102-488"><a href="#cb102-488" aria-hidden="true" tabindex="-1"></a><span class="in">  as.data.frame() |&gt; </span></span>
<span id="cb102-489"><a href="#cb102-489" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(y = 1:nrow(volcano)) |&gt; </span></span>
<span id="cb102-490"><a href="#cb102-490" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(1:ncol(volcano), values_to = "altitude", names_to = "x") |&gt; </span></span>
<span id="cb102-491"><a href="#cb102-491" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(x = as.numeric(str_remove_all(x, "V"))) |&gt; </span></span>
<span id="cb102-492"><a href="#cb102-492" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = as.numeric(x), y = y, z = altitude)) +</span></span>
<span id="cb102-493"><a href="#cb102-493" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_contour_filled()</span></span>
<span id="cb102-494"><a href="#cb102-494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-495"><a href="#cb102-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-496"><a href="#cb102-496" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_map</span></span>
<span id="cb102-497"><a href="#cb102-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-498"><a href="#cb102-498" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_map`</span>は地図を表示するための関数です。地図を表記するためには、地図データ、つまり緯度、経度とその場所のIDを記録したもの、を準備する必要があります。</span>
<span id="cb102-499"><a href="#cb102-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-500"><a href="#cb102-500" aria-hidden="true" tabindex="-1"></a>Rで地図データを用いる場合には、<span class="in">`maps`</span>パッケージ<span class="co">[</span><span class="ot">@maps_bib</span><span class="co">]</span>を利用するのが比較的簡単です。<span class="in">`maps`</span>パッケージには世界地図、アメリカの州の地図、フランスやイタリア、ニュージーランドなどの地図が登録されています。<span class="in">`maps`</span>パッケージの地図を<span class="in">`ggplot2`</span>で用いる場合には、<span class="in">`ggplot2`</span>で使用できるデータフレームに変換してくれる<span class="in">`maps`</span>パッケージの関数である、<span class="in">`map_data`</span>を用います。</span>
<span id="cb102-501"><a href="#cb102-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-502"><a href="#cb102-502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="mapパッケージで地図データの読み込み"}</span></span>
<span id="cb102-503"><a href="#cb102-503" aria-hidden="true" tabindex="-1"></a><span class="in">pacman::p_load(maps)</span></span>
<span id="cb102-504"><a href="#cb102-504" aria-hidden="true" tabindex="-1"></a><span class="in">state &lt;- map_data("state") # アメリカの州データをggplot用に変換</span></span>
<span id="cb102-505"><a href="#cb102-505" aria-hidden="true" tabindex="-1"></a><span class="in">head(state) # 緯度（lat）、経度（long）などを含むデータフレーム</span></span>
<span id="cb102-506"><a href="#cb102-506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-507"><a href="#cb102-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-508"><a href="#cb102-508" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>では、<span class="in">`map_data`</span>で変換したデータフレームを<span class="in">`ggplot`</span>関数の引数にするのではなく、<span class="in">`map_data`</span>で<span class="in">`region`</span>に指定されているラベル（地域）を含むデータフレームを用います。</span>
<span id="cb102-509"><a href="#cb102-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-510"><a href="#cb102-510" aria-hidden="true" tabindex="-1"></a><span class="in">`USArrests`</span>はアメリカの州別の10万人あたりの犯罪件数を記録したデータフレームです。このデータフレームの行名が州名になっているので、これをデータフレームの列に追加し、<span class="in">`state`</span>と表記を合わせるために小文字に変換します。</span>
<span id="cb102-511"><a href="#cb102-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-512"><a href="#cb102-512" aria-hidden="true" tabindex="-1"></a><span class="in">`aes`</span>では、<span class="in">`map_id=state`</span>とし、地図IDを指定します。さらに、<span class="in">`fill`</span>には<span class="in">`USArrests`</span>の列名である<span class="in">`Murder`</span>（殺人の件数）を指定します。この形で指定することで、<span class="in">`Murder`</span>の値が色で示されることになります。</span>
<span id="cb102-513"><a href="#cb102-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-514"><a href="#cb102-514" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_map`</span>では、さらに<span class="in">`map`</span>という引数に、<span class="in">`map_data`</span>の返り値（<span class="in">`state`</span>）を指定する必要があります。こうすることで、<span class="in">`geom_map`</span>は<span class="in">`state`</span>を基準に地図を描画し、地図の色に<span class="in">`fill`</span>で指定した<span class="in">`Murder`</span>の値を適用します。</span>
<span id="cb102-515"><a href="#cb102-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-516"><a href="#cb102-516" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_map関数"}</span></span>
<span id="cb102-517"><a href="#cb102-517" aria-hidden="true" tabindex="-1"></a><span class="in"># coord_sfを用いるためにsfパッケージをロードする</span></span>
<span id="cb102-518"><a href="#cb102-518" aria-hidden="true" tabindex="-1"></a><span class="in">pacman::p_load(sf)</span></span>
<span id="cb102-519"><a href="#cb102-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-520"><a href="#cb102-520" aria-hidden="true" tabindex="-1"></a><span class="in">USArrests |&gt; </span></span>
<span id="cb102-521"><a href="#cb102-521" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(state = tolower(rownames(USArrests))) |&gt; </span></span>
<span id="cb102-522"><a href="#cb102-522" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(map_id = state, fill = Murder)) +</span></span>
<span id="cb102-523"><a href="#cb102-523" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_map(map = state) +</span></span>
<span id="cb102-524"><a href="#cb102-524" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(</span></span>
<span id="cb102-525"><a href="#cb102-525" aria-hidden="true" tabindex="-1"></a><span class="in">      crs = 5070, default_crs = 4326,</span></span>
<span id="cb102-526"><a href="#cb102-526" aria-hidden="true" tabindex="-1"></a><span class="in">      xlim = c(-125, -70), ylim = c(25, 52)</span></span>
<span id="cb102-527"><a href="#cb102-527" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb102-528"><a href="#cb102-528" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-529"><a href="#cb102-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-530"><a href="#cb102-530" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_sf</span></span>
<span id="cb102-531"><a href="#cb102-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-532"><a href="#cb102-532" aria-hidden="true" tabindex="-1"></a>上記のようにすれば、地図を表記することはできますが、やや煩雑です。近年のRでは、地図データを扱う際には、地図データ取り扱いの専用クラスである**`sf`（simple features）**を用いるのが一般的になっています。この<span class="in">`sf`</span>を用いれば、グラフをより簡単に作成することができます。</span>
<span id="cb102-533"><a href="#cb102-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-534"><a href="#cb102-534" aria-hidden="true" tabindex="-1"></a><span class="in">`sf`</span>クラスは、<span class="in">`sf`</span>パッケージ<span class="co">[</span><span class="ot">@sf_bib1; @sf_bib2</span><span class="co">]</span>で定義されているクラスです。<span class="in">`sf`</span>を使用する際には、まず<span class="in">`sf`</span>パッケージを読み込みます。</span>
<span id="cb102-535"><a href="#cb102-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-536"><a href="#cb102-536" aria-hidden="true" tabindex="-1"></a><span class="in">`sf`</span>パッケージをインストールすると、<span class="in">`sf`</span>パッケージ内にある地図データにアクセスできます。下の例では、<span class="in">`sf`</span>パッケージのフォルダ内にある地図データ（North Carolinaのsfデータ）を読み込んでいます。</span>
<span id="cb102-537"><a href="#cb102-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-538"><a href="#cb102-538" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="sfパッケージのデータを読み込み"}</span></span>
<span id="cb102-539"><a href="#cb102-539" aria-hidden="true" tabindex="-1"></a><span class="in"># system.fileはパッケージからフルパスを読み込む関数</span></span>
<span id="cb102-540"><a href="#cb102-540" aria-hidden="true" tabindex="-1"></a><span class="in">fname &lt;- system.file("shape/nc.shp", package="sf")</span></span>
<span id="cb102-541"><a href="#cb102-541" aria-hidden="true" tabindex="-1"></a><span class="in">nc &lt;- st_read(fname) # North Carolinaのsfデータ</span></span>
<span id="cb102-542"><a href="#cb102-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-543"><a href="#cb102-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-544"><a href="#cb102-544" aria-hidden="true" tabindex="-1"></a><span class="in">`sf`</span>は基本的にデータフレームで、<span class="in">`geometry`</span>という列を持っています。この列は、<span class="in">`sfc`</span>クラスのデータです。<span class="in">`sfc`</span>クラスはその行に対応する緯度・経度のセットを専用の表記法で示したものとなります。<span class="in">`sf`</span>を用いる場合には、この<span class="in">`geometry`</span>が地図データを表現する列になります。</span>
<span id="cb102-545"><a href="#cb102-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-546"><a href="#cb102-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="sfのデータ"}</span></span>
<span id="cb102-547"><a href="#cb102-547" aria-hidden="true" tabindex="-1"></a><span class="in">class(nc) # sfはデータフレームの一種</span></span>
<span id="cb102-548"><a href="#cb102-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-549"><a href="#cb102-549" aria-hidden="true" tabindex="-1"></a><span class="in">nc # geometryという列に地図データが格納されている</span></span>
<span id="cb102-550"><a href="#cb102-550" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-551"><a href="#cb102-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-552"><a href="#cb102-552" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>で<span class="in">`sf`</span>を用いてグラフを描画する場合には、<span class="in">`geom_sf`</span>関数を用います。<span class="in">`geom_sf`</span>関数を用いてグラフを作成する場合には、<span class="in">`ggplot`</span>関数の引数となるデータフレームに<span class="in">`sf`</span>、<span class="in">`aes`</span>に<span class="in">`sf`</span>に含まれる列を指定します。<span class="in">`sf`</span>を用いれば、このようなシンプルな表記法で<span class="in">`geom_map`</span>よりも簡単に地図を表記することができます。</span>
<span id="cb102-553"><a href="#cb102-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-554"><a href="#cb102-554" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_sf関数でsfデータを描画"}</span></span>
<span id="cb102-555"><a href="#cb102-555" aria-hidden="true" tabindex="-1"></a><span class="in"># sfを用いたグラフの表記</span></span>
<span id="cb102-556"><a href="#cb102-556" aria-hidden="true" tabindex="-1"></a><span class="in">nc |&gt; </span></span>
<span id="cb102-557"><a href="#cb102-557" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot() +</span></span>
<span id="cb102-558"><a href="#cb102-558" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(aes(fill = AREA))</span></span>
<span id="cb102-559"><a href="#cb102-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-560"><a href="#cb102-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-561"><a href="#cb102-561" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip collapse="true"}</span>
<span id="cb102-562"><a href="#cb102-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-563"><a href="#cb102-563" aria-hidden="true" tabindex="-1"></a><span class="fu">## Rでの地図描画ライブラリ</span></span>
<span id="cb102-564"><a href="#cb102-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-565"><a href="#cb102-565" aria-hidden="true" tabindex="-1"></a><span class="in">`sf`</span>は2018年に発表された、比較的新しいパッケージです。<span class="in">`sf`</span>が出てくるまでは、Rで地図データを取り扱う方法は様々で、統一されているという感はありませんでしたが、今後は<span class="in">`sf`</span>がデフォルトの地図データ取り扱い方法になっていくのではないかと思います。地図データの取扱いに関してはオンラインの英語の教科書（<span class="co">[</span><span class="ot">Geocomputation with R</span><span class="co">](https://bookdown.org/robinlovelace/geocompr/)</span>）があり、日本語訳（<span class="co">[</span><span class="ot">Geocomputation with R (日本語版)</span><span class="co">](http://124.219.182.167/geo/)</span>）も公開されています。</span>
<span id="cb102-566"><a href="#cb102-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-567"><a href="#cb102-567" aria-hidden="true" tabindex="-1"></a>地図表示のためのライブラリには<span class="in">`ggplot2`</span>だけでなく、<span class="co">[</span><span class="ot">Leaflet for R</span><span class="co">](https://rstudio.github.io/leaflet/)</span>というJavascriptの地図ライブラリをRで利用できるようにしたものや、<span class="in">`ggplot2`</span>風の記法で色々なデザインのグラフを描画できる<span class="co">[</span><span class="ot">tmap</span><span class="co">](https://r-tmap.github.io/tmap/)</span>などもあります。<span class="in">`sf`</span>、<span class="in">`leaflet`</span>、<span class="in">`tmap`</span>については<span class="co">[</span><span class="ot">32章</span><span class="co">](./chapter32.html)</span>で説明します。</span>
<span id="cb102-568"><a href="#cb102-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-569"><a href="#cb102-569" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb102-570"><a href="#cb102-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-571"><a href="#cb102-571" aria-hidden="true" tabindex="-1"></a><span class="fu">### geom_polygon</span></span>
<span id="cb102-572"><a href="#cb102-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-573"><a href="#cb102-573" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_polygon`</span>は多角形を描画するための関数です。データフレームには、多角形の各頂点に当たるxとyの座標を指定します。</span>
<span id="cb102-574"><a href="#cb102-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-575"><a href="#cb102-575" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_polygon関数"}</span></span>
<span id="cb102-576"><a href="#cb102-576" aria-hidden="true" tabindex="-1"></a><span class="in"># 頂点のx、y座標を指定する</span></span>
<span id="cb102-577"><a href="#cb102-577" aria-hidden="true" tabindex="-1"></a><span class="in">d2 &lt;- data.frame(x = c(1, 1.25, 1.75, 2), y = c(1, 2, 2, 1))</span></span>
<span id="cb102-578"><a href="#cb102-578" aria-hidden="true" tabindex="-1"></a><span class="in">d2</span></span>
<span id="cb102-579"><a href="#cb102-579" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-580"><a href="#cb102-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-581"><a href="#cb102-581" aria-hidden="true" tabindex="-1"></a><span class="in">`aes`</span>で頂点の<span class="in">`x`</span>、<span class="in">`y`</span>座標を指定すると、多角形を描画することができます。低レベルグラフィック関数である<span class="in">`polygon`</span>関数と類似した描画の方法になっています。</span>
<span id="cb102-582"><a href="#cb102-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-583"><a href="#cb102-583" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_polygonで多角形を描画"}</span></span>
<span id="cb102-584"><a href="#cb102-584" aria-hidden="true" tabindex="-1"></a><span class="in">d2 |&gt; </span></span>
<span id="cb102-585"><a href="#cb102-585" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = x, y = y)) +</span></span>
<span id="cb102-586"><a href="#cb102-586" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_polygon()</span></span>
<span id="cb102-587"><a href="#cb102-587" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-588"><a href="#cb102-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-589"><a href="#cb102-589" aria-hidden="true" tabindex="-1"></a><span class="fu">## 色の設定</span></span>
<span id="cb102-590"><a href="#cb102-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-591"><a href="#cb102-591" aria-hidden="true" tabindex="-1"></a>上で説明したように、<span class="in">`ggplot2`</span>で色を指定するときには、<span class="in">`aes`</span>中で<span class="in">`color`</span>、<span class="in">`fill`</span>の引数を指定します。<span class="in">`color`</span>、<span class="in">`fill`</span>は数値または因子を指定することができ、点や面を数値・因子に対応した色で表示することができます。</span>
<span id="cb102-592"><a href="#cb102-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-593"><a href="#cb102-593" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_point`</span>などの点を描画する場合では、<span class="in">`color`</span>のみを指定します。</span>
<span id="cb102-594"><a href="#cb102-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-595"><a href="#cb102-595" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="colorに因子を指定"}</span></span>
<span id="cb102-596"><a href="#cb102-596" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-597"><a href="#cb102-597" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width, color = Species)) +</span></span>
<span id="cb102-598"><a href="#cb102-598" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point()</span></span>
<span id="cb102-599"><a href="#cb102-599" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-600"><a href="#cb102-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-601"><a href="#cb102-601" aria-hidden="true" tabindex="-1"></a><span class="in">`color`</span>引数に数値を指定すると、数値に従い色の濃度が変わります。</span>
<span id="cb102-602"><a href="#cb102-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-603"><a href="#cb102-603" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="colorに数値を指定"}</span></span>
<span id="cb102-604"><a href="#cb102-604" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-605"><a href="#cb102-605" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width, color = Petal.Length)) +</span></span>
<span id="cb102-606"><a href="#cb102-606" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point()</span></span>
<span id="cb102-607"><a href="#cb102-607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-608"><a href="#cb102-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-609"><a href="#cb102-609" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_bar`</span>では、<span class="in">`color`</span>だけを指定すると、棒グラフの枠だけに色がつきます。</span>
<span id="cb102-610"><a href="#cb102-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-611"><a href="#cb102-611" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_barでcolorだけを指定した場合"}</span></span>
<span id="cb102-612"><a href="#cb102-612" aria-hidden="true" tabindex="-1"></a><span class="in">d1 |&gt; </span></span>
<span id="cb102-613"><a href="#cb102-613" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Species, y = mvalue, color = name)) +</span></span>
<span id="cb102-614"><a href="#cb102-614" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity", position = "dodge")</span></span>
<span id="cb102-615"><a href="#cb102-615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-616"><a href="#cb102-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-617"><a href="#cb102-617" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_bar`</span>で、棒グラフの中身の色を変えたい時には、<span class="in">`fill`</span>引数を指定する必要があります。</span>
<span id="cb102-618"><a href="#cb102-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-619"><a href="#cb102-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_barでfillを指定した場合"}</span></span>
<span id="cb102-620"><a href="#cb102-620" aria-hidden="true" tabindex="-1"></a><span class="in">d1 |&gt; </span></span>
<span id="cb102-621"><a href="#cb102-621" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Species, y = mvalue, color = name, fill = name)) +</span></span>
<span id="cb102-622"><a href="#cb102-622" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity", position = "dodge")</span></span>
<span id="cb102-623"><a href="#cb102-623" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-624"><a href="#cb102-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-625"><a href="#cb102-625" aria-hidden="true" tabindex="-1"></a><span class="fu">### color brewer</span></span>
<span id="cb102-626"><a href="#cb102-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-627"><a href="#cb102-627" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>では、<span class="in">`color`</span>や<span class="in">`fill`</span>に引数を指定すれば、特に色の指定をしなくても、いい感じの色でグラフを作成してくれます。ただし、デフォルトの色では見にくい時や、デザイン的に別の色を用いたい場合もあります。色を別途指定したい場合には、<span class="co">[</span><span class="ot">ColorBrewer</span><span class="co">](https://colorbrewer2.org/#type=sequential&amp;scheme=BuGn&amp;n=3)</span>を用いた色の設定を行います。</span>
<span id="cb102-628"><a href="#cb102-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-629"><a href="#cb102-629" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>でColorBrewerに従った色を用いる場合には、<span class="in">`scale_color_brewer`</span>を用います。通常の<span class="in">`geom`</span>関数と同様に、<span class="in">`scale_color_brewer`</span>も<span class="in">`+`</span>で繋いで用います。同様に、<span class="in">`fill`</span>に指定した色の配色を変えたい場合には、<span class="in">`scale_fill_brewer`</span>を用います。</span>
<span id="cb102-630"><a href="#cb102-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-631"><a href="#cb102-631" aria-hidden="true" tabindex="-1"></a>色の指定には<span class="in">`palette`</span>引数を用います。<span class="in">`palette`</span>引数には、カラーパレットを指定する文字列を指定します。カラーパレットの種類はヘルプ（<span class="in">`?scale_color_brewer`</span>）から確認できます。</span>
<span id="cb102-632"><a href="#cb102-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-633"><a href="#cb102-633" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="scale_color_brewerで色を変更"}</span></span>
<span id="cb102-634"><a href="#cb102-634" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-635"><a href="#cb102-635" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width, color = Species)) +</span></span>
<span id="cb102-636"><a href="#cb102-636" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb102-637"><a href="#cb102-637" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_brewer(palette = "Set1")</span></span>
<span id="cb102-638"><a href="#cb102-638" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-639"><a href="#cb102-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-640"><a href="#cb102-640" aria-hidden="true" tabindex="-1"></a><span class="in">`color`</span>に数値を指定した場合には、<span class="in">`scale_color_distiller`</span>で色を指定します。<span class="in">`fill`</span>に数値を指定する場合には、<span class="in">`scale_fill_distiller`</span>を用います。</span>
<span id="cb102-641"><a href="#cb102-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-642"><a href="#cb102-642" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="scale_color_distillerで色を変更"}</span></span>
<span id="cb102-643"><a href="#cb102-643" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-644"><a href="#cb102-644" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width, color = Petal.Length)) +</span></span>
<span id="cb102-645"><a href="#cb102-645" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb102-646"><a href="#cb102-646" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_distiller(palette = "RdYlBu")</span></span>
<span id="cb102-647"><a href="#cb102-647" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-648"><a href="#cb102-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-649"><a href="#cb102-649" aria-hidden="true" tabindex="-1"></a><span class="fu">## 点のサイズ</span></span>
<span id="cb102-650"><a href="#cb102-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-651"><a href="#cb102-651" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_point`</span>などで点のサイズを変更する場合には、<span class="in">`size`</span>引数を指定します。</span>
<span id="cb102-652"><a href="#cb102-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-653"><a href="#cb102-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="sizeで点のサイズを指定"}</span></span>
<span id="cb102-654"><a href="#cb102-654" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-655"><a href="#cb102-655" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width, color = Species)) +</span></span>
<span id="cb102-656"><a href="#cb102-656" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(size = 10)</span></span>
<span id="cb102-657"><a href="#cb102-657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-658"><a href="#cb102-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-659"><a href="#cb102-659" aria-hidden="true" tabindex="-1"></a><span class="in">`size`</span>引数は<span class="in">`aes`</span>内で、数値の列名を取る形でも宣言できます。<span class="in">`aes`</span>内で数値で指定した場合には、その数値に応じた点のサイズで表示されます。このように点のサイズを列名で指定することで、3つの要素（<span class="in">`x`</span>、<span class="in">`y`</span>、<span class="in">`size`</span>）を3次元グラフを用いることなく表現することができます。このようなグラフのことを**バブルチャート**と呼びます。</span>
<span id="cb102-660"><a href="#cb102-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-661"><a href="#cb102-661" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="sizeに数値を指定する"}</span></span>
<span id="cb102-662"><a href="#cb102-662" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-663"><a href="#cb102-663" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width, color = Species, size = Petal.Length)) +</span></span>
<span id="cb102-664"><a href="#cb102-664" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point()</span></span>
<span id="cb102-665"><a href="#cb102-665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-666"><a href="#cb102-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-667"><a href="#cb102-667" aria-hidden="true" tabindex="-1"></a><span class="fu">## 点の透明化</span></span>
<span id="cb102-668"><a href="#cb102-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-669"><a href="#cb102-669" aria-hidden="true" tabindex="-1"></a>点が大きくなると、重なった点は見えなくなります。重なった点を表示する方法には、ジッタープロット（<span class="in">`geom_jitter`</span>）などがありますが、x軸もy軸も数値の場合には、位置がランダムに変化することで正確な値を示さなくなります。</span>
<span id="cb102-670"><a href="#cb102-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-671"><a href="#cb102-671" aria-hidden="true" tabindex="-1"></a>重なった点を適切に表示する場合、**透明化**が有効となる場合があります。上で説明した通り、透明化を指定する引数は<span class="in">`alpha`</span>です。<span class="in">`alpha`</span>には0～1までの値を指定することができ、0では完全に透明、1では完全に不透明の点を表示することになります。</span>
<span id="cb102-672"><a href="#cb102-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-673"><a href="#cb102-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="geom_point中でalphaを指定"}</span></span>
<span id="cb102-674"><a href="#cb102-674" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-675"><a href="#cb102-675" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width, color = Species)) +</span></span>
<span id="cb102-676"><a href="#cb102-676" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(size = 10, alpha = 0.2)</span></span>
<span id="cb102-677"><a href="#cb102-677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-678"><a href="#cb102-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-679"><a href="#cb102-679" aria-hidden="true" tabindex="-1"></a><span class="fu">## 線の太さとタイプ</span></span>
<span id="cb102-680"><a href="#cb102-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-681"><a href="#cb102-681" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_line`</span>等の線グラフで線の太さを指定する場合には<span class="in">`linewidth`</span>引数を、線のタイプを指定する場合には、<span class="in">`linetype`</span>引数を用います。<span class="in">`linewidth`</span>引数には太さを数値で指定します。<span class="in">`linetype`</span>には、<span class="in">`"solid"`</span>、<span class="in">`"dashed"`</span>、<span class="in">`"dotted"`</span>、<span class="in">`"dotdash"`</span>、<span class="in">`"longdash"`</span>、<span class="in">`"twodash"`</span>の各タイプがあり、それぞれ文字列で指定します。線タイプの詳細については、<span class="in">`vignette("ggplot2-specs")`</span>を実行することで確認できます。</span>
<span id="cb102-682"><a href="#cb102-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-683"><a href="#cb102-683" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="線の太さとタイプの指定"}</span></span>
<span id="cb102-684"><a href="#cb102-684" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-685"><a href="#cb102-685" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width)) +</span></span>
<span id="cb102-686"><a href="#cb102-686" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(linewidth = 1, linetype = "dotted")</span></span>
<span id="cb102-687"><a href="#cb102-687" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-688"><a href="#cb102-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-689"><a href="#cb102-689" aria-hidden="true" tabindex="-1"></a><span class="fu">## グラフの重ね書き</span></span>
<span id="cb102-690"><a href="#cb102-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-691"><a href="#cb102-691" aria-hidden="true" tabindex="-1"></a>グラフの重ね書きを行う場合には、複数の<span class="in">`geom`</span>関数を<span class="in">`+`</span>で繋ぎます。後に指定した<span class="in">`geom`</span>関数が重ね書きの上層（上のレイヤー）に表示されることになります。重ね書きしたグラフの色が下層のグラフの色と同一だと見えなくなってしまうため、通常は色を変えて表示します。</span>
<span id="cb102-692"><a href="#cb102-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-693"><a href="#cb102-693" aria-hidden="true" tabindex="-1"></a>重ね書きするグラフの間でデータが異なる場合には、<span class="in">`ggplot`</span>関数でデータフレーム・<span class="in">`aes`</span>を設定せず、<span class="in">`geom`</span>関数内でそれぞれ<span class="in">`data`</span>・<span class="in">`aes`</span>を指定します。<span class="in">`data`</span>にはデータフレームを指定します。<span class="in">`geom`</span>関数内で別の<span class="in">`data`</span>を指定することで、それぞれの<span class="in">`geom`</span>関数のグラフに別のデータフレームからのデータを用いることもできます。</span>
<span id="cb102-694"><a href="#cb102-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-695"><a href="#cb102-695" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="boxplotとjitterplotを重ね書き"}</span></span>
<span id="cb102-696"><a href="#cb102-696" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-697"><a href="#cb102-697" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Species, y = Sepal.Length)) +</span></span>
<span id="cb102-698"><a href="#cb102-698" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot() +</span></span>
<span id="cb102-699"><a href="#cb102-699" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_jitter(aes(color = Species), width = 0.2)</span></span>
<span id="cb102-700"><a href="#cb102-700" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-701"><a href="#cb102-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-702"><a href="#cb102-702" aria-hidden="true" tabindex="-1"></a><span class="fu">## 複数のグラフの表示：facetting</span></span>
<span id="cb102-703"><a href="#cb102-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-704"><a href="#cb102-704" aria-hidden="true" tabindex="-1"></a>データフレームに異なる要素（因子）のデータが保存されており、要素ごとに別々にグラフにしたい場合には、facetting（facet：宝石のカットの面のこと）を用います。facettingには、<span class="in">`facet_wrap`</span>と<span class="in">`facet_grid`</span>の2つの関数ががあります。<span class="in">`facet_wrap`</span>はデータフレームの要素で分けたグラフを単に並べたもの、<span class="in">`facet_grid`</span>はx、y方向に要素がそろったグラフ群を作成する関数です。</span>
<span id="cb102-705"><a href="#cb102-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-706"><a href="#cb102-706" aria-hidden="true" tabindex="-1"></a><span class="fu">### facet_wrap</span></span>
<span id="cb102-707"><a href="#cb102-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-708"><a href="#cb102-708" aria-hidden="true" tabindex="-1"></a>以下は<span class="in">`facet_wrap`</span>の例です。グラフを分ける要素は、<span class="in">`facet_wrap`</span>内でチルダ（<span class="in">`~`</span>）を用いて指定します。チルダの左側、右側のどちらに要素をおいても問題ありませんが、右側の要素を入力しない場合には、ピリオド（<span class="in">`.`</span>）を入力しておきます。グラフはよい感じに縦・横に並べられ、表示されます。並べる順番は要素の因子（factor）のレベル順となります。</span>
<span id="cb102-709"><a href="#cb102-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-710"><a href="#cb102-710" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="facet_wrap関数"}</span></span>
<span id="cb102-711"><a href="#cb102-711" aria-hidden="true" tabindex="-1"></a><span class="in">d1 |&gt; </span></span>
<span id="cb102-712"><a href="#cb102-712" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Species, y = mvalue)) +</span></span>
<span id="cb102-713"><a href="#cb102-713" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity") +</span></span>
<span id="cb102-714"><a href="#cb102-714" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~ name)</span></span>
<span id="cb102-715"><a href="#cb102-715" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-716"><a href="#cb102-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-717"><a href="#cb102-717" aria-hidden="true" tabindex="-1"></a><span class="fu">#### scalesの指定</span></span>
<span id="cb102-718"><a href="#cb102-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-719"><a href="#cb102-719" aria-hidden="true" tabindex="-1"></a><span class="in">`facet_wrap`</span>を用いたときに、表示するグラフごとに縦軸のスケールを調整する場合には、<span class="in">`scales`</span>引数を指定します。<span class="in">`scales`</span>引数は<span class="in">`facet_wrap`</span>関数内で指定し、<span class="in">`scales="free_y"`</span>ならy方向のスケールが、<span class="in">`scales="free_x"`</span>ならx方向のスケールが、<span class="in">`scales="free"`</span>ならx、y両方のスケールが自動的に調整されます。</span>
<span id="cb102-720"><a href="#cb102-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-721"><a href="#cb102-721" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="facet_wrapでscalesを指定"}</span></span>
<span id="cb102-722"><a href="#cb102-722" aria-hidden="true" tabindex="-1"></a><span class="in"># scalesを指定すると、y軸のスケールがグラフごとに自動調整される</span></span>
<span id="cb102-723"><a href="#cb102-723" aria-hidden="true" tabindex="-1"></a><span class="in">d1 |&gt; </span></span>
<span id="cb102-724"><a href="#cb102-724" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Species, y = mvalue)) +</span></span>
<span id="cb102-725"><a href="#cb102-725" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity") +</span></span>
<span id="cb102-726"><a href="#cb102-726" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~ name, scales = "free_y")</span></span>
<span id="cb102-727"><a href="#cb102-727" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-728"><a href="#cb102-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-729"><a href="#cb102-729" aria-hidden="true" tabindex="-1"></a><span class="fu">### facet_grid</span></span>
<span id="cb102-730"><a href="#cb102-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-731"><a href="#cb102-731" aria-hidden="true" tabindex="-1"></a><span class="in">`facet_grid`</span>では、チルダの左と右の要素でそれぞれy軸方向、x軸方向を指定することになります。縦－横方向の軸の値もそろえられます。</span>
<span id="cb102-732"><a href="#cb102-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-733"><a href="#cb102-733" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="facet_grid関数"}</span></span>
<span id="cb102-734"><a href="#cb102-734" aria-hidden="true" tabindex="-1"></a><span class="in">d1 |&gt; </span></span>
<span id="cb102-735"><a href="#cb102-735" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Species, y = mvalue)) +</span></span>
<span id="cb102-736"><a href="#cb102-736" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity") +</span></span>
<span id="cb102-737"><a href="#cb102-737" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(Species ~ name)</span></span>
<span id="cb102-738"><a href="#cb102-738" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-739"><a href="#cb102-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-740"><a href="#cb102-740" aria-hidden="true" tabindex="-1"></a><span class="fu">## 軸のラベルの調整：labs</span></span>
<span id="cb102-741"><a href="#cb102-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-742"><a href="#cb102-742" aria-hidden="true" tabindex="-1"></a>軸のラベルやタイトル等を設定する場合には、<span class="in">`labs`</span>関数を用います。<span class="in">`labs`</span>関数も<span class="in">`+`</span>で繋いで用います。<span class="in">`x`</span>、<span class="in">`y`</span>、<span class="in">`title`</span>、<span class="in">`subtitle`</span>、<span class="in">`caption`</span>引数を指定することでそれぞれx軸ラベル、y軸ラベル、メインタイトル、サブタイトル、キャプション（注釈）をグラフに追加することができます。</span>
<span id="cb102-743"><a href="#cb102-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-744"><a href="#cb102-744" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="labsでラベルの編集"}</span></span>
<span id="cb102-745"><a href="#cb102-745" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-746"><a href="#cb102-746" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length)) +</span></span>
<span id="cb102-747"><a href="#cb102-747" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(bins = 30) +</span></span>
<span id="cb102-748"><a href="#cb102-748" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb102-749"><a href="#cb102-749" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "length", </span></span>
<span id="cb102-750"><a href="#cb102-750" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "count", </span></span>
<span id="cb102-751"><a href="#cb102-751" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "main title", </span></span>
<span id="cb102-752"><a href="#cb102-752" aria-hidden="true" tabindex="-1"></a><span class="in">    subtitle = "sub title", </span></span>
<span id="cb102-753"><a href="#cb102-753" aria-hidden="true" tabindex="-1"></a><span class="in">    caption = "caption")</span></span>
<span id="cb102-754"><a href="#cb102-754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-755"><a href="#cb102-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-756"><a href="#cb102-756" aria-hidden="true" tabindex="-1"></a><span class="fu">## 軸スケールの変換（対数化など）</span></span>
<span id="cb102-757"><a href="#cb102-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-758"><a href="#cb102-758" aria-hidden="true" tabindex="-1"></a>x軸、y軸の数値を対数変換する場合には、<span class="in">`scale_x_log10`</span>、<span class="in">`scale_y_log10`</span>を用います。他の<span class="in">`ggplot2`</span>の関数と同様に、<span class="in">`scale_x_log10`</span>、<span class="in">`scale_y_log10`</span>も<span class="in">`+`</span>で繋ぐことで、x軸、y軸が対数変換されます。</span>
<span id="cb102-759"><a href="#cb102-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-760"><a href="#cb102-760" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="軸スケールの変換"}</span></span>
<span id="cb102-761"><a href="#cb102-761" aria-hidden="true" tabindex="-1"></a><span class="in">diamonds |&gt; </span></span>
<span id="cb102-762"><a href="#cb102-762" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = price)) +</span></span>
<span id="cb102-763"><a href="#cb102-763" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(bins = 50) +</span></span>
<span id="cb102-764"><a href="#cb102-764" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_log10()</span></span>
<span id="cb102-765"><a href="#cb102-765" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-766"><a href="#cb102-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-767"><a href="#cb102-767" aria-hidden="true" tabindex="-1"></a>同様の軸の変換の関数には、<span class="in">`scale_x_reverse`</span>、<span class="in">`scale_x_sqrt`</span>などがあります。それぞれ軸を正負反転、平方根に変換するのに用います。</span>
<span id="cb102-768"><a href="#cb102-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-769"><a href="#cb102-769" aria-hidden="true" tabindex="-1"></a><span class="fu">## グラフの並び順の変更</span></span>
<span id="cb102-770"><a href="#cb102-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-771"><a href="#cb102-771" aria-hidden="true" tabindex="-1"></a>x軸に因子を指定した場合の棒グラフなどの並び順は、その因子のレベルの順番で決まります。ですので、<span class="in">`forcat`</span>パッケージの<span class="in">`fct_reorder`</span>を用いて並べ替えることができます。</span>
<span id="cb102-772"><a href="#cb102-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-773"><a href="#cb102-773" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="fct_reorderで順番を変更する"}</span></span>
<span id="cb102-774"><a href="#cb102-774" aria-hidden="true" tabindex="-1"></a><span class="in">d |&gt; </span></span>
<span id="cb102-775"><a href="#cb102-775" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = forcats::fct_reorder(Species, c("virginica", "setosa", "versicolor")), y = mSepal.Length)) +</span></span>
<span id="cb102-776"><a href="#cb102-776" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity")</span></span>
<span id="cb102-777"><a href="#cb102-777" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-778"><a href="#cb102-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-779"><a href="#cb102-779" aria-hidden="true" tabindex="-1"></a><span class="in">`fct_reorder`</span>関数は他の数値を参照して、その数値の順番で並べ替えることもできます。</span>
<span id="cb102-780"><a href="#cb102-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-781"><a href="#cb102-781" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="fct_reorderで数値に従い並べ替え"}</span></span>
<span id="cb102-782"><a href="#cb102-782" aria-hidden="true" tabindex="-1"></a><span class="in">d |&gt; </span></span>
<span id="cb102-783"><a href="#cb102-783" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = forcats::fct_reorder(Species, mSepal.Length, .desc=TRUE), y = mSepal.Length)) +</span></span>
<span id="cb102-784"><a href="#cb102-784" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity")</span></span>
<span id="cb102-785"><a href="#cb102-785" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-786"><a href="#cb102-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-787"><a href="#cb102-787" aria-hidden="true" tabindex="-1"></a>同様の数値による順番の変更は、<span class="in">`reorder`</span>関数を用いても行うことができます。</span>
<span id="cb102-788"><a href="#cb102-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-789"><a href="#cb102-789" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="reorder関数で並べ替え"}</span></span>
<span id="cb102-790"><a href="#cb102-790" aria-hidden="true" tabindex="-1"></a><span class="in">d |&gt; </span></span>
<span id="cb102-791"><a href="#cb102-791" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = reorder(Species, mSepal.Length, decreasing = TRUE), y = mSepal.Length)) +</span></span>
<span id="cb102-792"><a href="#cb102-792" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity")</span></span>
<span id="cb102-793"><a href="#cb102-793" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-794"><a href="#cb102-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-795"><a href="#cb102-795" aria-hidden="true" tabindex="-1"></a><span class="fu">## 円グラフの作成</span></span>
<span id="cb102-796"><a href="#cb102-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-797"><a href="#cb102-797" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>で円グラフを作成する場合には、<span class="in">`coord_polar`</span>を用います。<span class="in">`coord_polar`</span>は軸を円形に配置する関数で、棒グラフを描画し、<span class="in">`coord_polar`</span>の引数に<span class="in">`theta="y"`</span>を指定すると、円グラフが描画されます。</span>
<span id="cb102-798"><a href="#cb102-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-799"><a href="#cb102-799" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="coord_polarで円グラフの指定"}</span></span>
<span id="cb102-800"><a href="#cb102-800" aria-hidden="true" tabindex="-1"></a><span class="in">d |&gt; </span></span>
<span id="cb102-801"><a href="#cb102-801" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = "1", y = mSepal.Length, color = Species, fill=Species)) +</span></span>
<span id="cb102-802"><a href="#cb102-802" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity") +</span></span>
<span id="cb102-803"><a href="#cb102-803" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_polar(theta = "y")</span></span>
<span id="cb102-804"><a href="#cb102-804" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-805"><a href="#cb102-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-806"><a href="#cb102-806" aria-hidden="true" tabindex="-1"></a>棒を複数描画するような場合には、中心からいくつかの層に分かれて円グラフが描画されます。<span class="in">`position="fill"`</span>を指定すると、棒グラフの高さがそろい、値は割合に変化するため、異なる要素間での比較を示すことができます。ただし、<span class="in">`pie`</span>関数のhelpに記載されている通り、円グラフではデータの比較が難しくなります。基本的に円グラフを用いない方が良いでしょう。</span>
<span id="cb102-807"><a href="#cb102-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-808"><a href="#cb102-808" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="coord_polarでは見にくい場合"}</span></span>
<span id="cb102-809"><a href="#cb102-809" aria-hidden="true" tabindex="-1"></a><span class="in">p1 +</span></span>
<span id="cb102-810"><a href="#cb102-810" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity", position="fill") +</span></span>
<span id="cb102-811"><a href="#cb102-811" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_polar(theta = "y")</span></span>
<span id="cb102-812"><a href="#cb102-812" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-813"><a href="#cb102-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-814"><a href="#cb102-814" aria-hidden="true" tabindex="-1"></a><span class="fu">## theme</span></span>
<span id="cb102-815"><a href="#cb102-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-816"><a href="#cb102-816" aria-hidden="true" tabindex="-1"></a><span class="in">`theme`</span>は、グラフのもっと細かな要素を調整するための関数です。<span class="in">`theme`</span>には非常に多くの引数が設定されており、<span class="in">`theme`</span>を用いることで軸ラベルなどのフォントサイズや色、回転、凡例の位置等を調整することができます。代表的な例として、<span class="in">`theme`</span>関数の<span class="in">`legend.position`</span>引数を用いて、凡例をグラフの下に表示した場合を下に示します。凡例を消す場合には、<span class="in">`legend.position="none"`</span>を指定します。<span class="in">`theme`</span>の引数には関数を取るものあり、設定はやや複雑ですが、うまく指定すれば様々なグラフの要素を調整することができます。</span>
<span id="cb102-817"><a href="#cb102-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-818"><a href="#cb102-818" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="themeの指定"}</span></span>
<span id="cb102-819"><a href="#cb102-819" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-820"><a href="#cb102-820" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width, color = Species)) + </span></span>
<span id="cb102-821"><a href="#cb102-821" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb102-822"><a href="#cb102-822" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb102-823"><a href="#cb102-823" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-824"><a href="#cb102-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-825"><a href="#cb102-825" aria-hidden="true" tabindex="-1"></a><span class="in">`theme`</span>には、グラフのデザインを丸ごと変えることができる関数が別途用意されています。例えば、<span class="in">`theme_bw`</span>ででは背景が白いグラフ、<span class="in">`theme_light`</span>ででは明るめ、<span class="in">`theme_dark`</span>では暗めの背景を用いたグラフを作成できます。</span>
<span id="cb102-826"><a href="#cb102-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-827"><a href="#cb102-827" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="theme_bw関数で背景を白にする"}</span></span>
<span id="cb102-828"><a href="#cb102-828" aria-hidden="true" tabindex="-1"></a><span class="in">iris |&gt; </span></span>
<span id="cb102-829"><a href="#cb102-829" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width)) + </span></span>
<span id="cb102-830"><a href="#cb102-830" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb102-831"><a href="#cb102-831" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw()</span></span>
<span id="cb102-832"><a href="#cb102-832" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-833"><a href="#cb102-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-834"><a href="#cb102-834" aria-hidden="true" tabindex="-1"></a><span class="fu">## グラフの保存：ggsave</span></span>
<span id="cb102-835"><a href="#cb102-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-836"><a href="#cb102-836" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>のグラフを保存する時には、<span class="in">`ggsave`</span>関数を用います。<span class="in">`ggsave`</span>関数は第一引数にファイル名、第二引数に<span class="in">`ggplot2`</span>のプロットのオブジェクトを取ります。ファイルの形式はファイル名の拡張子に従い決定します。例えば、ファイル名が「.pdf」で終わっていればPDF、「.jpg」で終わっていればJPEGでグラフが保存されます。</span>
<span id="cb102-837"><a href="#cb102-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-838"><a href="#cb102-838" aria-hidden="true" tabindex="-1"></a>グラフのサイズは<span class="in">`width`</span>、<span class="in">`height`</span>引数で、解像度は<span class="in">`dpi`</span>で指定します。<span class="in">`limitsize=FALSE`</span>と指定することで、縦横が50インチ以上の非常に大きいグラフを保存することもできます。</span>
<span id="cb102-839"><a href="#cb102-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-840"><a href="#cb102-840" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, filename="ggsave関数"}</span></span>
<span id="cb102-841"><a href="#cb102-841" aria-hidden="true" tabindex="-1"></a><span class="in"># プロットのオブジェクトをpに代入</span></span>
<span id="cb102-842"><a href="#cb102-842" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- </span></span>
<span id="cb102-843"><a href="#cb102-843" aria-hidden="true" tabindex="-1"></a><span class="in">  iris |&gt; </span></span>
<span id="cb102-844"><a href="#cb102-844" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = Sepal.Length, y = Sepal.Width)) +</span></span>
<span id="cb102-845"><a href="#cb102-845" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point()</span></span>
<span id="cb102-846"><a href="#cb102-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-847"><a href="#cb102-847" aria-hidden="true" tabindex="-1"></a><span class="in"># pをpdfで保存</span></span>
<span id="cb102-848"><a href="#cb102-848" aria-hidden="true" tabindex="-1"></a><span class="in">ggsave("plot_iris_Sepal.pdf", p)</span></span>
<span id="cb102-849"><a href="#cb102-849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-850"><a href="#cb102-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-851"><a href="#cb102-851" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extensions</span></span>
<span id="cb102-852"><a href="#cb102-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-853"><a href="#cb102-853" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>には、<span class="in">`ggplot2`</span>に機能を追加する<span class="co">[</span><span class="ot">Extensions</span><span class="co">](https://exts.ggplot2.tidyverse.org/gallery/)</span>というライブラリがたくさん存在します。代表的なExtensionsを以下に紹介します。</span>
<span id="cb102-854"><a href="#cb102-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-855"><a href="#cb102-855" aria-hidden="true" tabindex="-1"></a><span class="fu">### patchwork</span></span>
<span id="cb102-856"><a href="#cb102-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-857"><a href="#cb102-857" aria-hidden="true" tabindex="-1"></a>まずは、複数のグラフを1つのデバイスにまとめて表示する<span class="in">`patchwork`</span><span class="co">[</span><span class="ot">@patchwork_bib</span><span class="co">]</span>です。<span class="in">`patchwork`</span>を用いれば、位置・幅等を簡単に調整しながら、2つ以上のグラフをまとめることができます。</span>
<span id="cb102-858"><a href="#cb102-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-859"><a href="#cb102-859" aria-hidden="true" tabindex="-1"></a><span class="in">`patchwork`</span>を用いる時には、まず<span class="in">`ggplot2`</span>のオブジェクトを変数に代入しておくとよいでしょう。</span>
<span id="cb102-860"><a href="#cb102-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-861"><a href="#cb102-861" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="ggplot2オブジェクトを変数に代入"}</span></span>
<span id="cb102-862"><a href="#cb102-862" aria-hidden="true" tabindex="-1"></a><span class="in">pacman::p_load(patchwork)</span></span>
<span id="cb102-863"><a href="#cb102-863" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- iris |&gt; ggplot(aes(x = Sepal.Length, y = Sepal.Width)) + geom_point()</span></span>
<span id="cb102-864"><a href="#cb102-864" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- iris |&gt; ggplot(aes(x = Species, y = Petal.Length)) + geom_boxplot()</span></span>
<span id="cb102-865"><a href="#cb102-865" aria-hidden="true" tabindex="-1"></a><span class="in">p3 &lt;- iris |&gt; ggplot(aes(x = Petal.Width)) + geom_histogram()</span></span>
<span id="cb102-866"><a href="#cb102-866" aria-hidden="true" tabindex="-1"></a><span class="in">p4 &lt;- iris |&gt; ggplot(aes(x = Petal.Length, color = Species, fill = Species)) + geom_histogram(binwidth = 0.5)</span></span>
<span id="cb102-867"><a href="#cb102-867" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-868"><a href="#cb102-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-869"><a href="#cb102-869" aria-hidden="true" tabindex="-1"></a>グラフを横に並べて表示するときには、<span class="in">`+`</span>でオブジェクトを繋ぎます。</span>
<span id="cb102-870"><a href="#cb102-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-871"><a href="#cb102-871" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="グラフを横に並べる"}</span></span>
<span id="cb102-872"><a href="#cb102-872" aria-hidden="true" tabindex="-1"></a><span class="in">p1 + p2</span></span>
<span id="cb102-873"><a href="#cb102-873" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-874"><a href="#cb102-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-875"><a href="#cb102-875" aria-hidden="true" tabindex="-1"></a>同様にカッコで囲えば表示を一部まとめておくことができます。また、<span class="in">`|`</span>は横並び、<span class="in">`/`</span>は縦並びにグラフを配置する場合に用います。</span>
<span id="cb102-876"><a href="#cb102-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-877"><a href="#cb102-877" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="グラフを縦横に配置する"}</span></span>
<span id="cb102-878"><a href="#cb102-878" aria-hidden="true" tabindex="-1"></a><span class="in">(p1 | p2) / p3</span></span>
<span id="cb102-879"><a href="#cb102-879" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-880"><a href="#cb102-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-881"><a href="#cb102-881" aria-hidden="true" tabindex="-1"></a>カッコ、<span class="in">`|`</span>、<span class="in">`/`</span>を組み合わせれば、グラフを様々な配置に並べて表示することができます。</span>
<span id="cb102-882"><a href="#cb102-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-883"><a href="#cb102-883" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="カッコを用いて配置する"}</span></span>
<span id="cb102-884"><a href="#cb102-884" aria-hidden="true" tabindex="-1"></a><span class="in">(p1 | p2) / (p3 | p4)</span></span>
<span id="cb102-885"><a href="#cb102-885" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-886"><a href="#cb102-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-887"><a href="#cb102-887" aria-hidden="true" tabindex="-1"></a><span class="fu">### gganimate</span></span>
<span id="cb102-888"><a href="#cb102-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-889"><a href="#cb102-889" aria-hidden="true" tabindex="-1"></a><span class="in">`gganimate`</span><span class="co">[</span><span class="ot">@gganimate_bib</span><span class="co">]</span>はアニメーションを利用したグラフを作成するためのライブラリです。下の例では、<span class="in">`gamminder`</span>（各国の年別のGDPと寿命、人口のデータ）をバブルチャートとし、年毎にアニメーションとしたものです。<span class="in">`transition_time`</span>という部分でアニメーションのフレームとなる変数を設定し、<span class="in">`ease_aes`</span>という部分でフレームの間隔を表現します。</span>
<span id="cb102-890"><a href="#cb102-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-891"><a href="#cb102-891" aria-hidden="true" tabindex="-1"></a>アニメーションをgifで保存する場合には、<span class="in">`anim_save`</span>関数を用います。<span class="in">`anim_save`</span>関数の引数の指定は<span class="in">`ggsave`</span>と類似していますが、グラフオブジェクトを<span class="in">`animate`</span>関数の引数とした上で、<span class="in">`renderer`</span>という引数を設定する必要があります。<span class="in">`renderer`</span>には保存するファイル形式を指定します。gifアニメーションを作成するときには<span class="in">`renderer=gifski_renderer()`</span>を指定します。この<span class="in">`gifski_renderer`</span>を用いるためには、<span class="in">`gifski`</span>パッケージ<span class="co">[</span><span class="ot">@gifski_bib</span><span class="co">]</span>を呼び出しておく必要があります。gif以外にもmpegなどのファイルにも保存できますが、別途ライブラリの呼び出しが必要です。</span>
<span id="cb102-892"><a href="#cb102-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-893"><a href="#cb102-893" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE, warning = FALSE, results = FALSE, filename="gganimate関数でgifを作成"}</span></span>
<span id="cb102-894"><a href="#cb102-894" aria-hidden="true" tabindex="-1"></a><span class="in">pacman::p_load(gganimate, gifski, gapminder)</span></span>
<span id="cb102-895"><a href="#cb102-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-896"><a href="#cb102-896" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- ggplot(gapminder, aes(gdpPercap, lifeExp, size = pop, colour = country)) +</span></span>
<span id="cb102-897"><a href="#cb102-897" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(alpha = 0.7, show.legend = FALSE) +</span></span>
<span id="cb102-898"><a href="#cb102-898" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_colour_manual(values = country_colors) +</span></span>
<span id="cb102-899"><a href="#cb102-899" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_size(range = c(2, 12)) +</span></span>
<span id="cb102-900"><a href="#cb102-900" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_log10() +</span></span>
<span id="cb102-901"><a href="#cb102-901" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~ continent) +</span></span>
<span id="cb102-902"><a href="#cb102-902" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = 'Year: {frame_time}', x = 'GDP per capita', y = 'life expectancy') + # frame_timeで描画を指定</span></span>
<span id="cb102-903"><a href="#cb102-903" aria-hidden="true" tabindex="-1"></a><span class="in">  transition_time(year) + # yearの列をフレームとする</span></span>
<span id="cb102-904"><a href="#cb102-904" aria-hidden="true" tabindex="-1"></a><span class="in">  ease_aes('linear') # yearごとのフレーム間隔は一定</span></span>
<span id="cb102-905"><a href="#cb102-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-906"><a href="#cb102-906" aria-hidden="true" tabindex="-1"></a><span class="in">anim_save("p.gif", animate(p, renderer = gifski_renderer())) # 描画の方法を指定</span></span>
<span id="cb102-907"><a href="#cb102-907" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-908"><a href="#cb102-908" aria-hidden="true" tabindex="-1"></a><span class="al">![](p.gif)</span></span>
<span id="cb102-909"><a href="#cb102-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-910"><a href="#cb102-910" aria-hidden="true" tabindex="-1"></a><span class="fu">### GGally</span></span>
<span id="cb102-911"><a href="#cb102-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-912"><a href="#cb102-912" aria-hidden="true" tabindex="-1"></a><span class="in">`GGally`</span><span class="co">[</span><span class="ot">@GGally_bib</span><span class="co">]</span>は<span class="in">`ggplot2`</span>を使って、相関行列を描画するためのExtensionです。各列のデータの型に従い、表示するグラフの形を変えてくれたり、相関係数を表示してくれたりします。<span class="in">`pairs`</span>関数を用いてグラフを書くよりもデータの特徴をとらえやすい相関行列の図を簡単に作成することができます。</span>
<span id="cb102-913"><a href="#cb102-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-914"><a href="#cb102-914" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, fig.width=8, fig.height=6, filename="GGally::ggpairs関数"}</span></span>
<span id="cb102-915"><a href="#cb102-915" aria-hidden="true" tabindex="-1"></a><span class="in">pacman::p_load(GGally)</span></span>
<span id="cb102-916"><a href="#cb102-916" aria-hidden="true" tabindex="-1"></a><span class="in">ggpairs(iris, mapping=aes(color=Species))</span></span>
<span id="cb102-917"><a href="#cb102-917" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-918"><a href="#cb102-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-919"><a href="#cb102-919" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip collapse=true}</span>
<span id="cb102-920"><a href="#cb102-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-921"><a href="#cb102-921" aria-hidden="true" tabindex="-1"></a><span class="fu">## 他言語のグラフ作成との比較</span></span>
<span id="cb102-922"><a href="#cb102-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-923"><a href="#cb102-923" aria-hidden="true" tabindex="-1"></a>R以外の言語にも、グラフ作成のライブラリが備わっています。例えばPythonでは、<span class="co">[</span><span class="ot">matplotlib</span><span class="co">](https://matplotlib.org/stable/)</span>や<span class="co">[</span><span class="ot">seaborn</span><span class="co">](https://seaborn.pydata.org/index.html)</span>、<span class="co">[</span><span class="ot">plotly</span><span class="co">](https://plotly.com/graphing-libraries/)</span>などがあります。Juliaでは<span class="co">[</span><span class="ot">Julia Plots</span><span class="co">](https://docs.juliaplots.org/stable/gallery/gr/)</span>がデフォルトのグラフ作成ライブラリです。いずれもどちらかと言えばRのデフォルトに近い関数を用いてグラフを作成するようです。</span>
<span id="cb102-924"><a href="#cb102-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-925"><a href="#cb102-925" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span>では、データ、aes、グラフの形をそれぞれ<span class="in">`ggplot`</span>、<span class="in">`aes`</span>、<span class="in">`geom`</span>関数で表現し、ジェネリック関数として設定された<span class="in">`+`</span>で繋ぐ点が特徴です。特徴が他のライブラリとは異なるため、記法に慣れるまでは他のライブラリよりグラフを作成するのが難しく感じるかもしれません。しかし、<span class="in">`ggplot2`</span>の経験を積み、慣れてしまえば表現したいグラフを他のライブラリよりスムーズに作成することができます。</span>
<span id="cb102-926"><a href="#cb102-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-927"><a href="#cb102-927" aria-hidden="true" tabindex="-1"></a>:::</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><a href="https://quarto.org/">Quarto</a>を用いてこの本を作成しました</p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"descPosition":"bottom","closeEffect":"zoom","selector":".lightbox","loop":false,"openEffect":"zoom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




</body></html>