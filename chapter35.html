<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R入門 - 35&nbsp; Shiny</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./summary.html" rel="next">
<link href="./chapter34.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter31.html">アドバンスな手法</a></li><li class="breadcrumb-item"><a href="./chapter35.html"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Shiny</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R入門</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">はじめに</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Rプログラミングの基礎</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Rのインストール</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Rを使ってみよう</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">オブジェクトと変数・定数</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">条件判断（Control structures）</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">繰り返し文（Looping）</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">ライブラリ</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">エラー処理（error handler）</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">数値</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">文字列</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">因子（factor）</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">ベクター</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">リスト・データフレーム・行列</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">データの読み込みと書き出し（I/O）</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">データセット</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Rでのデータの取り扱い</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">apply関数群</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">tidyr・dplyr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">日時データの取り扱い</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter18.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">オブジェクト指向とクラス</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter19.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">コーディング規約</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Rでのグラフ作成</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter20.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">グラフ作成：高レベルグラフィック関数</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter21.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">グラフ作成：低レベルグラフィック関数とグラフィックパラメータ</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter22.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter23.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">plotly</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">統計解析の基礎</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter24.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">確率分布と乱数</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter25.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">検定</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter26.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">相関と回帰</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter27.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">分類</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter28.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">教師なし学習</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter29.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">時系列分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter30.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">生存時間解析</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">アドバンスな手法</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter31.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">purrr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter32.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">地理空間情報</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter33.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">ネットワーク解析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter34.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">R markdown・Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter35.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Shiny</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">おわりに</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">参考文献</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#shinyとwebアプリケーション" id="toc-shinyとwebアプリケーション" class="nav-link active" data-scroll-target="#shinyとwebアプリケーション"><span class="header-section-number">35.1</span> Shinyとwebアプリケーション</a></li>
  <li><a href="#データ分析のためのwebアプリケーション開発ツールshiny" id="toc-データ分析のためのwebアプリケーション開発ツールshiny" class="nav-link" data-scroll-target="#データ分析のためのwebアプリケーション開発ツールshiny"><span class="header-section-number">35.2</span> データ分析のためのwebアプリケーション開発ツール：Shiny</a></li>
  <li><a href="#shinyの基礎" id="toc-shinyの基礎" class="nav-link" data-scroll-target="#shinyの基礎"><span class="header-section-number">35.3</span> Shinyの基礎</a></li>
  <li><a href="#ui.rユーザーインターフェース" id="toc-ui.rユーザーインターフェース" class="nav-link" data-scroll-target="#ui.rユーザーインターフェース"><span class="header-section-number">35.4</span> ui.R（ユーザーインターフェース）</a>
  <ul>
  <li><a href="#webページのレイアウト" id="toc-webページのレイアウト" class="nav-link" data-scroll-target="#webページのレイアウト"><span class="header-section-number">35.4.1</span> Webページのレイアウト</a></li>
  <li><a href="#htmlの要素" id="toc-htmlの要素" class="nav-link" data-scroll-target="#htmlの要素"><span class="header-section-number">35.4.2</span> HTMLの要素</a></li>
  <li><a href="#入力input" id="toc-入力input" class="nav-link" data-scroll-target="#入力input"><span class="header-section-number">35.4.3</span> 入力（input）</a></li>
  </ul></li>
  <li><a href="#server.rサーバサイド" id="toc-server.rサーバサイド" class="nav-link" data-scroll-target="#server.rサーバサイド"><span class="header-section-number">35.5</span> server.R（サーバサイド）</a>
  <ul>
  <li><a href="#outputidの準備" id="toc-outputidの準備" class="nav-link" data-scroll-target="#outputidの準備"><span class="header-section-number">35.5.1</span> outputIDの準備</a></li>
  <li><a href="#inputidを利用してoutputidを準備する" id="toc-inputidを利用してoutputidを準備する" class="nav-link" data-scroll-target="#inputidを利用してoutputidを準備する"><span class="header-section-number">35.5.2</span> inputIdを利用してoutputIdを準備する</a></li>
  <li><a href="#render関数群" id="toc-render関数群" class="nav-link" data-scroll-target="#render関数群"><span class="header-section-number">35.5.3</span> Render関数群</a></li>
  </ul></li>
  <li><a href="#ui.r" id="toc-ui.r" class="nav-link" data-scroll-target="#ui.r"><span class="header-section-number">35.6</span> ui.R</a>
  <ul>
  <li><a href="#出力output" id="toc-出力output" class="nav-link" data-scroll-target="#出力output"><span class="header-section-number">35.6.1</span> 出力（output）</a></li>
  </ul></li>
  <li><a href="#global.rとwwwフォルダ" id="toc-global.rとwwwフォルダ" class="nav-link" data-scroll-target="#global.rとwwwフォルダ"><span class="header-section-number">35.7</span> global.Rとwwwフォルダ</a></li>
  <li><a href="#observerとreactive" id="toc-observerとreactive" class="nav-link" data-scroll-target="#observerとreactive"><span class="header-section-number">35.8</span> observerとreactive</a>
  <ul>
  <li><a href="#observer" id="toc-observer" class="nav-link" data-scroll-target="#observer"><span class="header-section-number">35.8.1</span> observer</a></li>
  <li><a href="#reactive" id="toc-reactive" class="nav-link" data-scroll-target="#reactive"><span class="header-section-number">35.8.2</span> reactive</a></li>
  <li><a href="#observeeventとeventreactive" id="toc-observeeventとeventreactive" class="nav-link" data-scroll-target="#observeeventとeventreactive"><span class="header-section-number">35.8.3</span> observeEventとeventReactive</a>
  <ul class="collapse">
  <li><a href="#observeevent" id="toc-observeevent" class="nav-link" data-scroll-target="#observeevent"><span class="header-section-number">35.8.3.1</span> observeEvent</a></li>
  <li><a href="#eventreactive" id="toc-eventreactive" class="nav-link" data-scroll-target="#eventreactive"><span class="header-section-number">35.8.3.2</span> eventReactive</a></li>
  </ul></li>
  <li><a href="#reactivevalとreactivevalue" id="toc-reactivevalとreactivevalue" class="nav-link" data-scroll-target="#reactivevalとreactivevalue"><span class="header-section-number">35.8.4</span> reactiveValとreactiveValue</a></li>
  <li><a href="#reactivetimerとinvalidatedlater" id="toc-reactivetimerとinvalidatedlater" class="nav-link" data-scroll-target="#reactivetimerとinvalidatedlater"><span class="header-section-number">35.8.5</span> reactiveTimerとinvalidatedLater</a></li>
  </ul></li>
  <li><a href="#app.r" id="toc-app.r" class="nav-link" data-scroll-target="#app.r"><span class="header-section-number">35.9</span> app.R</a></li>
  <li><a href="#shinyに機能を追加するextensions" id="toc-shinyに機能を追加するextensions" class="nav-link" data-scroll-target="#shinyに機能を追加するextensions"><span class="header-section-number">35.10</span> Shinyに機能を追加する（Extensions）</a></li>
  <li><a href="#アプリをデプロイする" id="toc-アプリをデプロイする" class="nav-link" data-scroll-target="#アプリをデプロイする"><span class="header-section-number">35.11</span> アプリをデプロイする</a>
  <ul>
  <li><a href="#shinyapps.io" id="toc-shinyapps.io" class="nav-link" data-scroll-target="#shinyapps.io"><span class="header-section-number">35.11.1</span> shinyapps.io</a></li>
  <li><a href="#shiny-server" id="toc-shiny-server" class="nav-link" data-scroll-target="#shiny-server"><span class="header-section-number">35.11.2</span> shiny server</a></li>
  <li><a href="#githubで共有する" id="toc-githubで共有する" class="nav-link" data-scroll-target="#githubで共有する"><span class="header-section-number">35.11.3</span> GitHubで共有する</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter31.html">アドバンスな手法</a></li><li class="breadcrumb-item"><a href="./chapter35.html"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Shiny</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Shiny</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>データを解析した後には、その結果を用いて他の人にデータや解析の意味を説明する必要があります。説明するために用いるものの一つが文書やプレゼンテーションです。文書やプレゼンテーションはR markdown・Quarto（<a href="./chapter34.html">34章</a>参照）で作成することができます。</p>
<p>もう一つの方法は、データを表示するためのウェブページを作成する方法です。ウェブページもR markdownで作成することはできますが、R markdownだけではインタラクティブなウェブページ、例えばデータを入力して、そのデータに応じたグラフを作成するようなもの、は作成することができません。このインタラクティブなウェブページを作成するためのRのツールが<strong><a href="https://shiny.posit.co/">Shiny</a></strong><span class="citation" data-cites="shiny_bib">(<a href="references.html#ref-shiny_bib" role="doc-biblioref">Chang et al. 2024</a>)</span>です。</p>
<section id="shinyとwebアプリケーション" class="level2" data-number="35.1">
<h2 data-number="35.1" class="anchored" data-anchor-id="shinyとwebアプリケーション"><span class="header-section-number">35.1</span> Shinyとwebアプリケーション</h2>
<p>Shinyは<strong>webアプリケーション</strong>と呼ばれる、webページ（HTML）の生成（ユーザーインターフェース/フロントエンド）とサーバでの演算（サーバサイド）を行うアプリケーションの一種です。</p>
<p>通常のwebアプリケーションでは、ユーザーがwebページにアクセスし、情報を入力（例えば検索する文字を入力）すると、情報がサーバへと送られます。サーバでは入力された情報と、サーバー内のデータベースとを比較し、必要な情報を集めてHTMLファイルを作成します。このHTMLがユーザーに送られ、検索結果が表示される、といったような仕組みになっています。</p>
<p>このようなタイプのwebアプリケーションを作成するためのツールはたくさんあります。典型的な例として、<a href="https://rubyonrails.org/">Ruby on Rails</a>、<a href="https://www.djangoproject.com/">Django</a>などがあります。これらのツールは<strong>webアプリケーションフレームワーク</strong>と呼ばれており、我々がよく用いているwebページ・webサービスに用いられています。</p>
<p>Shinyはこれらのフレームワークと比較するとかなり機能が制限されたツールです。Shinyにはユーザーインターフェースとサーバサイドを構築する機能はありますが、演算は基本的にRで行われるためレスポンスは遅めです。また、データベースは必須ではないため、データベースを用いるのであればR上で別途ライブラリを用いる必要があります。データベースではなく、csvなどでデータを準備することもあります。また、セキュリティ面をサポートするツールはほとんどありません。</p>
</section>
<section id="データ分析のためのwebアプリケーション開発ツールshiny" class="level2" data-number="35.2">
<h2 data-number="35.2" class="anchored" data-anchor-id="データ分析のためのwebアプリケーション開発ツールshiny"><span class="header-section-number">35.2</span> データ分析のためのwebアプリケーション開発ツール：Shiny</h2>
<p>Shinyはデータを説明することに特化したwebアプリケーション開発ツールで、Rのツール、例えば<code>ggplot2</code>や<code>plotly</code>、<code>leaflet</code>などを用いてデータを表示し、統計結果を示すのに適したツールです。Shiny自体は2012年頃から開発され、2017年頃にver.1.0となった、古参のデータ用webアプリケーションツールです。</p>
<p>最近になって<a href="https://dash.plotly.com/">Plotly Dash</a>や<a href="https://streamlit.io/">Streamlit</a>などの、Pythonを用いる同様のツールが開発され、あっという間に<a href="https://www.datarevenue.com/en-blog/data-dashboarding-streamlit-vs-dash-vs-shiny-vs-voila">Shinyよりメジャーなツール</a>になってしまいました。特にStreamlitは今（2024年）注目されているツールです。現状Shinyの方が完成度は高めですが、Streamlitはたくさんの開発者が寄ってたかって改善している最中ですので、いずれStreamlitの完成度がShinyを上回りそうです。<a href="https://shiny.posit.co/py/">Pythonを使ったShiny</a>も開発されていますが、Streamlitの勢いに勝てるかどうかは疑わしいところです。</p>
<p>しかし、Rでウェブアプリケーションを作成するのであれば、Shinyはすぐに使えて、ある程度完成度の高いものを作るのも難しくない、良いツールです。ココではShinyでの基本的なWebアプリケーションの作成方法を簡単に説明します。</p>
<p>Shinyはかなり複雑なこともできる、高度なRライブラリの一つです。すべてをココで説明することはできませんので、詳しく学びたい方は教科書（<a href="https://www.amazon.co.jp/R%E3%81%A8Shiny%E3%81%A7%E4%BD%9C%E3%82%8BWeb%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3-%E6%A2%85%E6%B4%A5-%E9%9B%84%E4%B8%80/dp/4863542577/ref=sr_1_1?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&amp;crid=HX3OCPFCPSYO&amp;dib=eyJ2IjoiMSJ9.BpAoqimHpmL9r5ZTaR_qcYaPnGVnTh5pu6NrlNNLBel1eBc0WGDAkLs_CHmziXL_gylxT0vLxK98ExeEUjvHe4R9JHEbh8C7Mc1xS25iFS4SFpsfMl4HEpjiV2mVu913d1p0IgGDkqNpEzB_YPI8CQCL8S0CGmkMYVygDxe7AXRlMPmddWN5DwlThSZVx_khJnN0qCb0eJzpDKXnk-1efXmXbQJWFkTwF8t0PquBNYFpPjE8Msp2zdWYdEomGdJn-dlJAULxGBDXox5_YkGRoLHRjt6lv-y58SuDFJ_B7aQ.LPu0T7M8outatlmmZU2dEH60tiv78naxBhGDxtZQQDU&amp;dib_tag=se&amp;keywords=Shiny+R&amp;qid=1719730273&amp;sprefix=shiny+r%2Caps%2C169&amp;sr=8-1">日本語のもの</a>や<a href="https://www.amazon.co.jp/Mastering-Shiny-Interactive-Reports-Dashboards-ebook/dp/B093VG4C58/ref=sr_1_5?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&amp;crid=HX3OCPFCPSYO&amp;dib=eyJ2IjoiMSJ9.BpAoqimHpmL9r5ZTaR_qcYaPnGVnTh5pu6NrlNNLBel1eBc0WGDAkLs_CHmziXL_gylxT0vLxK98ExeEUjvHe4R9JHEbh8C7Mc1xS25iFS4SFpsfMl4HEpjiV2mVu913d1p0IgGDkqNpEzB_YPI8CQCL8S0CGmkMYVygDxe7AXRlMPmddWN5DwlThSZVx_khJnN0qCb0eJzpDKXnk-1efXmXbQJWFkTwF8t0PquBNYFpPjE8Msp2zdWYdEomGdJn-dlJAULxGBDXox5_YkGRoLHRjt6lv-y58SuDFJ_B7aQ.LPu0T7M8outatlmmZU2dEH60tiv78naxBhGDxtZQQDU&amp;dib_tag=se&amp;keywords=Shiny+R&amp;qid=1719730273&amp;sprefix=shiny+r%2Caps%2C169&amp;sr=8-5">英語のもの</a>）をご一読されることをオススメいたします。</p>
<p>この教科書でもShinyで作成したいくつかのWebアプリケーションを統計解析手法の説明に用いています。以下のコードを実行することで、この教科書で用いているWebアプリケーションを起動することができます。また、Webアプリケーションを停止するには、コンソールを選択してEscを押します。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>生存時間解析シミュレーター</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(shiny)) <span class="fu">install.packages</span>((<span class="st">"shiny"</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">runGitHub</span>(<span class="st">"surv_sim"</span>, <span class="st">"sb8001at"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>k-meansのアニメーション</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(shiny)) <span class="fu">install.packages</span>((<span class="st">"shiny"</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">runGitHub</span>(<span class="st">"kmeans_animated"</span>, <span class="st">"sb8001at"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>時系列：ARIMAシミュレーター</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(shiny)) <span class="fu">install.packages</span>((<span class="st">"shiny"</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">runGitHub</span>(<span class="st">"ARIMAsim"</span>, <span class="st">"sb8001at"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="shinyの基礎" class="level2" data-number="35.3">
<h2 data-number="35.3" class="anchored" data-anchor-id="shinyの基礎"><span class="header-section-number">35.3</span> Shinyの基礎</h2>
<p>ShinyのWebアプリケーションをR Studioで作成する場合、まずは左上のNew Fileアイコンから「Shiny Web App…」を選択します。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./image/newfile_shiny.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" data-glightbox="description: .lightbox-desc-1" title="図1：Shinyのファイルを作成する"><img src="./image/newfile_shiny.png" class="img-fluid figure-img" alt="図1：Shinyのファイルを作成する"></a></p>
<figcaption>図1：Shinyのファイルを作成する</figcaption>
</figure>
</div>
<p>「Shiny Web App…」を選択すると、以下のようなウインドウが表示されます。このウインドウでは、Webアプリケーションの名前、ファイルを作成するディレクトリ（フォルダ）に加えて、Web Appを1つのファイルで作成するか（Single File）、複数のファイルで作成するか（Multiple File）を選択します。「Single File」を選択すると、<strong>app.R</strong>という1つのファイルが選択したディレクトリ内に作成されます。一方で「Multiple File」を選択すると、<strong>ui.R</strong>と<strong>server.R</strong>という2つのファイルが作成されます。</p>
<p>どちらの形式を用いてもアプリケーションを作成するための関数などは共通していますが、アプリケーション作成に慣れるまでは「Multiple File」を用いるのがおすすめです。この章では、まず「Multiple File」での作成方法を一通り説明した後で、「Single File」で作成する方法を説明します。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./image/newfile_shiny2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" data-glightbox="description: .lightbox-desc-2" title="図2：Shinyのファイルを作成する"><img src="./image/newfile_shiny2.png" class="img-fluid figure-img" alt="図2：Shinyのファイルを作成する"></a></p>
<figcaption>図2：Shinyのファイルを作成する</figcaption>
</figure>
</div>
<p>上記のウインドウで「Create」をクリックすると、以下のようにディレクトリに<code>ui.R</code>と<code>server.R</code>という2つのファイルが作成されます。このファイルにはWebアプリケーションのスクリプト（サンプルアプリ）が書かれています。</p>
<p>作成された<code>ui.R</code>や<code>server.R</code>をRstudioで開くと、右上に「Run App」というアイコンが出てきます。これを押すとサンプルアプリを実行することができます。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./image/shiny_template.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" data-glightbox="description: .lightbox-desc-3" title="図3：Shinyアプリの例とRun Appアイコン"><img src="./image/shiny_template.png" class="img-fluid figure-img" alt="図3：Shinyアプリの例とRun Appアイコン"></a></p>
<figcaption>図3：Shinyアプリの例とRun Appアイコン</figcaption>
</figure>
</div>
<p>Webアプリケーション（Shinyアプリ）を実行すると、以下の図のようなページがWebブラウザに表示されます。このページのうち、左の部分（Number of bins:）はマウスで操作することができます。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./image/shiny_gayser10.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" data-glightbox="description: .lightbox-desc-4" title="図4：Shinyサンプルを起動する"><img src="./image/shiny_gayser10.png" class="img-fluid figure-img" alt="図4：Shinyサンプルを起動する"></a></p>
<figcaption>図4：Shinyサンプルを起動する</figcaption>
</figure>
</div>
<p>実際にNumber of binsを変更し、50としたのが以下の図です。<code>bins</code>、つまりヒストグラムの棒の数の設定を変えると、右のヒストグラムの表示が変化します。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./image/shiny_gayser49.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" data-glightbox="description: .lightbox-desc-5" title="図5：Number of binsを変更する"><img src="./image/shiny_gayser49.png" class="img-fluid figure-img" alt="図5：Number of binsを変更する"></a></p>
<figcaption>図5：Number of binsを変更する</figcaption>
</figure>
</div>
<p>このようなShinyアプリの動作は、以下の図のようなメカニズムで構成されています。まず、Shinyアプリのユーザーインターフェース（UI）で入力したデータは、Serverに送られます。Serverでは入力データを取り込んで<code>ggplot2</code>でグラフを作成し、グラフを含んだHTMLが作成されます。このHTMLがWebブラウザで表示されることで入力データに従ったグラフが表示されます。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./image/web_app.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" data-glightbox="description: .lightbox-desc-6" title="図6：Shinyアプリのおおまかな仕組み"><img src="./image/web_app.png" class="img-fluid figure-img" alt="図6：Shinyアプリのおおまかな仕組み"></a></p>
<figcaption>図6：Shinyアプリのおおまかな仕組み</figcaption>
</figure>
</div>
<p>通常のWebアプリケーションフレームワークでは、Rの部分に別の言語（RubyやPythonなど）が入り、さらにデータベースと接続されているのが一般的です。Shinyではデータベースは必須ではありませんが、もちろんデータベースを用いたWebアプリケーションを作成することもできます。データベースを用いたアプリケーションを作成する場合には、データベースを取り使うためのライブラリ（<a href="&quot;https://dbi.r-dbi.org/&quot;"><code>DBI</code></a><span class="citation" data-cites="DBI_bib">(<a href="references.html#ref-DBI_bib" role="doc-biblioref">R Special Interest Group on Databases (R-SIG-DB), Wickham, and Müller 2024</a>)</span>や<a href="&quot;https://dbplyr.tidyverse.org/&quot;"><code>dbplyr</code></a><span class="citation" data-cites="dbplyr_bib">(<a href="references.html#ref-dbplyr_bib" role="doc-biblioref">Wickham, Girlich, and Ruiz 2024</a>)</span>など）を用いることになります。</p>
<p>上記のUI、Serverをそれぞれ構築するためのファイルが、<code>ui.R</code>と<code>server.R</code>です。ココからはまず<code>ui.R</code>の構築について説明し、その後<code>server.R</code>について説明します。</p>
</section>
<section id="ui.rユーザーインターフェース" class="level2" data-number="35.4">
<h2 data-number="35.4" class="anchored" data-anchor-id="ui.rユーザーインターフェース"><span class="header-section-number">35.4</span> ui.R（ユーザーインターフェース）</h2>
<p><code>ui.R</code>には以下の4点をそれぞれ準備します。</p>
<ul>
<li>Webページのレイアウト</li>
<li>HTMLの要素（文章や画像）</li>
<li>入力</li>
<li>出力</li>
</ul>
<p>上記の4つのうち、Webページのレイアウトについては上の図には表現されていない部分です。HTMLの要素は文章のヘッダーや本文、画像などの表示に関わる部分です。入力と出力に関しては、上記の図に示した通り、入力データをserver.Rに送る部分と、server.Rで演算された結果をWebページ上に表示させる部分になります。以下にそれぞれの要素について説明していきます。</p>
<section id="webページのレイアウト" class="level3" data-number="35.4.1">
<h3 data-number="35.4.1" class="anchored" data-anchor-id="webページのレイアウト"><span class="header-section-number">35.4.1</span> Webページのレイアウト</h3>
<p>まずは、Webページ全体のレイアウトをui.Rに指定する必要があります。レイアウトの指定には、以下の表に示す関数が用いられます。</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>表：代表的なレイアウト指定用の関数の一覧</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 14%">
<col style="width: 67%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">関数</th>
<th style="text-align: left;">主な引数</th>
<th style="text-align: left;">意味</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">absolutePanel</td>
<td style="text-align: left;">fixed=FALSE</td>
<td style="text-align: left;">絶対的な位置を指定したレイアウト（スクロールあり）</td>
</tr>
<tr class="even">
<td style="text-align: left;">fixedPanel</td>
<td style="text-align: left;">fixed=FALSE</td>
<td style="text-align: left;">絶対的な位置を指定したレイアウト（スクロールされない）</td>
</tr>
<tr class="odd">
<td style="text-align: left;">column</td>
<td style="text-align: left;">width</td>
<td style="text-align: left;">列のレイアウト（widthは最大12で指定）</td>
</tr>
<tr class="even">
<td style="text-align: left;">fillPage</td>
<td style="text-align: left;">padding</td>
<td style="text-align: left;">ウインドウのサイズに合わせてコンテンツを表示</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fixedPage</td>
<td style="text-align: left;">―</td>
<td style="text-align: left;">固定幅のページのレイアウト</td>
</tr>
<tr class="even">
<td style="text-align: left;">fixedRow</td>
<td style="text-align: left;">―</td>
<td style="text-align: left;">固定幅の行のレイアウト</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fluidPage</td>
<td style="text-align: left;">―</td>
<td style="text-align: left;">可変幅のページのレイアウト</td>
</tr>
<tr class="even">
<td style="text-align: left;">fluidRow</td>
<td style="text-align: left;">―</td>
<td style="text-align: left;">可変幅の行のレイアウト</td>
</tr>
<tr class="odd">
<td style="text-align: left;">navbarPage</td>
<td style="text-align: left;">―</td>
<td style="text-align: left;">ページ上にタブの表示を作成する</td>
</tr>
<tr class="even">
<td style="text-align: left;">sidebarLayout</td>
<td style="text-align: left;">―</td>
<td style="text-align: left;">左右にサイドバー、メインパネルを配置</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sidebarPanel</td>
<td style="text-align: left;">width=4</td>
<td style="text-align: left;">サイドバーのレイアウト</td>
</tr>
<tr class="even">
<td style="text-align: left;">mainPanel</td>
<td style="text-align: left;">width=8</td>
<td style="text-align: left;">メインパネルのレイアウト</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tabsetPanel</td>
<td style="text-align: left;">―</td>
<td style="text-align: left;">その列にタブの表示を作成する</td>
</tr>
<tr class="even">
<td style="text-align: left;">tabPanel</td>
<td style="text-align: left;">title</td>
<td style="text-align: left;">タブの中身のレイアウト</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>レイアウトを決める関数にはある程度上下関係があります。最も上位に配置するレイアウトは<code>navbarPage</code>関数で、全体のページに渡るタブを作成します。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./image/navbarPage_example.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" data-glightbox="description: .lightbox-desc-7" title="図7：navbarPageによるタブ"><img src="./image/navbarPage_example.png" class="img-fluid figure-img" alt="図7：navbarPageによるタブ"></a></p>
<figcaption>図7：navbarPageによるタブ</figcaption>
</figure>
</div>
<p><code>navbarPage</code>関数では、「タブを配置すること」だけしか設定できないため、タブの中身を別途準備する必要があります。タブの中身は<code>tabPanel</code>関数を用いて記載していきます。<code>tabPanel</code>関数の第一引数にはタブの名前（<code>title</code>）を指定します。上記の図では、タブに記載された「textOutput」や「Plot・Table Output」というのが<code>title</code>に当たります。</p>
<p><code>navbarPage</code>関数の下位には<code>fixedPage</code>関数・<code>fluidPage</code>関数を配置するのが一般的です。<code>navbarPage</code>関数はタブを用いない場合には使用しないため、タブなしのページの場合には<code>fixedPage</code>関数、<code>fluidPage</code>関数が最上位のレイアウトとなります。<code>fixedPage</code>関数、<code>fluidPage</code>関数の差はレイアウトの幅を固定するか（<code>fixedPage</code>関数）、ウインドウの幅に合わせて調整するか（<code>fluidPage</code>関数）の違いです。</p>
<p><code>fixedPage</code>関数、<code>fluidPage</code>関数の下位には<code>sidebarLayout</code>関数や<code>column</code>関数を配置します。<code>sidebarLayout</code>関数の下位には<code>sidebarPanel</code>関数と<code>mainPanel</code>関数を配置し、それぞれ1/3の幅を持つサイドバーと2/3の幅を持つメインパネルの2つを設定します。以下の図の左側（binsの入力）がサイドバー、右側（グラフ）がメインパネルとなります。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./image/shiny_gayser10.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" data-glightbox="description: .lightbox-desc-8" title="図8：sidebarLayoutの例"><img src="./image/shiny_gayser10.png" class="img-fluid figure-img" alt="図8：sidebarLayoutの例"></a></p>
<figcaption>図8：sidebarLayoutの例</figcaption>
</figure>
</div>
<p>このサイドバーとメインパネルの幅は<code>width</code>引数で変更することができます。Shinyでは、R markdownと同様に<a href="https://getbootstrap.jp/">Bootstrap</a>によるデザインが採用されています。Bootstrapでは、Webページの幅全体を12とすることとされていますので、この幅12に従い、サイドバーとメインパネルの<code>width</code>の和が12となるように調整します。デフォルトではサイドバーの<code>width</code>が4、メインパネルの<code>width</code>が8となっています。</p>
<p><code>column</code>関数は上記の<code>sidebarPanel</code>関数や<code>mainPanel</code>関数とよく似たものですが、上位に<code>sidebarLayout</code>関数を必要としないものです。<code>column</code>関数も<code>width</code>引数で幅指定しますが、やはりすべての<code>column</code>の<code>width</code>の和が12となるように設定します。</p>
<p><code>column</code>関数や<code>mainPanel</code>関数にタブを設定するためのレイアウトが<code>tabsetPanel</code>関数です。ちょうど<code>navbarPanel</code>-<code>tabPanel</code>の関係と同様に、<code>tabsetPanel</code>関数の下には<code>tabPanel</code>関数を配置します。</p>
<p>以上のように、Shinyのレイアウトに関する関数はたくさんあり、上下関係が複雑です。上記で紹介していない関数もありますので、実際にはさらに複雑なレイアウトを取ることもできます。</p>
<p>レイアウトの上下関係は、関数をネストすることで指定することができます。例えば、以下の例では<code>fluidPage</code>の下に<code>sidebarLayout</code>、<code>sidebarLayout</code>の下に<code>sidebarPanel</code>と<code>mainPanel</code>を配置し、<code>mainPanel</code>の下に<code>tabsetPanel</code>、<code>tabsetPanel</code>の下に<code>tabPanel</code>を2枚配置しています。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>レイアウトの例</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fluidPage</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>      <span class="co"># サイドバーの中身を記載</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="co"># メインパネルの中身を記載</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tabsetPanel</span>(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"パネル1"</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>          <span class="co"># タブパネル1の中身を記載</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"パネル2"</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>          <span class="co"># タブパネル2の中身を記載</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Rは関数型言語ですので、すべてのレイアウトは関数、つまりカッコつきのスクリプトになります。また、<code>sidebarPanel</code>や1枚目の<code>tabPanel</code>のカッコの後にコンマがついています。1つのカッコの中に複数の要素がある場合にはコンマが必要です。ただし、カッコ内の最後の要素（上の例では<code>tabPanel(title = "パネル2")</code>）にはコンマは必要ありません。</p>
<p>Shinyのui.Rの記載では、レイアウトに関する関数が多層にネストされ、意味がわかりにくくなりやすいため、「Run App」でアプリを表示し、確認しながら作成するのがよいでしょう。</p>
</section>
<section id="htmlの要素" class="level3" data-number="35.4.2">
<h3 data-number="35.4.2" class="anchored" data-anchor-id="htmlの要素"><span class="header-section-number">35.4.2</span> HTMLの要素</h3>
<p>HTMLではヘッダーや改行、パラグラフは以下のように表現されます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>HTMLの記述</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">h1</span><span class="dt">&gt;</span> ヘッダー <span class="dt">&lt;/</span><span class="kw">h1</span><span class="dt">&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span> # 改行</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span> パラグラフ（文）<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Shinyも基本的にはHTMLをRから出力する仕組みとなっているため、Webアプリに文章を追加したい場合などにはHTMLを記述する必要があります。ShinyにはHTMLを直接挿入できる<code>HTML</code>関数が備わっているため、HTMLをそのまま入力することができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>HTML関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">HTML</span>(<span class="st">"&lt;p&gt;HTML直打ち&lt;/p&gt;"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>しかし、<code>HTML</code>関数を用いるとHTMLのタグ（<code>&lt;p&gt;</code>など）を入力しないといけないため、やや煩雑です。Shinyには、HTMLを追加するための専用の関数（<code>shiny::tags</code>に登録されている関数）が備わっています。こちらを用いることで、簡単にヘッダーや文章を追加することができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>HTMLを記載するための関数群</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">h1</span>(<span class="st">"ヘッダー1"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">p</span>(<span class="st">"パラグラフ"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">br</span>() <span class="co"># 改行</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hr</span>() <span class="co"># 水平線</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>HTMLを追加する関数の一覧は<code>names(shiny::tags)</code>で確認できます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>shiny::tags</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span>tags <span class="sc">|&gt;</span> <span class="fu">names</span>() <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>) <span class="co"># 10個だけ表示</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "a"                "abbr"             "address"          "animate"         
 [5] "animateMotion"    "animateTransform" "area"             "article"         
 [9] "aside"            "audio"           </code></pre>
</div>
</div>
</section>
<section id="入力input" class="level3" data-number="35.4.3">
<h3 data-number="35.4.3" class="anchored" data-anchor-id="入力input"><span class="header-section-number">35.4.3</span> 入力（input）</h3>
<p>静的なHTMLとは異なり、Webアプリケーションではブラウザ上で入力した値に対して演算が行われ、表示が値によって変化するところに特徴があります。Shinyでは、このような入力（input）に対応した各種の部品（control widgets）が備わっています。control widgetsの一覧は<a href="https://shiny.posit.co/r/gallery/widgets/widget-gallery/">Shinyのギャラリー</a>に示されています。</p>
<p>各control widgetsは以下のような<code>Input</code>関数群を用いることで設定することができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Input関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">numericInput</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">inputId =</span> <span class="st">"numeric_input"</span>, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">"数値の入力"</span>, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="dv">10</span>, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">min =</span> <span class="dv">0</span>, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">max =</span> <span class="dv">20</span>, </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">step =</span> <span class="dv">2</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>すべての<code>Input</code>関数は、<code>inputId</code>を第一引数に取ります。この<code>inputId</code>には文字列で指定し、server側で入力データを受け取るときに用います。<code>inputId</code>の使い方についてはserverの解説時に詳しく説明します。第二引数に<code>label</code>を文字列として取ります。<code>label</code>はcontrol widgetsの題名としてwidgetに表示されます。3つ目以降の引数はそれぞれの<code>Input</code>関数で異なっており、<code>numericInput</code>では初期値（<code>value</code>）、最小値（<code>min</code>）、最大値（<code>max</code>）、増加の幅（<code>step</code>）を引数で設定することができます。</p>
<p>以下に<code>Input</code>関数の一覧を示します。</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>表：代表的なInput関数の一覧</caption>
<colgroup>
<col style="width: 23%">
<col style="width: 23%">
<col style="width: 43%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">関数</th>
<th style="text-align: left;">主な引数</th>
<th style="text-align: left;">意味</th>
<th style="text-align: left;">返り値</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">actionButton</td>
<td style="text-align: left;">icon</td>
<td style="text-align: left;">ボタンを追加</td>
<td style="text-align: left;">数値</td>
</tr>
<tr class="even">
<td style="text-align: left;">checkboxInput</td>
<td style="text-align: left;">choices, selected</td>
<td style="text-align: left;">チェックボックスを追加</td>
<td style="text-align: left;">論理型</td>
</tr>
<tr class="odd">
<td style="text-align: left;">checkboxGroupInput</td>
<td style="text-align: left;">choices, selected</td>
<td style="text-align: left;">チェックボックス群を追加</td>
<td style="text-align: left;">文字列</td>
</tr>
<tr class="even">
<td style="text-align: left;">radioButtons</td>
<td style="text-align: left;">choices, selected</td>
<td style="text-align: left;">ラジオボタンを追加</td>
<td style="text-align: left;">文字列</td>
</tr>
<tr class="odd">
<td style="text-align: left;">selectInput</td>
<td style="text-align: left;">choices, selected</td>
<td style="text-align: left;">選択リストを追加する</td>
<td style="text-align: left;">文字列</td>
</tr>
<tr class="even">
<td style="text-align: left;">dateInput</td>
<td style="text-align: left;">value, min, max</td>
<td style="text-align: left;">日付の入力を追加</td>
<td style="text-align: left;">日付</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dateRangeInput</td>
<td style="text-align: left;">start, end, format</td>
<td style="text-align: left;">期間を指定する入力を追加</td>
<td style="text-align: left;">日付</td>
</tr>
<tr class="even">
<td style="text-align: left;">numericInput</td>
<td style="text-align: left;">value, min, max</td>
<td style="text-align: left;">数値を入力するボックスを追加</td>
<td style="text-align: left;">数値</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sliderInput</td>
<td style="text-align: left;">value, min, max</td>
<td style="text-align: left;">数値を選択するスライダーを追加</td>
<td style="text-align: left;">数値</td>
</tr>
<tr class="even">
<td style="text-align: left;">textInput</td>
<td style="text-align: left;">value</td>
<td style="text-align: left;">文字列を入力するボックスを追加</td>
<td style="text-align: left;">文字列</td>
</tr>
<tr class="odd">
<td style="text-align: left;">passwordInput</td>
<td style="text-align: left;">value</td>
<td style="text-align: left;">パスワードを入力するボックスを追加</td>
<td style="text-align: left;">文字列</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><code>Input</code>関数で設定したcontrol widgetsに従い、データがserver.Rに送られます。ui.Rには出力（output）も必要となりますが、outputに関してはサーバサイドの説明の後の方が分かりやすいと思いますので、まずはサーバサイドについて説明し、後ほどoutputについて説明します。</p>
</section>
</section>
<section id="server.rサーバサイド" class="level2" data-number="35.5">
<h2 data-number="35.5" class="anchored" data-anchor-id="server.rサーバサイド"><span class="header-section-number">35.5</span> server.R（サーバサイド）</h2>
<p>次に、server.Rを作成していきます。server.Rは<code>function(input, output, session){}</code>という関数から始まります。この関数・引数はこのまま変更せずに使用し、<code>function</code>の<code>{}</code>の中に実行したいコードを記載していきます。</p>
<section id="outputidの準備" class="level3" data-number="35.5.1">
<h3 data-number="35.5.1" class="anchored" data-anchor-id="outputidの準備"><span class="header-section-number">35.5.1</span> outputIDの準備</h3>
<p>inputで入力されたデータをserver.Rで受け取ったら、server.Rに従い演算を行います。演算結果をoutputとしてHTMLに出力することで、ui.R側でinputに対応したoutputを表示します。server.Rにはこのoutputを準備するためのスクリプトを書くことになります。</p>
<p>outputを準備するときには、<code>output$outputId</code>というオブジェクトに<code>render</code>関数を代入します。以下に例を示します。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>outputをrender関数で準備する</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>outputId <span class="ot">&lt;-</span> <span class="fu">renderText</span>(<span class="st">"Hello world!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>この<code>outputId</code>はui側で読みだして利用します。上記のスクリプトの場合では、<code>outputId</code>には<code>"Hello world!"</code>が入っていますので、ui側で<code>outputId</code>を用いて文字列として<code>"Hello world!"</code>を出力することができます。</p>
<p>とは言ってもこれでは単に文字列をui側で表示するだけになり、serverを介している意味がありません。Shinyが動的に動くようにするには、<code>inputId</code>を用いて演算を行う必要があります。</p>
</section>
<section id="inputidを利用してoutputidを準備する" class="level3" data-number="35.5.2">
<h3 data-number="35.5.2" class="anchored" data-anchor-id="inputidを利用してoutputidを準備する"><span class="header-section-number">35.5.2</span> inputIdを利用してoutputIdを準備する</h3>
<p>server側で<code>inputId</code>の情報を用いる場合には、<code>input$inputId</code>と、リストに似た形の変数を指定します。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>inputIdを用いてoutputを準備する</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>outputId <span class="ot">&lt;-</span> <span class="fu">renderText</span>(<span class="fu">paste</span>(<span class="st">"Hello world"</span>, input<span class="sc">$</span>inputId, <span class="st">"!"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>上記のような形で<code>outputId</code>を準備すると、<code>renderText</code>内のスクリプトが実行されることで、<code>input$inputId</code>の値（文字列や日付、数値等）に従って<code>output$outputId</code>が作成されます。この準備した<code>outputId</code>をui側で利用してやれば、inputの内容に従ったoutputを表示することができます。</p>
<p>ui側では<code>Input</code>関数を用いて<code>inputId</code>を、server側では<code>render</code>関数を用いて<code>outputId</code>を準備します。<code>inputId</code>や<code>outputId</code>が重複していると、どれが正しい<code>Id</code>なのかわからなくなるため、<code>inputId</code>や<code>outputId</code>が重複することは許されていません。単一の名前を<code>inputId</code>、<code>outputId</code>に指定する必要があります。また、<code>input$inputId</code>をui.R内、<code>output$outputId</code>をserver.R内で用いることはできません。</p>
</section>
<section id="render関数群" class="level3" data-number="35.5.3">
<h3 data-number="35.5.3" class="anchored" data-anchor-id="render関数群"><span class="header-section-number">35.5.3</span> Render関数群</h3>
<p>上記の通り、<code>output$outputId</code>を準備する際には、<code>render</code>関数群を用います。この<code>render</code>関数には、outputの種類（テキスト・グラフ・表など）によってそれぞれ専用の関数が準備されています。代表的な<code>render</code>関数の一覧を以下に示します。</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>表：代表的なrender関数の一覧</caption>
<thead>
<tr class="header">
<th style="text-align: left;">関数</th>
<th style="text-align: left;">意味</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">renderPlot</td>
<td style="text-align: left;">グラフ（プロット）を準備する</td>
</tr>
<tr class="even">
<td style="text-align: left;">renderText</td>
<td style="text-align: left;">テキスト（文字列）を準備する</td>
</tr>
<tr class="odd">
<td style="text-align: left;">renderImage</td>
<td style="text-align: left;">画像を準備する</td>
</tr>
<tr class="even">
<td style="text-align: left;">renderTable</td>
<td style="text-align: left;">テーブル（表）を準備する</td>
</tr>
<tr class="odd">
<td style="text-align: left;">renderPrint</td>
<td style="text-align: left;">文字列（consoleの出力）を準備する</td>
</tr>
<tr class="even">
<td style="text-align: left;">renderUI</td>
<td style="text-align: left;">UI（control widget）を準備する</td>
</tr>
<tr class="odd">
<td style="text-align: left;">downloadHandler</td>
<td style="text-align: left;">ダウンロードファイルを準備する</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>outputとして表示したいものがテキストなら<code>renderText</code>、グラフなら<code>renderPlot</code>、表なら<code>renderTable</code>関数を選択します。</p>
<p>server側では通常inputに従いデータを加工して、文字列やグラフ、表を準備します。ただし、このような演算は必ずしも1行のスクリプトで書けるとは限りません。<code>render</code>関数では複数の行に渡るスクリプトを書くことができるようにするため、関数のカッコの内側に中カッコ（<code>{}</code>）を設定できるようになっています。この中カッコの中には複数行のスクリプトを書くことができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>render関数内に複数のスクリプトを記載する</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1行スクリプトの場合には中カッコが無くても問題ない</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>output_text1 <span class="ot">&lt;-</span> <span class="fu">renderText</span>(<span class="st">"Hello world!"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2行以上の時に中カッコなしだとエラー</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>output_text_error <span class="ot">&lt;-</span> </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">renderText</span>(</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    temp <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Hello world,"</span>, input<span class="sc">$</span>input_name, <span class="st">"!"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    temp</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2行以上の時には中カッコを加える</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>output_text2 <span class="ot">&lt;-</span> </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">renderText</span>({</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    temp <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Hello world,"</span>, input<span class="sc">$</span>input_name, <span class="st">"!"</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    temp</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>server.Rには、複数の<code>output$outputId</code>を置くことができます。通常のRスクリプトとは異なり、server.Rの演算は上から下に順番に行われるわけではなく、inputの変更に従って必要な部分が実行される形となっています。また、server.Rでは、演算の部分とテキスト・グラフ・表を準備する部分を分離して記載する方法もあります。この分けて計算する部分（<code>reactive</code>や<code>observe</code>などの関数を用いた演算）に関してはやや複雑ですので、後ほど説明します。</p>
</section>
</section>
<section id="ui.r" class="level2" data-number="35.6">
<h2 data-number="35.6" class="anchored" data-anchor-id="ui.r"><span class="header-section-number">35.6</span> ui.R</h2>
<section id="出力output" class="level3" data-number="35.6.1">
<h3 data-number="35.6.1" class="anchored" data-anchor-id="出力output"><span class="header-section-number">35.6.1</span> 出力（output）</h3>
<p>上記のように、server.Rで<code>output$outputId</code>を準備します。この<code>outputId</code>を準備しただけではUIに表示されないため、ui.R側に出力を準備する必要があります。この出力の準備には、<code>Output</code>関数群を用いることになります。<code>Output</code>関数群の一覧を下の表に示します。</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>表：代表的なOutput関数の一覧</caption>
<colgroup>
<col style="width: 23%">
<col style="width: 30%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">関数</th>
<th style="text-align: left;">対応するrender関数</th>
<th style="text-align: left;">意味</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">textOutput</td>
<td style="text-align: left;">renderText</td>
<td style="text-align: left;">文字列を出力する</td>
</tr>
<tr class="even">
<td style="text-align: left;">verbatimTextOutput</td>
<td style="text-align: left;">renderText・renderPrint</td>
<td style="text-align: left;">コード（文字列）を出力する</td>
</tr>
<tr class="odd">
<td style="text-align: left;">plotOutput</td>
<td style="text-align: left;">renderPlot</td>
<td style="text-align: left;">文字列（consoleの出力）を出力する</td>
</tr>
<tr class="even">
<td style="text-align: left;">tableOutput</td>
<td style="text-align: left;">renderTable</td>
<td style="text-align: left;">表を出力する</td>
</tr>
<tr class="odd">
<td style="text-align: left;">uiOutput</td>
<td style="text-align: left;">renderUI</td>
<td style="text-align: left;">control widgetsを出力する</td>
</tr>
<tr class="even">
<td style="text-align: left;">downloadButton</td>
<td style="text-align: left;">downloadHandler</td>
<td style="text-align: left;">ダウンロード出力用のボタンを準備する</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><code>Output</code>関数はui.Rのレイアウト関連の関数内に記載し、Webページ上に配置していくことになります。<code>Output</code>関数の使い方は単純で、引数に<code>outputId</code>を文字列として取るだけです。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">textOutput</span>(<span class="st">"outputID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><code>Input</code>関数→<code>render</code>関数→<code>Output</code>関数の流れができれば、入力に従う出力を返す、Shinyアプリが出来上がります。inputで<code>inputId</code>を設定し、serverでは<code>input$InputId</code>を変数として用いて<code>output$outputId</code>を作成します。<code>outputId</code>は<code>Output</code>関数の引数とすることでUIに配置します。一連の流れは以下の図のような形となります。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./image/input_render_output_in_Shiny.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" data-glightbox="description: .lightbox-desc-9" title="図9：Input→render→Outputの流れ"><img src="./image/input_render_output_in_Shiny.png" class="img-fluid figure-img" alt="図9：Input→render→Outputの流れ"></a></p>
<figcaption>図9：Input→render→Outputの流れ</figcaption>
</figure>
</div>
</section>
</section>
<section id="global.rとwwwフォルダ" class="level2" data-number="35.7">
<h2 data-number="35.7" class="anchored" data-anchor-id="global.rとwwwフォルダ"><span class="header-section-number">35.7</span> global.Rとwwwフォルダ</h2>
<p>Shinyでは、ui.Rやserver.R内で変数や関数を設定したり、ライブラリを読み込んだりすることができます。ただし、Shinyのファイルが2つに分かれていることもあり、ui.Rやserver.R中にアプリの準備に関わるコードを書き込んでしまうと理解しにくくなります。</p>
<p>このような変数・関数の設定やライブラリの読み込みを分離して記載するために用いられるのが<strong>global.R</strong>というファイルです。これは通常のRファイルであり、ui.Rやserver.Rを作成する時のようにRStudioの操作で作成するものではありません。作成中のアプリのフォルダ、ui.Rやserver.Rが保管されている場所にglobal.Rを作成し、変数・関数の設定、ライブラリの読み込み等を書き込みます。このglobal.RはShinyアプリを起動する際に実行されるため、ui.Rやserver.Rに余分なスクリプトを書き込む必要がなくなります。</p>
<p>また、Shinyで表示するための画像や動画、javascriptのコードなどは、ui.Rやserver.Rと同じフォルダ内にwwwという名前のフォルダを作成し、wwwフォルダ内に保存することで、Shinyで呼び出すことができます。必要に応じてglobal.Rやwwwフォルダを作成することで、コードを整理し、画像等をShinyで取り扱うことができるようになります。</p>
</section>
<section id="observerとreactive" class="level2" data-number="35.8">
<h2 data-number="35.8" class="anchored" data-anchor-id="observerとreactive"><span class="header-section-number">35.8</span> observerとreactive</h2>
<section id="observer" class="level3" data-number="35.8.1">
<h3 data-number="35.8.1" class="anchored" data-anchor-id="observer"><span class="header-section-number">35.8.1</span> observer</h3>
<p>Shinyでは上記の通り、inputが変更されるとserver.Rに書いたスクリプトが自動的に実行されます。Shinyでは、inputに対する変更を読み取り、自動的にそのinputが関与しているserver.R内のコードを実行するようになっています。このような仕組みは<strong>observer</strong>と呼ばれるものによって行われています。observerはその名の通り、inputの変更を「観察」していて、変更に応じて必要なコードをすぐに実行するShinyの内部的な機能です。</p>
<p>このobserverの代表的なものが、<code>output$outputId&lt;-renderXX()</code>という表現と、<code>observe</code>関数です。<code>output$outputId&lt;-renderXX()</code>は上に示した通り、<code>output$outputId</code>に<code>render</code>関数を代入する表現です。この表現が書かれている部分は<code>render</code>関数内の<code>inputId</code>の変更を捉えて、変更があればすぐに<code>render</code>関数内のコードが実行されます。<code>observe</code>関数はそれ自体は何もしませんが、<code>observe</code>関数内に存在する<code>inputId</code>が変更されると<code>inputId</code>に関わるコードを即実行するという機能を持ちます。</p>
<p><code>render</code>関数、<code>observe</code>関数のどちらのobserverもShinyを使っているときにも作成するときにも特に意識する必要はありません。ただし、重めの計算を含むShinyではこのobserverだけを用いていると、Shinyのレスポンスが悪くなってしまいます。</p>
<p>簡単な例として、以下のui.R、server.RからなるShinyアプリを実行するとします。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>ui.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 実際にはuiにlayoutが必要</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sliderInput</span>(<span class="st">"n1"</span>,<span class="st">"N of rpois 1:"</span>,<span class="at">min =</span> <span class="dv">1000000</span>,<span class="at">max =</span> <span class="dv">5000000</span>,<span class="at">value =</span> <span class="dv">2000000</span>),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sliderInput</span>(<span class="st">"n2"</span>,<span class="st">"N of rpois 2:"</span>,<span class="at">min =</span> <span class="dv">1000000</span>,<span class="at">max =</span> <span class="dv">5000000</span>,<span class="at">value =</span> <span class="dv">2000000</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">verbatimTextOutput</span>(<span class="st">"output_rpois"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>server.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#実際にはserverに`function`が必要</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> input<span class="sc">$</span>n1 <span class="sc">|&gt;</span> <span class="fu">rpois</span>(<span class="dv">5</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> input<span class="sc">$</span>n2 <span class="sc">|&gt;</span> <span class="fu">rpois</span>(<span class="dv">5</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span><span class="fu">output_rpois</span>({</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">mean</span>(r1), <span class="fu">mean</span>(r2))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>上記は、平均値5のポアソン分布に従う乱数を100万～500万個、2セット作成し、その平均値を文字列として返すだけのShinyアプリです。返ってくる値はほぼ5になるので何の意味もないアプリですが、このShinyを走らせた場合、1つ目の<code>sliderInput</code>（<code>input$n1</code>）を変更すると、1つ目の<code>sliderInput</code>の返り値（<code>mean(r1)</code>）だけでなく、2つ目の<code>sliderInput</code>の返り値（<code>mean(r2)</code>）も計算され、値が変化します。</p>
<p>だから何なのか、という感じですが、<code>input$n1</code>のみ変更しているのに、<code>input$n1</code>が含まれる<code>r1</code>の演算だけでなく、<code>input$n2</code>のみが含まれる<code>r2</code>の演算も勝手に行われている、ということになります。これがobserverが行っている演算の仕組みで、必要となるコードを自動的に検出し、すべての演算を実行します。図で示すと、以下のような流れで演算が行われていることになります。</p>
<p><a href="./image/shiny_observer.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="./image/shiny_observer.png" class="img-fluid"></a></p>
<ol type="1">
<li><code>input$n1</code>が変更されると、<code>input$n1</code>に依存しているserver.R側の<code>r1</code>が演算されます。</li>
<li>次に、<code>r1</code>に依存している<code>output$output_rpois</code>が演算されるわけですが、この<code>output$output_rpois</code>の演算には<code>r2</code>が必要です。</li>
<li>そこで、Shinyは<code>r2</code>を読みに行きますが、<code>r2</code>は<code>input$n2</code>に依存しています。</li>
<li>ですので、次にshinyは<code>input$n2</code>を読みに行きます。</li>
<li><code>input$n2</code>は変更されていませんが、値はありますので、<code>r2</code>を演算します。</li>
<li><code>r1</code>、<code>r2</code>がそろったので、<code>output$output_rpois</code>を演算します。</li>
</ol>
<p><code>input$n2</code>には変更がなく、<code>r2</code>を演算する必要はなさそうに見えますが、observerは必要なコードをすべて、即時に演算するため、<code>input$n2</code>から<code>r2</code>を演算することになります。</p>
<p>このような演算は<code>r2</code>に当たる部分の演算が軽いうちは大きな問題にはなりませんが、<code>r2</code>の演算がとても重いとき、例えばデータベースに問い合わせて大きなデータを読み出し、時系列分析した結果が代入されている、といった場合には演算に非常に時間がかかるようになり、Shinyアプリのレスポンスが悪くなります。ですので、重めの演算はできれば演算回数を減らしたいところです。</p>
</section>
<section id="reactive" class="level3" data-number="35.8.2">
<h3 data-number="35.8.2" class="anchored" data-anchor-id="reactive"><span class="header-section-number">35.8.2</span> reactive</h3>
<p>上記のように、observerでは必要のない演算を繰り返し行うことになります。このように演算を繰り返したくない場合に用いるのが、<code>reactive</code>関数です。<code>reactive</code>関数は、</p>
<ul>
<li><code>reactive</code>関数内の<code>input$inputId</code>に変更があった場合には演算を行う</li>
<li><code>reactive</code>関数内の<code>input$inputId</code>に変更がない場合は、以前に演算した値（<a href="https://ja.wikipedia.org/wiki/%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5_(%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0)">cache</a>）を返す</li>
</ul>
<p>という特徴を持った関数です。この<code>reactive</code>関数を用いて以下のようにserver.Rを書き直します。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>server.R（reactive関数を用いた方法）</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">reactive</span>(input<span class="sc">$</span>n1 <span class="sc">|&gt;</span> <span class="fu">rpois</span>(<span class="dv">5</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">reactive</span>(input<span class="sc">$</span>n2 <span class="sc">|&gt;</span> <span class="fu">rpois</span>(<span class="dv">5</span>))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span><span class="fu">output_rpois</span>({</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">mean</span>(<span class="fu">r1</span>()), <span class="fu">mean</span>(<span class="fu">r2</span>()))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>上のコードでは、<code>reactive</code>関数の引数として<code>input$n1 |&gt; rpois(5)</code>を取り、<code>r1</code>に代入しています。この<code>r1</code>は関数オブジェクトになっており、値を呼び出す場合にはカッコを付ける（<code>r1()</code>）必要があります。同様に<code>r2</code>を<code>reactive</code>関数を用いて準備しています。</p>
<p>このようなserver.Rを用いた場合、Shinyの初回起動時にはすべての変数（<code>r1</code>、<code>r2</code>、<code>output$output_rpois</code>）が演算されます。これは<code>reactive</code>を用いない場合と同じです。</p>
<p>Shinyアプリの起動後に、<code>input$n1</code>を変更した場合には、上記の<code>reactive</code>を用いない場合とは演算の経路が異なってきます。<code>reactive</code>を用いた場合の演算の経路を以下の図に示します。</p>
<p><a href="./image/shiny_reactive.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="./image/shiny_reactive.png" class="img-fluid"></a></p>
<p>1、2に関してはobserverの時と同じです。<code>output$output_rpois</code>を準備する際に<code>r2</code>を読みに行きますが、この際に<code>r2</code>が<code>reactive</code>で包まれていると、前回演算した時の<code>r2</code>（cache）の値を<code>output$output_rpois</code>の準備に用いることができ、<code>r2</code>を<code>input$n2</code>から再演算しなくなります。</p>
<p>上記のような<code>r1</code>、<code>r2</code>の演算コストの低いShinyアプリでは<code>reactive</code>を設定する必要は必ずしもありませんが、<code>reactive</code>関数をうまく用いることでよりレスポンスのよいアプリを作成することができるでしょう。</p>
</section>
<section id="observeeventとeventreactive" class="level3" data-number="35.8.3">
<h3 data-number="35.8.3" class="anchored" data-anchor-id="observeeventとeventreactive"><span class="header-section-number">35.8.3</span> observeEventとeventReactive</h3>
<section id="observeevent" class="level4" data-number="35.8.3.1">
<h4 data-number="35.8.3.1" class="anchored" data-anchor-id="observeevent"><span class="header-section-number">35.8.3.1</span> observeEvent</h4>
<p><code>reactive</code>は比較的使い方を理解しやすいのですが、<code>observe</code>は何も返さず、使い方のわからない関数です。これは、<code>observe</code>が他の関数を準備するために作成されたprimitiveな（大元の）関数であるためです。<code>observe</code>をより分かりやすく、実用的に利用するための関数が<code>observeEvent</code>関数です。<code>observeEvent</code>関数は第一引数に<code>input$inputId</code>、第二引数にスクリプトを取ります。<code>observeEvent</code>は主に<code>actionButton</code>と共に用い、<code>actionButton</code>を押した時に後ろに記載したコード実行されるような場合に用います。<code>observeEvent</code>自体は返り値を返さないので、この関数自体を<code>output$outputId</code>に代入することはできません。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>server.R: observeEvent関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">observeEvent</span>(input<span class="sc">$</span>inputButton1, {<span class="fu">message</span>(<span class="st">"button pressed."</span>)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="eventreactive" class="level4" data-number="35.8.3.2">
<h4 data-number="35.8.3.2" class="anchored" data-anchor-id="eventreactive"><span class="header-section-number">35.8.3.2</span> eventReactive</h4>
<p>一方で、ボタンを押すなどのイベントによってreactiveに応答を求める時には<code>eventReactive</code>を用います。<code>eventReactive</code>の返り値は関数オブジェクトで、<code>reactive</code>と同じようにカッコをつけることでserver.R内で呼び出すことができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>server.R: eventReactive関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>buttonpressed <span class="ot">&lt;-</span> <span class="fu">eventReactive</span>(input<span class="sc">$</span>inputButton1, {<span class="fu">print</span>(<span class="st">"button pressed."</span>)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
</section>
<section id="reactivevalとreactivevalue" class="level3" data-number="35.8.4">
<h3 data-number="35.8.4" class="anchored" data-anchor-id="reactivevalとreactivevalue"><span class="header-section-number">35.8.4</span> reactiveValとreactiveValue</h3>
<p><code>reavtive</code>の名前がついている関数は他にもあります（<code>reactiveVal</code>、<code>reactiveValue</code>、<code>reactiveTimer</code>）。名前が紛らわしい上にレスポンスが分かりにくい関数群ですが、それぞれに特徴があります。</p>
<p>まず、<code>reactiveVal</code>と<code>reactiveValues</code>です。この2つは値を記録しておくために用いる関数ですが、<code>reactive</code>の特徴（cacheなど）と、<strong>参照渡し</strong>の特徴を持ちます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>reactiveValとreactiveValue</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> y <span class="ot">&lt;-</span> <span class="fu">reactiveVal</span>(<span class="dv">5</span>) <span class="co"># xとyにreactiveVal(5)を代入</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>x <span class="co"># xは5（Quartoでは演算されない）</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>y <span class="co"># yも5（Quartoでは演算されない）</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">x</span>(<span class="dv">10</span>) <span class="co"># xの値を10に更新</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>x <span class="co"># xは10（Quartoでは演算されない）</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>y <span class="co"># yも10になる（Quartoでは演算されない）</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">reactiveValues</span>(<span class="at">a =</span> <span class="dv">10</span>, <span class="at">b =</span> <span class="dv">15</span>) <span class="co"># reactiveValuesには複数の値を設定できる</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>z<span class="sc">$</span>a <span class="co"># render関数などの中で呼び出さないとエラー</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>値渡し（Rの変数はほぼすべてこちら）とは異なり、上記の例であれば<code>x</code>が変更されると<code>y</code>も変更される、参照渡しが行われます。</p>
<p><code>reactiveVal</code>は1つの値のみ、<code>reactiveValues</code>はリストのように複数の値を保存することができます。<code>reactiveVal</code>は通常のRのコンソールでも呼び出すことができますが、<code>reactiveValues</code>は<code>reactive</code>/observerの中でしか呼び出せません。<code>reactiveValues</code>ではリストのように、<code>$</code>を用いて値を呼び出します。</p>
<p><code>reactiveVal</code>も<code>reactiveValues</code>もいまいち使い方が難しい関数ですが、数値を一時的に保存する場合には単なる<code>reactive</code>や通常の変数ではなく、こちらを使うことを想定されているのかもしれません。</p>
</section>
<section id="reactivetimerとinvalidatedlater" class="level3" data-number="35.8.5">
<h3 data-number="35.8.5" class="anchored" data-anchor-id="reactivetimerとinvalidatedlater"><span class="header-section-number">35.8.5</span> reactiveTimerとinvalidatedLater</h3>
<p>Shinyアプリの作成時には、単にinputに対して応答を求めるようなものだけではなく、一定時間ごとに演算や表示を行ってほしい場合もあります。このように、一定時間ごとに演算を行うような場合には、<code>reactiveTimer</code>関数を用います。<code>reactiveTimer</code>関数は引数に時間（<code>intervalMs</code>、ミリ秒単位）を取ります。<code>reactiveTimer</code>関数を用いることで、引数で指定した時間ごとに演算が行われるような仕組みをShinyに持ち込むことができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>reactiveTimer</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">reactiveTimer</span>(<span class="dv">2000</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>outputId <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">a</span>() <span class="co"># reactiveTimerをrender関数内で呼び出す</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2秒ごとに表示される</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"Hello world, "</span>, input<span class="sc">$</span>inputId, <span class="st">"! "</span>, <span class="fu">Sys.time</span>()) </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>上記の例では、<code>input$inputId</code>の変更が<code>output$outputId</code>の更新を引き起こさず、2秒（2000ミリ秒）おきに<code>output$outputId</code>が更新されるようになります。この<code>reactiveTimer</code>と類似した関数として、<code>invalidateLater</code>関数があります。<code>invalidateLater</code>関数は<code>reactiveTimer</code>と同じく初期のShinyから実装されている関数で、より安全でシンプルな関数であるとされています。<code>invalidateLater</code>関数は直接<code>render</code>関数内に書いて用います。ですので、上のコードと同じ演算を以下のような形で実装することができます。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>invalidatedLater</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>outputId <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invalidatedLater</span>(<span class="dv">2000</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"Hello world, "</span>, input<span class="sc">$</span>inputId, <span class="st">"! "</span>, <span class="fu">Sys.time</span>())</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
</section>
<section id="app.r" class="level2" data-number="35.9">
<h2 data-number="35.9" class="anchored" data-anchor-id="app.r"><span class="header-section-number">35.9</span> app.R</h2>
<p>ココまではShinyアプリをui.R、server.Rの2つのファイルで開発する方法について説明してきました。複雑なShinyアプリを作成したい場合には、この2つのファイルを用いる方法が有効です。一方で、小規模のアプリを作る場合には2つのファイルを行き来するのが煩雑となる場合もあります。小規模アプリの開発では、app.Rという1つのファイルでShinyアプリを作成することもできます。</p>
<p>app.Rを準備する場合には、上記の図2に示したファイル作成のウインドウで、「Single file (app.R)」を選択します。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./image/newfile_shiny2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12" data-glightbox="description: .lightbox-desc-12" title="図10：Shinyのファイルを作成する"><img src="./image/newfile_shiny2.png" class="img-fluid figure-img" alt="図10：Shinyのファイルを作成する"></a></p>
<figcaption>図10：Shinyのファイルを作成する</figcaption>
</figure>
</div>
<p>app.Rを作成すると、以下のように1ファイル内に<code>ui</code>と<code>server</code>が記載されたファイルが表示されます。<code>ui</code>には<code>fluidPage</code>や<code>fixedPage</code>、<code>TabsetPanel</code>から始まるレイアウトを代入し、この中身にuiのレイアウト、<code>input</code>、<code>Output</code>等を記載していきます。</p>
<p><code>server</code>には、server.Rと同様に<code>function(input, output)</code>を代入し、<code>function</code>の<code>{}</code>の中に実行したいコードを記載していきます。</p>
<p>最後の<code>shinyApp(ui=ui, server=server)</code>はShinyアプリを実行するための関数です。ですので、app.Rでもui.R/server.Rでも、uiとserverの中身を作成していくことには違いはありません。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>app.Rの構成</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ....コードを記載....</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output){</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># .....コードを記載....</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="shinyに機能を追加するextensions" class="level2" data-number="35.10">
<h2 data-number="35.10" class="anchored" data-anchor-id="shinyに機能を追加するextensions"><span class="header-section-number">35.10</span> Shinyに機能を追加する（Extensions）</h2>
<p>Shinyには、上記の<code>layout</code>、<code>Input</code>、<code>Output</code>、<code>render</code>などの基本的な関数だけでなく、追加の機能を与えるためのライブラリ（Extensions）が豊富に存在します。以下に代表的なExtensionsの例を示します。</p>
<ul>
<li><a href="https://rstudio.github.io/shinythemes/">shinythemes</a><span class="citation" data-cites="shinythemes_bib">(<a href="references.html#ref-shinythemes_bib" role="doc-biblioref">Chang 2021</a>)</span></li>
</ul>
<p>ShinyのデザインをBootstrapに従って変更するためのライブラリです。</p>
<ul>
<li><a href="https://rstudio.github.io/shinydashboard/">shinydashboard</a><span class="citation" data-cites="shinydashboard_bib">(<a href="references.html#ref-shinydashboard_bib" role="doc-biblioref">Chang and Borges Ribeiro 2021</a>)</span></li>
</ul>
<p>Shinyで<a href="https://www.google.com/search?sca_esv=a526368c5945871d&amp;sxsrf=ADLYWIK4gJvNmzBBQh-pQzFeWnI_SKxx2A:1724140556539&amp;q=%E3%83%87%E3%82%B8%E3%82%BF%E3%83%AB%E3%83%80%E3%83%83%E3%82%B7%E3%83%A5%E3%83%9C%E3%83%BC%E3%83%89&amp;udm=2&amp;fbs=AEQNm0BqbPbAzSj6PhNr7nv9Ltx-oFh8tVsgXi1MyFbswNtTUOS5b68chsyOj2QEdx4EPnNHj-rfVa2Eb1VCscGX2ZUj9zg7pD9WhuxXJAj12GW6oeBqw4eGvVgzQxyKznl1ExGJi168qSx2eeXjUNvCmZhFwSaQtcsiZCK7bt8rXXw1KNDgJdghBt7mcicHH5U9gHGYPNgxAD0CsYaK3uh78b4Yn_p-W815iG5byNmUmiBRo1Utr2Q&amp;sa=X&amp;ved=2ahUKEwjP16iLjIOIAxXSslYBHSrNMxYQtKgLegQIGRAB&amp;biw=1912&amp;bih=970&amp;dpr=1">ダッシュボード</a>を簡単に作成するためのライブラリです。基本的にはShinyにダッシュボード用のレイアウト関数を追加するライブラリとなっています。</p>
<ul>
<li><a href="https://rstudio.github.io/bslib/">bslib</a><span class="citation" data-cites="bslib_bib">(<a href="references.html#ref-bslib_bib" role="doc-biblioref">Sievert, Cheng, and Aden-Buie 2024</a>)</span></li>
</ul>
<p><code>shinythemes</code>と同様にShinyのデザインを変更するためのライブラリです。こちらは<a href="./chapter34.html">前章</a>で紹介したR markdown・QuartoのHTML出力のデザインを変更することもできます。また、レイアウトの関数をいくつか備えており、これらのレイアウト関数を用いることでダッシュボードを作成することもできます。<code>shinythemes</code>と<code>shinydashboard</code>はかなり前に開発されたライブラリであるため、この<code>bslib</code>に統合されたような形となっているようです。デザイン性の高いShinyアプリを作成するのであれば、まずこのライブラリを用いることを検討するのがよいでしょう。</p>
<ul>
<li><a href="https://rstudio.github.io/DT/">DT</a><span class="citation" data-cites="DT_bib">(<a href="references.html#ref-DT_bib" role="doc-biblioref">Xie, Cheng, and Tan 2024</a>)</span></li>
</ul>
<p>ShinyやR markdownにJavascript製の表を表示するためのライブラリです。Javascriptで開発され、用いられている<a href="https://datatables.net/">DataTables</a>というライブラリをRに持ち込んだものです。Shinyで用いるための専用の<code>Output</code>、<code>render</code>関数を備えています。</p>
<ul>
<li><a href="https://daattali.com/shiny/shinycssloaders-demo/">shinycssloaders</a><span class="citation" data-cites="shinycssloaders_bib">(<a href="references.html#ref-shinycssloaders_bib" role="doc-biblioref">Sali and Attali 2020</a>)</span></li>
</ul>
<p>Shinyにデータを演算中（ローディング中）であることを示すアニメーションを追加するためのライブラリです。計算が重めのShinyを作成する際に用いるとよいでしょう。</p>
<ul>
<li><a href="https://datastorm-open.github.io/shinymanager/">shinymanager</a><span class="citation" data-cites="shinymanager_bib">(<a href="references.html#ref-shinymanager_bib" role="doc-biblioref">Thieurmel and Perrier 2022</a>)</span></li>
</ul>
<p>ShinyにIDとパスワードによるログイン機構を追加するためのライブラリです。セキュリティ的には怪しいので、あまり信用はできませんが、社内のシステムで用いるぐらいなら耐えられるかもしれません。</p>
<p>Shinyにはこの他にもたくさんのExtensionsが存在します。この<a href="https://github.com/nanxstats/awesome-shiny-extensions">Githubのページ</a>に一覧が示されていますので、参考にされるとよいでしょう。</p>
<p>また、Shinyの開発を行っている企業である<a href="https://www.appsilon.com/">appsilon</a>は、Shiny開発のフレームワークやデザインに関するライブラリを多数開発しています。ハイエンドなShinyアプリを開発したいのであればチャレンジする価値があるかと思います。</p>
</section>
<section id="アプリをデプロイする" class="level2" data-number="35.11">
<h2 data-number="35.11" class="anchored" data-anchor-id="アプリをデプロイする"><span class="header-section-number">35.11</span> アプリをデプロイする</h2>
<p>Shinyアプリを作成したら、他の人に使ってもらってデータを共有・説明したいはずです。Shinyアプリを自分のPCで動かすだけであれば、Rから実行するのが最も簡単ですが、Webを通じてShinyアプリを公表したい場合には、アプリを<strong>デプロイ</strong>する必要があります。</p>
<p>デプロイとは、インターネットでアクセスできるPC（Webサーバー）にWebアプリを実行する環境を整えることを指します。我々が使っている多くのWebサービス（Webアプリ）は、<a href="https://aws.amazon.com/jp/">Amazon Web Services（AWS）</a>や<a href="https://cloud.google.com/">Google Cloud</a>などのWebサーバーで実行されています。Shinyアプリも同様にWebサーバーにデプロイすることで、Webブラウザからアクセスし、利用することができます。</p>
<p>Shinyの開発元であるPositはShinyアプリを簡単にデプロイするサービスである、<a href="https://www.shinyapps.io/">shinyapps.io</a>や<a href="https://posit.co/products/enterprise/connect/">Posit Connect</a>を展開しています。また、同じくPositが開発した<a href="https://posit.co/products/open-source/shinyserver/">Shiny server</a>を用いることで、AWSやGoogle Cloudに比較的簡単にデプロイすることができます。</p>
<p>Posit Connectはエンタープライズ版で、セキュリティ面などがしっかりしています。一方で価格が相当高いので（今は公開されていませんが、昔は$5000/monthぐらいからだったと思います）、個人で安価にデプロイしたいのであればShinyapps.ioかShiny serverの2択となります。</p>
<section id="shinyapps.io" class="level3" data-number="35.11.1">
<h3 data-number="35.11.1" class="anchored" data-anchor-id="shinyapps.io"><span class="header-section-number">35.11.1</span> shinyapps.io</h3>
<p>最も簡単に、無料、もしくは安価にShinyアプリを公開したいのであれば、<strong>Shinyapps.io</strong>を用いるのがよいでしょう。Shinyapps.ioを用いるためには、まずShinyapps.ioのホームページ上でアカウントを作成する必要があります。<a href="https://www.shinyapps.io/">shinyapps.io</a>に移動し、「sign up」からアカウントを作成しましょう。shinyapps.ioのアカウントを作らずに、Googleやfacebookのアカウントを用いてログインすることもできます。</p>
<p><a href="./image/shinyappsio.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="./image/shinyappsio.png" class="img-fluid"></a></p>
<p>アカウントが作成できたら、Rstudio上で、エディタの右上にある「Publish」のボタンをクリックします。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./image/publish_button.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14" data-glightbox="description: .lightbox-desc-14" title="図：Publishボタン"><img src="./image/publish_button.png" class="img-fluid figure-img" alt="図：Publishボタン"></a></p>
<figcaption>図：Publishボタン</figcaption>
</figure>
</div>
<p>publishボタンを押すと、初回には2つのライブラリ（<code>packrat</code><span class="citation" data-cites="packrat_bib">(<a href="references.html#ref-packrat_bib" role="doc-biblioref">Atkins et al. 2023</a>)</span>と<code>rsconnect</code><span class="citation" data-cites="rsconnect_bib">(<a href="references.html#ref-rsconnect_bib" role="doc-biblioref">Atkins et al. 2024</a>)</span>）のインストールが求められますので、RStudioの指示に従いライブラリをインストールします。</p>
<p>次に、接続するアカウントの種類を選択するウインドウが表示されますので、「shinyapps.io」を選択します。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./image/select_connectAccount.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15" data-glightbox="description: .lightbox-desc-15" title="図：サービスの選択画面"><img src="./image/select_connectAccount.png" class="img-fluid figure-img" alt="図：サービスの選択画面"></a></p>
<figcaption>図：サービスの選択画面</figcaption>
</figure>
</div>
<p>shinyapps.ioを選択すると、Tokenを入力するよう指示が出ますので、<a href="https://www.shinyapps.io/">shinyapps.io</a>にログインし、アカウント名が表示されている部分からTokenを表示、コピーして貼り付けます。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./image/connect_shinyapps_account.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16" data-glightbox="description: .lightbox-desc-16" title="図：Tokenを貼り付ける"><img src="./image/connect_shinyapps_account.png" class="img-fluid figure-img" alt="図：Tokenを貼り付ける"></a></p>
<figcaption>図：Tokenを貼り付ける</figcaption>
</figure>
</div>
<p>Tokenを貼り付け、Connect Accountを選択すると、shinyapps.ioのアカウントとRStudioが繋がり、簡単にShinyアプリをデプロイできるようになります。</p>
<p>この状態で再び「Publish」をクリックすると、下のようなダイアログが表示されます。Publishポタンを押せばデプロイは完了です。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./image/publish_shinyapp.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17" data-glightbox="description: .lightbox-desc-17" title="図：PublishでShinyapps.ioにデプロイする"><img src="./image/publish_shinyapp.png" class="img-fluid figure-img" alt="図：PublishでShinyapps.ioにデプロイする"></a></p>
<figcaption>図：PublishでShinyapps.ioにデプロイする</figcaption>
</figure>
</div>
<p>Publishした後にWebブラウザからshinyapps.ioにログインすると、以下のようなページが表示されます。Publishしたアプリのリストが表示されていますので、以下の図の赤枠の部分をクリックするとアプリを起動することができます。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="./image/shinyappsio_applist.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18" data-glightbox="description: .lightbox-desc-18" title="図：アプリケーションの起動"><img src="./image/shinyappsio_applist.png" class="img-fluid figure-img" alt="図：アプリケーションの起動"></a></p>
<figcaption>図：アプリケーションの起動</figcaption>
</figure>
</div>
<p>この方法で実行したShinyアプリはローカル（自分のPC）で演算するのではなく、Positが管理しているWebサーバでアプリを実行するようになっています。URLをコピーし、共有したい人にアクセスしてもらうことでShinyアプリをWeb上で実行してもらうことができます。</p>
</section>
<section id="shiny-server" class="level3" data-number="35.11.2">
<h3 data-number="35.11.2" class="anchored" data-anchor-id="shiny-server"><span class="header-section-number">35.11.2</span> shiny server</h3>
<p>上記のshinyapps.ioを用いる方法は非常に簡単で、お金もかかりませんが、一方で演算速度は遅く、たくさんの人が同時に接続することもできません。また、月あたりの使用時間が制限されています。shinyapps.ioは基本的にすべての人にShinyアプリを公開する形でデプロイするため、秘密情報を含むShinyアプリに利用するのにも向いていません。</p>
<p>このようなサーバーの速度・接続時間・秘密情報の問題を解決するには、自前でWebサーバーを立ち上げ、管理する必要があります。自前でサーバーを立ち上げるには、個人や会社のサーバーを利用する方法とWebサーバー（Amazon Web ServicesやGoogle Cloud）を用いる方法がありますが、いずれの方法においてもShinyアプリのデプロイには<a href="https://posit.co/products/open-source/shiny-server/">Shiny server</a>を用いるのが一般的です。Shiny serverを用いたShinyアプリのデプロイには<a href="https://ja.wikipedia.org/wiki/Docker">コンテナ</a>を用いることが多いかと思います。Shiny server、コンテナやコンテナを用いたデプロイの方法はこの入門書の範囲を超えてしまいますので、<a href="https://qiita.com/amori/items/425e44d6a7c1e0fbec84">こちらの記事</a>や<a href="https://qiita.com/xjorv/items/947ca01b45d6207bc4e3">この記事</a>などを参照下さい。</p>
</section>
<section id="githubで共有する" class="level3" data-number="35.11.3">
<h3 data-number="35.11.3" class="anchored" data-anchor-id="githubで共有する"><span class="header-section-number">35.11.3</span> GitHubで共有する</h3>
<p>上記の方法では、Webサーバーを用いてRでの演算をしており、自分のPC（ローカル）では演算を行いません。Webサーバーを用いる方法では、サーバーを借りる必要があり、お金がかかります。サーバーを借りず、アプリを使用する方のPCで直接Shinyアプリを実行する方法であれば、このようなサーバーを準備する必要はありません。</p>
<p>Shinyのコードだけを準備して、アプリを使用する方のPCでShinyアプリを実行する場合には、<a href="https://github.com/">GitHub</a>を用いるのが簡単です。GitHubは<a href="https://git-scm.com/">Git</a>と呼ばれるバージョン管理システムのうち、<a href="https://ja.wikipedia.org/wiki/%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA">リモートレポシトリ</a>と呼ばれるものを取り扱うWebサービスです。GitHubには公開・非公開のリモートレポジトリが多数登録されており、他者とコードを共有してプログラミングを行う際の重要なツールとなっています。</p>
<p>GitやGitHubの詳しい説明は<a href="https://backlog.com/ja/git-tutorial/">他の参考資料</a>をご参照下さい。</p>
<p>GitHubでは通常Gitのシステムを用いて、リモートレポジトリを作成・更新・アップロードするようにできていますが、Shinyアプリを共有する場合には、直接GitHubにコードを書き込んでも問題はありません。</p>
<p>GitHubにShinyアプリのコードを登録すると、<code>Shiny::runGitHub</code>関数でそのアプリを実行できるようになります。この章の一番始めに紹介した以下のコードは、この<code>runGitHub</code>関数を用いてShinyアプリを実行するものとなっています。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>runGitHub関数</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(shiny)) <span class="fu">install.packages</span>((<span class="st">"shiny"</span>)) <span class="co"># shinyの読み込み</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">runGitHub</span>(<span class="st">"surv_sim"</span>, <span class="st">"sb8001at"</span>) <span class="co"># runGitHub関数で"surv_sim"というレポジトリのアプリを読み込み、実行</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>上記の例では、<code>"sb8001at"</code>というアカウントのGitHubのレポジトリである<code>"surv_sim"</code>を読み込み、Rで実行させるためのコードです。GitHubではこのようなレポジトリを通常<code>sb8001at/surv_sim</code>という形で表現します。このレポジトリは公開されているもので、<a href="https://github.com/sb8001at/surv_sim">このページ</a>でコードを確認することができます。</p>
<p><a href="./image/github_repo.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="./image/github_repo.png" class="img-fluid"></a></p>
<p>上記ページの「ui.R」を選択すると、以下のようにui.Rのコードを読むことができます。</p>
<p><a href="./image/github_uiR.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="./image/github_uiR.png" class="img-fluid"></a></p>
<p>上記の<code>runGitHub</code>関数はこのページのui.R、server.R、global.Rを読み込み、Shinyアプリを実行する関数です。GitHubでのアカウント作成・レポジトリの準備やコードの入力方法に関しては、この教科書の範囲から外れるためココでは詳細を説明しませんので、<a href="https://yoshitaku-jp.hatenablog.com/entry/2018/07/07/225642">この記事</a>などを参考にしていただければと思います。</p>
<p>最後に、Shinyアプリで用いられるUI、Serverのコードと実行時のページをイメージするためのShinyアプリを以下に示します。以下のコードをコピペしてRで実行していただければ、UIやServerのイメージがつかみやすいかと思います。</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Shinyのサンプルアプリ</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(shiny)) <span class="fu">install.packages</span>((<span class="st">"shiny"</span>)) <span class="co"># shinyの読み込み</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">runGitHub</span>(<span class="st">"shiny_sample"</span>, <span class="st">"sb8001at"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>


<!-- -->

<div class="hidden" aria-hidden="true">
<span class="glightbox-desc lightbox-desc-1">図1：Shinyのファイルを作成する</span>
<span class="glightbox-desc lightbox-desc-2">図2：Shinyのファイルを作成する</span>
<span class="glightbox-desc lightbox-desc-3">図3：Shinyアプリの例とRun Appアイコン</span>
<span class="glightbox-desc lightbox-desc-4">図4：Shinyサンプルを起動する</span>
<span class="glightbox-desc lightbox-desc-5">図5：Number of binsを変更する</span>
<span class="glightbox-desc lightbox-desc-6">図6：Shinyアプリのおおまかな仕組み</span>
<span class="glightbox-desc lightbox-desc-7">図7：navbarPageによるタブ</span>
<span class="glightbox-desc lightbox-desc-8">図8：sidebarLayoutの例</span>
<span class="glightbox-desc lightbox-desc-9">図9：Input→render→Outputの流れ</span>
<span class="glightbox-desc lightbox-desc-12">図10：Shinyのファイルを作成する</span>
<span class="glightbox-desc lightbox-desc-14">図：Publishボタン</span>
<span class="glightbox-desc lightbox-desc-15">図：サービスの選択画面</span>
<span class="glightbox-desc lightbox-desc-16">図：Tokenを貼り付ける</span>
<span class="glightbox-desc lightbox-desc-17">図：PublishでShinyapps.ioにデプロイする</span>
<span class="glightbox-desc lightbox-desc-18">図：アプリケーションの起動</span>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-packrat_bib" class="csl-entry" role="listitem">
Atkins, Aron, Toph Allen, Kevin Ushey, Jonathan McPherson, Joe Cheng, and JJ Allaire. 2023. <em>Packrat: A Dependency Management System for Projects and Their r Package Dependencies</em>. <a href="https://CRAN.R-project.org/package=packrat">https://CRAN.R-project.org/package=packrat</a>.
</div>
<div id="ref-rsconnect_bib" class="csl-entry" role="listitem">
Atkins, Aron, Toph Allen, Hadley Wickham, Jonathan McPherson, and JJ Allaire. 2024. <em>Rsconnect: Deploy Docs, Apps, and APIs to ’Posit Connect’, ’Shinyapps.io’, and ’RPubs’</em>. <a href="https://CRAN.R-project.org/package=rsconnect">https://CRAN.R-project.org/package=rsconnect</a>.
</div>
<div id="ref-shinythemes_bib" class="csl-entry" role="listitem">
Chang, Winston. 2021. <em>Shinythemes: Themes for Shiny</em>. <a href="https://CRAN.R-project.org/package=shinythemes">https://CRAN.R-project.org/package=shinythemes</a>.
</div>
<div id="ref-shinydashboard_bib" class="csl-entry" role="listitem">
Chang, Winston, and Barbara Borges Ribeiro. 2021. <em>Shinydashboard: Create Dashboards with ’Shiny’</em>. <a href="https://CRAN.R-project.org/package=shinydashboard">https://CRAN.R-project.org/package=shinydashboard</a>.
</div>
<div id="ref-shiny_bib" class="csl-entry" role="listitem">
Chang, Winston, Joe Cheng, JJ Allaire, Carson Sievert, Barret Schloerke, Yihui Xie, Jeff Allen, Jonathan McPherson, Alan Dipert, and Barbara Borges. 2024. <em>Shiny: Web Application Framework for r</em>. <a href="https://CRAN.R-project.org/package=shiny">https://CRAN.R-project.org/package=shiny</a>.
</div>
<div id="ref-DBI_bib" class="csl-entry" role="listitem">
R Special Interest Group on Databases (R-SIG-DB), Hadley Wickham, and Kirill Müller. 2024. <em>DBI: R Database Interface</em>. <a href="https://CRAN.R-project.org/package=DBI">https://CRAN.R-project.org/package=DBI</a>.
</div>
<div id="ref-shinycssloaders_bib" class="csl-entry" role="listitem">
Sali, Andras, and Dean Attali. 2020. <em>Shinycssloaders: Add Loading Animations to a ’Shiny’ Output While It’s Recalculating</em>. <a href="https://CRAN.R-project.org/package=shinycssloaders">https://CRAN.R-project.org/package=shinycssloaders</a>.
</div>
<div id="ref-bslib_bib" class="csl-entry" role="listitem">
Sievert, Carson, Joe Cheng, and Garrick Aden-Buie. 2024. <em>Bslib: Custom ’Bootstrap’ ’Sass’ Themes for ’Shiny’ and ’Rmarkdown’</em>. <a href="https://CRAN.R-project.org/package=bslib">https://CRAN.R-project.org/package=bslib</a>.
</div>
<div id="ref-shinymanager_bib" class="csl-entry" role="listitem">
Thieurmel, Benoit, and Victor Perrier. 2022. <em>Shinymanager: Authentication Management for ’Shiny’ Applications</em>. <a href="https://CRAN.R-project.org/package=shinymanager">https://CRAN.R-project.org/package=shinymanager</a>.
</div>
<div id="ref-dbplyr_bib" class="csl-entry" role="listitem">
Wickham, Hadley, Maximilian Girlich, and Edgar Ruiz. 2024. <em>Dbplyr: A ’Dplyr’ Back End for Databases</em>. <a href="https://CRAN.R-project.org/package=dbplyr">https://CRAN.R-project.org/package=dbplyr</a>.
</div>
<div id="ref-DT_bib" class="csl-entry" role="listitem">
Xie, Yihui, Joe Cheng, and Xianying Tan. 2024. <em>DT: A Wrapper of the JavaScript Library ’DataTables’</em>. <a href="https://CRAN.R-project.org/package=DT">https://CRAN.R-project.org/package=DT</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter34.html" class="pagination-link" aria-label="R markdown・Quarto">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">R markdown・Quarto</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./summary.html" class="pagination-link" aria-label="おわりに">
        <span class="nav-page-text">おわりに</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb26" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Shiny</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>データを解析した後には、その結果を用いて他の人にデータや解析の意味を説明する必要があります。説明するために用いるものの一つが文書やプレゼンテーションです。文書やプレゼンテーションはR markdown・Quarto（<span class="co">[</span><span class="ot">34章</span><span class="co">](./chapter34.html)</span>参照）で作成することができます。</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>もう一つの方法は、データを表示するためのウェブページを作成する方法です。ウェブページもR markdownで作成することはできますが、R markdownだけではインタラクティブなウェブページ、例えばデータを入力して、そのデータに応じたグラフを作成するようなもの、は作成することができません。このインタラクティブなウェブページを作成するためのRのツールが**[Shiny](https://shiny.posit.co/)**<span class="co">[</span><span class="ot">@shiny_bib</span><span class="co">]</span>です。</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">## Shinyとwebアプリケーション</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>Shinyは**webアプリケーション**と呼ばれる、webページ（HTML）の生成（ユーザーインターフェース/フロントエンド）とサーバでの演算（サーバサイド）を行うアプリケーションの一種です。</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>通常のwebアプリケーションでは、ユーザーがwebページにアクセスし、情報を入力（例えば検索する文字を入力）すると、情報がサーバへと送られます。サーバでは入力された情報と、サーバー内のデータベースとを比較し、必要な情報を集めてHTMLファイルを作成します。このHTMLがユーザーに送られ、検索結果が表示される、といったような仕組みになっています。</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>このようなタイプのwebアプリケーションを作成するためのツールはたくさんあります。典型的な例として、<span class="co">[</span><span class="ot">Ruby on Rails</span><span class="co">](https://rubyonrails.org/)</span>、<span class="co">[</span><span class="ot">Django</span><span class="co">](https://www.djangoproject.com/)</span>などがあります。これらのツールは**webアプリケーションフレームワーク**と呼ばれており、我々がよく用いているwebページ・webサービスに用いられています。</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>Shinyはこれらのフレームワークと比較するとかなり機能が制限されたツールです。Shinyにはユーザーインターフェースとサーバサイドを構築する機能はありますが、演算は基本的にRで行われるためレスポンスは遅めです。また、データベースは必須ではないため、データベースを用いるのであればR上で別途ライブラリを用いる必要があります。データベースではなく、csvなどでデータを準備することもあります。また、セキュリティ面をサポートするツールはほとんどありません。</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="fu">## データ分析のためのwebアプリケーション開発ツール：Shiny</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>Shinyはデータを説明することに特化したwebアプリケーション開発ツールで、Rのツール、例えば<span class="in">`ggplot2`</span>や<span class="in">`plotly`</span>、<span class="in">`leaflet`</span>などを用いてデータを表示し、統計結果を示すのに適したツールです。Shiny自体は2012年頃から開発され、2017年頃にver.1.0となった、古参のデータ用webアプリケーションツールです。</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>最近になって<span class="co">[</span><span class="ot">Plotly Dash</span><span class="co">](https://dash.plotly.com/)</span>や<span class="co">[</span><span class="ot">Streamlit</span><span class="co">](https://streamlit.io/)</span>などの、Pythonを用いる同様のツールが開発され、あっという間に<span class="co">[</span><span class="ot">Shinyよりメジャーなツール</span><span class="co">](https://www.datarevenue.com/en-blog/data-dashboarding-streamlit-vs-dash-vs-shiny-vs-voila)</span>になってしまいました。特にStreamlitは今（2024年）注目されているツールです。現状Shinyの方が完成度は高めですが、Streamlitはたくさんの開発者が寄ってたかって改善している最中ですので、いずれStreamlitの完成度がShinyを上回りそうです。<span class="co">[</span><span class="ot">Pythonを使ったShiny</span><span class="co">](https://shiny.posit.co/py/)</span>も開発されていますが、Streamlitの勢いに勝てるかどうかは疑わしいところです。</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>しかし、Rでウェブアプリケーションを作成するのであれば、Shinyはすぐに使えて、ある程度完成度の高いものを作るのも難しくない、良いツールです。ココではShinyでの基本的なWebアプリケーションの作成方法を簡単に説明します。</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>Shinyはかなり複雑なこともできる、高度なRライブラリの一つです。すべてをココで説明することはできませんので、詳しく学びたい方は教科書（<span class="co">[</span><span class="ot">日本語のもの</span><span class="co">](https://www.amazon.co.jp/R%E3%81%A8Shiny%E3%81%A7%E4%BD%9C%E3%82%8BWeb%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3-%E6%A2%85%E6%B4%A5-%E9%9B%84%E4%B8%80/dp/4863542577/ref=sr_1_1?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&amp;crid=HX3OCPFCPSYO&amp;dib=eyJ2IjoiMSJ9.BpAoqimHpmL9r5ZTaR_qcYaPnGVnTh5pu6NrlNNLBel1eBc0WGDAkLs_CHmziXL_gylxT0vLxK98ExeEUjvHe4R9JHEbh8C7Mc1xS25iFS4SFpsfMl4HEpjiV2mVu913d1p0IgGDkqNpEzB_YPI8CQCL8S0CGmkMYVygDxe7AXRlMPmddWN5DwlThSZVx_khJnN0qCb0eJzpDKXnk-1efXmXbQJWFkTwF8t0PquBNYFpPjE8Msp2zdWYdEomGdJn-dlJAULxGBDXox5_YkGRoLHRjt6lv-y58SuDFJ_B7aQ.LPu0T7M8outatlmmZU2dEH60tiv78naxBhGDxtZQQDU&amp;dib_tag=se&amp;keywords=Shiny+R&amp;qid=1719730273&amp;sprefix=shiny+r%2Caps%2C169&amp;sr=8-1)</span>や<span class="co">[</span><span class="ot">英語のもの</span><span class="co">](https://www.amazon.co.jp/Mastering-Shiny-Interactive-Reports-Dashboards-ebook/dp/B093VG4C58/ref=sr_1_5?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&amp;crid=HX3OCPFCPSYO&amp;dib=eyJ2IjoiMSJ9.BpAoqimHpmL9r5ZTaR_qcYaPnGVnTh5pu6NrlNNLBel1eBc0WGDAkLs_CHmziXL_gylxT0vLxK98ExeEUjvHe4R9JHEbh8C7Mc1xS25iFS4SFpsfMl4HEpjiV2mVu913d1p0IgGDkqNpEzB_YPI8CQCL8S0CGmkMYVygDxe7AXRlMPmddWN5DwlThSZVx_khJnN0qCb0eJzpDKXnk-1efXmXbQJWFkTwF8t0PquBNYFpPjE8Msp2zdWYdEomGdJn-dlJAULxGBDXox5_YkGRoLHRjt6lv-y58SuDFJ_B7aQ.LPu0T7M8outatlmmZU2dEH60tiv78naxBhGDxtZQQDU&amp;dib_tag=se&amp;keywords=Shiny+R&amp;qid=1719730273&amp;sprefix=shiny+r%2Caps%2C169&amp;sr=8-5)</span>）をご一読されることをオススメいたします。</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>この教科書でもShinyで作成したいくつかのWebアプリケーションを統計解析手法の説明に用いています。以下のコードを実行することで、この教科書で用いているWebアプリケーションを起動することができます。また、Webアプリケーションを停止するには、コンソールを選択してEscを押します。</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="生存時間解析シミュレーター", eval=FALSE}</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="in">if(!require(shiny)) install.packages(("shiny"))</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="in">shiny::runGitHub("surv_sim", "sb8001at")</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="k-meansのアニメーション", eval=FALSE}</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="in">if(!require(shiny)) install.packages(("shiny"))</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="in">shiny::runGitHub("kmeans_animated", "sb8001at")</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="時系列：ARIMAシミュレーター", eval=FALSE}</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a><span class="in">if(!require(shiny)) install.packages(("shiny"))</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a><span class="in">shiny::runGitHub("ARIMAsim", "sb8001at")</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## Shinyの基礎</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>ShinyのWebアプリケーションをR Studioで作成する場合、まずは左上のNew Fileアイコンから「Shiny Web App...」を選択します。</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a><span class="al">![図1：Shinyのファイルを作成する](./image/newfile_shiny.png)</span></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>「Shiny Web App...」を選択すると、以下のようなウインドウが表示されます。このウインドウでは、Webアプリケーションの名前、ファイルを作成するディレクトリ（フォルダ）に加えて、Web Appを1つのファイルで作成するか（Single File）、複数のファイルで作成するか（Multiple File）を選択します。「Single File」を選択すると、**app.R**という1つのファイルが選択したディレクトリ内に作成されます。一方で「Multiple File」を選択すると、**ui.R**と**server.R**という2つのファイルが作成されます。</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>どちらの形式を用いてもアプリケーションを作成するための関数などは共通していますが、アプリケーション作成に慣れるまでは「Multiple File」を用いるのがおすすめです。この章では、まず「Multiple File」での作成方法を一通り説明した後で、「Single File」で作成する方法を説明します。</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a><span class="al">![図2：Shinyのファイルを作成する](./image/newfile_shiny2.png)</span></span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>上記のウインドウで「Create」をクリックすると、以下のようにディレクトリに<span class="in">`ui.R`</span>と<span class="in">`server.R`</span>という2つのファイルが作成されます。このファイルにはWebアプリケーションのスクリプト（サンプルアプリ）が書かれています。</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>作成された<span class="in">`ui.R`</span>や<span class="in">`server.R`</span>をRstudioで開くと、右上に「Run App」というアイコンが出てきます。これを押すとサンプルアプリを実行することができます。</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a><span class="al">![図3：Shinyアプリの例とRun Appアイコン](./image/shiny_template.png)</span></span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>Webアプリケーション（Shinyアプリ）を実行すると、以下の図のようなページがWebブラウザに表示されます。このページのうち、左の部分（Number of bins:）はマウスで操作することができます。</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a><span class="al">![図4：Shinyサンプルを起動する](./image/shiny_gayser10.png)</span></span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a>実際にNumber of binsを変更し、50としたのが以下の図です。<span class="in">`bins`</span>、つまりヒストグラムの棒の数の設定を変えると、右のヒストグラムの表示が変化します。</span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a><span class="al">![図5：Number of binsを変更する](./image/shiny_gayser49.png)</span></span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>このようなShinyアプリの動作は、以下の図のようなメカニズムで構成されています。まず、Shinyアプリのユーザーインターフェース（UI）で入力したデータは、Serverに送られます。Serverでは入力データを取り込んで<span class="in">`ggplot2`</span>でグラフを作成し、グラフを含んだHTMLが作成されます。このHTMLがWebブラウザで表示されることで入力データに従ったグラフが表示されます。</span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a><span class="al">![図6：Shinyアプリのおおまかな仕組み](./image/web_app.png)</span></span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a>通常のWebアプリケーションフレームワークでは、Rの部分に別の言語（RubyやPythonなど）が入り、さらにデータベースと接続されているのが一般的です。Shinyではデータベースは必須ではありませんが、もちろんデータベースを用いたWebアプリケーションを作成することもできます。データベースを用いたアプリケーションを作成する場合には、データベースを取り使うためのライブラリ（<span class="co">[</span><span class="ot">`DBI`</span><span class="co">]("https://dbi.r-dbi.org/")[</span><span class="ot">@DBI_bib</span><span class="co">]</span>や<span class="co">[</span><span class="ot">`dbplyr`</span><span class="co">]("https://dbplyr.tidyverse.org/")[</span><span class="ot">@dbplyr_bib</span><span class="co">]</span>など）を用いることになります。</span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a>上記のUI、Serverをそれぞれ構築するためのファイルが、<span class="in">`ui.R`</span>と<span class="in">`server.R`</span>です。ココからはまず<span class="in">`ui.R`</span>の構築について説明し、その後<span class="in">`server.R`</span>について説明します。</span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a><span class="fu">## ui.R（ユーザーインターフェース）</span></span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a><span class="in">`ui.R`</span>には以下の4点をそれぞれ準備します。</span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Webページのレイアウト</span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>HTMLの要素（文章や画像）</span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>入力</span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>出力</span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a>上記の4つのうち、Webページのレイアウトについては上の図には表現されていない部分です。HTMLの要素は文章のヘッダーや本文、画像などの表示に関わる部分です。入力と出力に関しては、上記の図に示した通り、入力データをserver.Rに送る部分と、server.Rで演算された結果をWebページ上に表示させる部分になります。以下にそれぞれの要素について説明していきます。</span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a><span class="fu">### Webページのレイアウト</span></span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a>まずは、Webページ全体のレイアウトをui.Rに指定する必要があります。レイアウトの指定には、以下の表に示す関数が用いられます。</span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a><span class="in">library(readxl)</span></span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a><span class="in">library(shiny)</span></span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a><span class="in">d &lt;- readxl::read_excel("./data/shiny_functions.xlsx")</span></span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(d, caption="表：代表的なレイアウト指定用の関数の一覧")</span></span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a>レイアウトを決める関数にはある程度上下関係があります。最も上位に配置するレイアウトは<span class="in">`navbarPage`</span>関数で、全体のページに渡るタブを作成します。</span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a><span class="al">![図7：navbarPageによるタブ](./image/navbarPage_example.png)</span></span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a><span class="in">`navbarPage`</span>関数では、「タブを配置すること」だけしか設定できないため、タブの中身を別途準備する必要があります。タブの中身は<span class="in">`tabPanel`</span>関数を用いて記載していきます。<span class="in">`tabPanel`</span>関数の第一引数にはタブの名前（<span class="in">`title`</span>）を指定します。上記の図では、タブに記載された「textOutput」や「Plot・Table Output」というのが<span class="in">`title`</span>に当たります。</span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a><span class="in">`navbarPage`</span>関数の下位には<span class="in">`fixedPage`</span>関数・<span class="in">`fluidPage`</span>関数を配置するのが一般的です。<span class="in">`navbarPage`</span>関数はタブを用いない場合には使用しないため、タブなしのページの場合には<span class="in">`fixedPage`</span>関数、<span class="in">`fluidPage`</span>関数が最上位のレイアウトとなります。<span class="in">`fixedPage`</span>関数、<span class="in">`fluidPage`</span>関数の差はレイアウトの幅を固定するか（<span class="in">`fixedPage`</span>関数）、ウインドウの幅に合わせて調整するか（<span class="in">`fluidPage`</span>関数）の違いです。</span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a><span class="in">`fixedPage`</span>関数、<span class="in">`fluidPage`</span>関数の下位には<span class="in">`sidebarLayout`</span>関数や<span class="in">`column`</span>関数を配置します。<span class="in">`sidebarLayout`</span>関数の下位には<span class="in">`sidebarPanel`</span>関数と<span class="in">`mainPanel`</span>関数を配置し、それぞれ1/3の幅を持つサイドバーと2/3の幅を持つメインパネルの2つを設定します。以下の図の左側（binsの入力）がサイドバー、右側（グラフ）がメインパネルとなります。</span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a><span class="al">![図8：sidebarLayoutの例](./image/shiny_gayser10.png)</span></span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a>このサイドバーとメインパネルの幅は<span class="in">`width`</span>引数で変更することができます。Shinyでは、R markdownと同様に<span class="co">[</span><span class="ot">Bootstrap</span><span class="co">](https://getbootstrap.jp/)</span>によるデザインが採用されています。Bootstrapでは、Webページの幅全体を12とすることとされていますので、この幅12に従い、サイドバーとメインパネルの<span class="in">`width`</span>の和が12となるように調整します。デフォルトではサイドバーの<span class="in">`width`</span>が4、メインパネルの<span class="in">`width`</span>が8となっています。</span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a><span class="in">`column`</span>関数は上記の<span class="in">`sidebarPanel`</span>関数や<span class="in">`mainPanel`</span>関数とよく似たものですが、上位に<span class="in">`sidebarLayout`</span>関数を必要としないものです。<span class="in">`column`</span>関数も<span class="in">`width`</span>引数で幅指定しますが、やはりすべての<span class="in">`column`</span>の<span class="in">`width`</span>の和が12となるように設定します。</span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a><span class="in">`column`</span>関数や<span class="in">`mainPanel`</span>関数にタブを設定するためのレイアウトが<span class="in">`tabsetPanel`</span>関数です。ちょうど<span class="in">`navbarPanel`</span>-<span class="in">`tabPanel`</span>の関係と同様に、<span class="in">`tabsetPanel`</span>関数の下には<span class="in">`tabPanel`</span>関数を配置します。</span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a>以上のように、Shinyのレイアウトに関する関数はたくさんあり、上下関係が複雑です。上記で紹介していない関数もありますので、実際にはさらに複雑なレイアウトを取ることもできます。</span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a>レイアウトの上下関係は、関数をネストすることで指定することができます。例えば、以下の例では<span class="in">`fluidPage`</span>の下に<span class="in">`sidebarLayout`</span>、<span class="in">`sidebarLayout`</span>の下に<span class="in">`sidebarPanel`</span>と<span class="in">`mainPanel`</span>を配置し、<span class="in">`mainPanel`</span>の下に<span class="in">`tabsetPanel`</span>、<span class="in">`tabsetPanel`</span>の下に<span class="in">`tabPanel`</span>を2枚配置しています。</span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE, filename="レイアウトの例"}</span></span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a><span class="in">fluidPage(</span></span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a><span class="in">  sidebarLayout(</span></span>
<span id="cb26-126"><a href="#cb26-126" aria-hidden="true" tabindex="-1"></a><span class="in">    sidebarPanel(</span></span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a><span class="in">      # サイドバーの中身を記載</span></span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a><span class="in">    mainPanel(</span></span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a><span class="in">      # メインパネルの中身を記載</span></span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a><span class="in">      tabsetPanel(</span></span>
<span id="cb26-132"><a href="#cb26-132" aria-hidden="true" tabindex="-1"></a><span class="in">        tabPanel(</span></span>
<span id="cb26-133"><a href="#cb26-133" aria-hidden="true" tabindex="-1"></a><span class="in">          title = "パネル1"</span></span>
<span id="cb26-134"><a href="#cb26-134" aria-hidden="true" tabindex="-1"></a><span class="in">          # タブパネル1の中身を記載</span></span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a><span class="in">          ),</span></span>
<span id="cb26-136"><a href="#cb26-136" aria-hidden="true" tabindex="-1"></a><span class="in">        tabPanel(</span></span>
<span id="cb26-137"><a href="#cb26-137" aria-hidden="true" tabindex="-1"></a><span class="in">          title = "パネル2"</span></span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a><span class="in">          # タブパネル2の中身を記載</span></span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a><span class="in">          )</span></span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb26-143"><a href="#cb26-143" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb26-144"><a href="#cb26-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-145"><a href="#cb26-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-146"><a href="#cb26-146" aria-hidden="true" tabindex="-1"></a>Rは関数型言語ですので、すべてのレイアウトは関数、つまりカッコつきのスクリプトになります。また、<span class="in">`sidebarPanel`</span>や1枚目の<span class="in">`tabPanel`</span>のカッコの後にコンマがついています。1つのカッコの中に複数の要素がある場合にはコンマが必要です。ただし、カッコ内の最後の要素（上の例では<span class="in">`tabPanel(title = "パネル2")`</span>）にはコンマは必要ありません。</span>
<span id="cb26-147"><a href="#cb26-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-148"><a href="#cb26-148" aria-hidden="true" tabindex="-1"></a>Shinyのui.Rの記載では、レイアウトに関する関数が多層にネストされ、意味がわかりにくくなりやすいため、「Run App」でアプリを表示し、確認しながら作成するのがよいでしょう。</span>
<span id="cb26-149"><a href="#cb26-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-150"><a href="#cb26-150" aria-hidden="true" tabindex="-1"></a><span class="fu">### HTMLの要素</span></span>
<span id="cb26-151"><a href="#cb26-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-152"><a href="#cb26-152" aria-hidden="true" tabindex="-1"></a>HTMLではヘッダーや改行、パラグラフは以下のように表現されます。</span>
<span id="cb26-153"><a href="#cb26-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-154"><a href="#cb26-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{html, eval = FALSE, filename="HTMLの記述"}</span></span>
<span id="cb26-155"><a href="#cb26-155" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;h1&gt; ヘッダー &lt;/h1&gt;</span></span>
<span id="cb26-156"><a href="#cb26-156" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;br&gt; # 改行</span></span>
<span id="cb26-157"><a href="#cb26-157" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;p&gt; パラグラフ（文）&lt;/p&gt;</span></span>
<span id="cb26-158"><a href="#cb26-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-159"><a href="#cb26-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-160"><a href="#cb26-160" aria-hidden="true" tabindex="-1"></a>Shinyも基本的にはHTMLをRから出力する仕組みとなっているため、Webアプリに文章を追加したい場合などにはHTMLを記述する必要があります。ShinyにはHTMLを直接挿入できる<span class="in">`HTML`</span>関数が備わっているため、HTMLをそのまま入力することができます。</span>
<span id="cb26-161"><a href="#cb26-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-162"><a href="#cb26-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE, filename="HTML関数"}</span></span>
<span id="cb26-163"><a href="#cb26-163" aria-hidden="true" tabindex="-1"></a><span class="in">HTML("&lt;p&gt;HTML直打ち&lt;/p&gt;")</span></span>
<span id="cb26-164"><a href="#cb26-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-165"><a href="#cb26-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-166"><a href="#cb26-166" aria-hidden="true" tabindex="-1"></a>しかし、<span class="in">`HTML`</span>関数を用いるとHTMLのタグ（<span class="in">`&lt;p&gt;`</span>など）を入力しないといけないため、やや煩雑です。Shinyには、HTMLを追加するための専用の関数（<span class="in">`shiny::tags`</span>に登録されている関数）が備わっています。こちらを用いることで、簡単にヘッダーや文章を追加することができます。</span>
<span id="cb26-167"><a href="#cb26-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-168"><a href="#cb26-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, filename = "HTMLを記載するための関数群"}</span></span>
<span id="cb26-169"><a href="#cb26-169" aria-hidden="true" tabindex="-1"></a><span class="in">h1("ヘッダー1")</span></span>
<span id="cb26-170"><a href="#cb26-170" aria-hidden="true" tabindex="-1"></a><span class="in">p("パラグラフ")</span></span>
<span id="cb26-171"><a href="#cb26-171" aria-hidden="true" tabindex="-1"></a><span class="in">br() # 改行</span></span>
<span id="cb26-172"><a href="#cb26-172" aria-hidden="true" tabindex="-1"></a><span class="in">hr() # 水平線</span></span>
<span id="cb26-173"><a href="#cb26-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-174"><a href="#cb26-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-175"><a href="#cb26-175" aria-hidden="true" tabindex="-1"></a>HTMLを追加する関数の一覧は<span class="in">`names(shiny::tags)`</span>で確認できます。</span>
<span id="cb26-176"><a href="#cb26-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-177"><a href="#cb26-177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="shiny::tags"}</span></span>
<span id="cb26-178"><a href="#cb26-178" aria-hidden="true" tabindex="-1"></a><span class="in">shiny::tags |&gt; names() |&gt; head(10) # 10個だけ表示</span></span>
<span id="cb26-179"><a href="#cb26-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-180"><a href="#cb26-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-181"><a href="#cb26-181" aria-hidden="true" tabindex="-1"></a><span class="fu">### 入力（input）</span></span>
<span id="cb26-182"><a href="#cb26-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-183"><a href="#cb26-183" aria-hidden="true" tabindex="-1"></a>静的なHTMLとは異なり、Webアプリケーションではブラウザ上で入力した値に対して演算が行われ、表示が値によって変化するところに特徴があります。Shinyでは、このような入力（input）に対応した各種の部品（control widgets）が備わっています。control widgetsの一覧は<span class="co">[</span><span class="ot">Shinyのギャラリー</span><span class="co">](https://shiny.posit.co/r/gallery/widgets/widget-gallery/)</span>に示されています。</span>
<span id="cb26-184"><a href="#cb26-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-185"><a href="#cb26-185" aria-hidden="true" tabindex="-1"></a>各control widgetsは以下のような<span class="in">`Input`</span>関数群を用いることで設定することができます。</span>
<span id="cb26-186"><a href="#cb26-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-187"><a href="#cb26-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE, filename = "Input関数"}</span></span>
<span id="cb26-188"><a href="#cb26-188" aria-hidden="true" tabindex="-1"></a><span class="in">numericInput(</span></span>
<span id="cb26-189"><a href="#cb26-189" aria-hidden="true" tabindex="-1"></a><span class="in">  inputId = "numeric_input", </span></span>
<span id="cb26-190"><a href="#cb26-190" aria-hidden="true" tabindex="-1"></a><span class="in">  label = "数値の入力", </span></span>
<span id="cb26-191"><a href="#cb26-191" aria-hidden="true" tabindex="-1"></a><span class="in">  value = 10, </span></span>
<span id="cb26-192"><a href="#cb26-192" aria-hidden="true" tabindex="-1"></a><span class="in">  min = 0, </span></span>
<span id="cb26-193"><a href="#cb26-193" aria-hidden="true" tabindex="-1"></a><span class="in">  max = 20, </span></span>
<span id="cb26-194"><a href="#cb26-194" aria-hidden="true" tabindex="-1"></a><span class="in">  step = 2</span></span>
<span id="cb26-195"><a href="#cb26-195" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb26-196"><a href="#cb26-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-197"><a href="#cb26-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-198"><a href="#cb26-198" aria-hidden="true" tabindex="-1"></a>すべての<span class="in">`Input`</span>関数は、<span class="in">`inputId`</span>を第一引数に取ります。この<span class="in">`inputId`</span>には文字列で指定し、server側で入力データを受け取るときに用います。<span class="in">`inputId`</span>の使い方についてはserverの解説時に詳しく説明します。第二引数に<span class="in">`label`</span>を文字列として取ります。<span class="in">`label`</span>はcontrol widgetsの題名としてwidgetに表示されます。3つ目以降の引数はそれぞれの<span class="in">`Input`</span>関数で異なっており、<span class="in">`numericInput`</span>では初期値（<span class="in">`value`</span>）、最小値（<span class="in">`min`</span>）、最大値（<span class="in">`max`</span>）、増加の幅（<span class="in">`step`</span>）を引数で設定することができます。</span>
<span id="cb26-199"><a href="#cb26-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-200"><a href="#cb26-200" aria-hidden="true" tabindex="-1"></a>以下に<span class="in">`Input`</span>関数の一覧を示します。</span>
<span id="cb26-201"><a href="#cb26-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-202"><a href="#cb26-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, message=FALSE}</span></span>
<span id="cb26-203"><a href="#cb26-203" aria-hidden="true" tabindex="-1"></a><span class="in">d &lt;- readxl::read_excel("./data/shiny_functions.xlsx", sheet = 2)</span></span>
<span id="cb26-204"><a href="#cb26-204" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(d, caption="表：代表的なInput関数の一覧")</span></span>
<span id="cb26-205"><a href="#cb26-205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-206"><a href="#cb26-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-207"><a href="#cb26-207" aria-hidden="true" tabindex="-1"></a><span class="in">`Input`</span>関数で設定したcontrol widgetsに従い、データがserver.Rに送られます。ui.Rには出力（output）も必要となりますが、outputに関してはサーバサイドの説明の後の方が分かりやすいと思いますので、まずはサーバサイドについて説明し、後ほどoutputについて説明します。</span>
<span id="cb26-208"><a href="#cb26-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-209"><a href="#cb26-209" aria-hidden="true" tabindex="-1"></a><span class="fu">## server.R（サーバサイド）</span></span>
<span id="cb26-210"><a href="#cb26-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-211"><a href="#cb26-211" aria-hidden="true" tabindex="-1"></a>次に、server.Rを作成していきます。server.Rは<span class="in">`function(input, output, session){}`</span>という関数から始まります。この関数・引数はこのまま変更せずに使用し、<span class="in">`function`</span>の<span class="in">`{}`</span>の中に実行したいコードを記載していきます。</span>
<span id="cb26-212"><a href="#cb26-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-213"><a href="#cb26-213" aria-hidden="true" tabindex="-1"></a><span class="fu">### outputIDの準備</span></span>
<span id="cb26-214"><a href="#cb26-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-215"><a href="#cb26-215" aria-hidden="true" tabindex="-1"></a>inputで入力されたデータをserver.Rで受け取ったら、server.Rに従い演算を行います。演算結果をoutputとしてHTMLに出力することで、ui.R側でinputに対応したoutputを表示します。server.Rにはこのoutputを準備するためのスクリプトを書くことになります。</span>
<span id="cb26-216"><a href="#cb26-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-217"><a href="#cb26-217" aria-hidden="true" tabindex="-1"></a>outputを準備するときには、<span class="in">`output$outputId`</span>というオブジェクトに<span class="in">`render`</span>関数を代入します。以下に例を示します。</span>
<span id="cb26-218"><a href="#cb26-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-219"><a href="#cb26-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE, filename = "outputをrender関数で準備する"}</span></span>
<span id="cb26-220"><a href="#cb26-220" aria-hidden="true" tabindex="-1"></a><span class="in">output$outputId &lt;- renderText("Hello world!")</span></span>
<span id="cb26-221"><a href="#cb26-221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-222"><a href="#cb26-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-223"><a href="#cb26-223" aria-hidden="true" tabindex="-1"></a>この<span class="in">`outputId`</span>はui側で読みだして利用します。上記のスクリプトの場合では、<span class="in">`outputId`</span>には<span class="in">`"Hello world!"`</span>が入っていますので、ui側で<span class="in">`outputId`</span>を用いて文字列として<span class="in">`"Hello world!"`</span>を出力することができます。</span>
<span id="cb26-224"><a href="#cb26-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-225"><a href="#cb26-225" aria-hidden="true" tabindex="-1"></a>とは言ってもこれでは単に文字列をui側で表示するだけになり、serverを介している意味がありません。Shinyが動的に動くようにするには、<span class="in">`inputId`</span>を用いて演算を行う必要があります。</span>
<span id="cb26-226"><a href="#cb26-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-227"><a href="#cb26-227" aria-hidden="true" tabindex="-1"></a><span class="fu">### inputIdを利用してoutputIdを準備する</span></span>
<span id="cb26-228"><a href="#cb26-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-229"><a href="#cb26-229" aria-hidden="true" tabindex="-1"></a>server側で<span class="in">`inputId`</span>の情報を用いる場合には、<span class="in">`input$inputId`</span>と、リストに似た形の変数を指定します。</span>
<span id="cb26-230"><a href="#cb26-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-231"><a href="#cb26-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE, filename = "inputIdを用いてoutputを準備する"}</span></span>
<span id="cb26-232"><a href="#cb26-232" aria-hidden="true" tabindex="-1"></a><span class="in">output$outputId &lt;- renderText(paste("Hello world", input$inputId, "!"))</span></span>
<span id="cb26-233"><a href="#cb26-233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-234"><a href="#cb26-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-235"><a href="#cb26-235" aria-hidden="true" tabindex="-1"></a>上記のような形で<span class="in">`outputId`</span>を準備すると、<span class="in">`renderText`</span>内のスクリプトが実行されることで、<span class="in">`input$inputId`</span>の値（文字列や日付、数値等）に従って<span class="in">`output$outputId`</span>が作成されます。この準備した<span class="in">`outputId`</span>をui側で利用してやれば、inputの内容に従ったoutputを表示することができます。</span>
<span id="cb26-236"><a href="#cb26-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-237"><a href="#cb26-237" aria-hidden="true" tabindex="-1"></a>ui側では<span class="in">`Input`</span>関数を用いて<span class="in">`inputId`</span>を、server側では<span class="in">`render`</span>関数を用いて<span class="in">`outputId`</span>を準備します。<span class="in">`inputId`</span>や<span class="in">`outputId`</span>が重複していると、どれが正しい<span class="in">`Id`</span>なのかわからなくなるため、<span class="in">`inputId`</span>や<span class="in">`outputId`</span>が重複することは許されていません。単一の名前を<span class="in">`inputId`</span>、<span class="in">`outputId`</span>に指定する必要があります。また、<span class="in">`input$inputId`</span>をui.R内、<span class="in">`output$outputId`</span>をserver.R内で用いることはできません。</span>
<span id="cb26-238"><a href="#cb26-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-239"><a href="#cb26-239" aria-hidden="true" tabindex="-1"></a><span class="fu">### Render関数群</span></span>
<span id="cb26-240"><a href="#cb26-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-241"><a href="#cb26-241" aria-hidden="true" tabindex="-1"></a>上記の通り、<span class="in">`output$outputId`</span>を準備する際には、<span class="in">`render`</span>関数群を用います。この<span class="in">`render`</span>関数には、outputの種類（テキスト・グラフ・表など）によってそれぞれ専用の関数が準備されています。代表的な<span class="in">`render`</span>関数の一覧を以下に示します。</span>
<span id="cb26-242"><a href="#cb26-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-243"><a href="#cb26-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, message=FALSE}</span></span>
<span id="cb26-244"><a href="#cb26-244" aria-hidden="true" tabindex="-1"></a><span class="in">d &lt;- readxl::read_excel("./data/shiny_functions.xlsx", sheet = 3)</span></span>
<span id="cb26-245"><a href="#cb26-245" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(d, caption="表：代表的なrender関数の一覧")</span></span>
<span id="cb26-246"><a href="#cb26-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-247"><a href="#cb26-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-248"><a href="#cb26-248" aria-hidden="true" tabindex="-1"></a>outputとして表示したいものがテキストなら<span class="in">`renderText`</span>、グラフなら<span class="in">`renderPlot`</span>、表なら<span class="in">`renderTable`</span>関数を選択します。</span>
<span id="cb26-249"><a href="#cb26-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-250"><a href="#cb26-250" aria-hidden="true" tabindex="-1"></a>server側では通常inputに従いデータを加工して、文字列やグラフ、表を準備します。ただし、このような演算は必ずしも1行のスクリプトで書けるとは限りません。<span class="in">`render`</span>関数では複数の行に渡るスクリプトを書くことができるようにするため、関数のカッコの内側に中カッコ（<span class="in">`{}`</span>）を設定できるようになっています。この中カッコの中には複数行のスクリプトを書くことができます。</span>
<span id="cb26-251"><a href="#cb26-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-252"><a href="#cb26-252" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, filename="render関数内に複数のスクリプトを記載する"}</span></span>
<span id="cb26-253"><a href="#cb26-253" aria-hidden="true" tabindex="-1"></a><span class="in"># 1行スクリプトの場合には中カッコが無くても問題ない</span></span>
<span id="cb26-254"><a href="#cb26-254" aria-hidden="true" tabindex="-1"></a><span class="in">output$output_text1 &lt;- renderText("Hello world!")</span></span>
<span id="cb26-255"><a href="#cb26-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-256"><a href="#cb26-256" aria-hidden="true" tabindex="-1"></a><span class="in"># 2行以上の時に中カッコなしだとエラー</span></span>
<span id="cb26-257"><a href="#cb26-257" aria-hidden="true" tabindex="-1"></a><span class="in">output$output_text_error &lt;- </span></span>
<span id="cb26-258"><a href="#cb26-258" aria-hidden="true" tabindex="-1"></a><span class="in">  renderText(</span></span>
<span id="cb26-259"><a href="#cb26-259" aria-hidden="true" tabindex="-1"></a><span class="in">    temp &lt;- paste("Hello world,", input$input_name, "!")</span></span>
<span id="cb26-260"><a href="#cb26-260" aria-hidden="true" tabindex="-1"></a><span class="in">    temp</span></span>
<span id="cb26-261"><a href="#cb26-261" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb26-262"><a href="#cb26-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-263"><a href="#cb26-263" aria-hidden="true" tabindex="-1"></a><span class="in"># 2行以上の時には中カッコを加える</span></span>
<span id="cb26-264"><a href="#cb26-264" aria-hidden="true" tabindex="-1"></a><span class="in">output$output_text2 &lt;- </span></span>
<span id="cb26-265"><a href="#cb26-265" aria-hidden="true" tabindex="-1"></a><span class="in">  renderText({</span></span>
<span id="cb26-266"><a href="#cb26-266" aria-hidden="true" tabindex="-1"></a><span class="in">    temp &lt;- paste("Hello world,", input$input_name, "!")</span></span>
<span id="cb26-267"><a href="#cb26-267" aria-hidden="true" tabindex="-1"></a><span class="in">    temp</span></span>
<span id="cb26-268"><a href="#cb26-268" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb26-269"><a href="#cb26-269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-270"><a href="#cb26-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-271"><a href="#cb26-271" aria-hidden="true" tabindex="-1"></a>server.Rには、複数の<span class="in">`output$outputId`</span>を置くことができます。通常のRスクリプトとは異なり、server.Rの演算は上から下に順番に行われるわけではなく、inputの変更に従って必要な部分が実行される形となっています。また、server.Rでは、演算の部分とテキスト・グラフ・表を準備する部分を分離して記載する方法もあります。この分けて計算する部分（<span class="in">`reactive`</span>や<span class="in">`observe`</span>などの関数を用いた演算）に関してはやや複雑ですので、後ほど説明します。</span>
<span id="cb26-272"><a href="#cb26-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-273"><a href="#cb26-273" aria-hidden="true" tabindex="-1"></a><span class="fu">## ui.R</span></span>
<span id="cb26-274"><a href="#cb26-274" aria-hidden="true" tabindex="-1"></a><span class="fu">### 出力（output）</span></span>
<span id="cb26-275"><a href="#cb26-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-276"><a href="#cb26-276" aria-hidden="true" tabindex="-1"></a>上記のように、server.Rで<span class="in">`output$outputId`</span>を準備します。この<span class="in">`outputId`</span>を準備しただけではUIに表示されないため、ui.R側に出力を準備する必要があります。この出力の準備には、<span class="in">`Output`</span>関数群を用いることになります。<span class="in">`Output`</span>関数群の一覧を下の表に示します。</span>
<span id="cb26-277"><a href="#cb26-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-278"><a href="#cb26-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, message=FALSE}</span></span>
<span id="cb26-279"><a href="#cb26-279" aria-hidden="true" tabindex="-1"></a><span class="in">d &lt;- readxl::read_excel("./data/shiny_functions.xlsx", sheet = 4)</span></span>
<span id="cb26-280"><a href="#cb26-280" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(d, caption="表：代表的なOutput関数の一覧")</span></span>
<span id="cb26-281"><a href="#cb26-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-282"><a href="#cb26-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-283"><a href="#cb26-283" aria-hidden="true" tabindex="-1"></a><span class="in">`Output`</span>関数はui.Rのレイアウト関連の関数内に記載し、Webページ上に配置していくことになります。<span class="in">`Output`</span>関数の使い方は単純で、引数に<span class="in">`outputId`</span>を文字列として取るだけです。</span>
<span id="cb26-284"><a href="#cb26-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-285"><a href="#cb26-285" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, filename="Output関数"}</span></span>
<span id="cb26-286"><a href="#cb26-286" aria-hidden="true" tabindex="-1"></a><span class="in">textOutput("outputID")</span></span>
<span id="cb26-287"><a href="#cb26-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-288"><a href="#cb26-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-289"><a href="#cb26-289" aria-hidden="true" tabindex="-1"></a><span class="in">`Input`</span>関数→<span class="in">`render`</span>関数→<span class="in">`Output`</span>関数の流れができれば、入力に従う出力を返す、Shinyアプリが出来上がります。inputで<span class="in">`inputId`</span>を設定し、serverでは<span class="in">`input$InputId`</span>を変数として用いて<span class="in">`output$outputId`</span>を作成します。<span class="in">`outputId`</span>は<span class="in">`Output`</span>関数の引数とすることでUIに配置します。一連の流れは以下の図のような形となります。</span>
<span id="cb26-290"><a href="#cb26-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-291"><a href="#cb26-291" aria-hidden="true" tabindex="-1"></a><span class="al">![図9：Input→render→Outputの流れ](./image/input_render_output_in_Shiny.png)</span></span>
<span id="cb26-292"><a href="#cb26-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-293"><a href="#cb26-293" aria-hidden="true" tabindex="-1"></a><span class="fu">## global.Rとwwwフォルダ</span></span>
<span id="cb26-294"><a href="#cb26-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-295"><a href="#cb26-295" aria-hidden="true" tabindex="-1"></a>Shinyでは、ui.Rやserver.R内で変数や関数を設定したり、ライブラリを読み込んだりすることができます。ただし、Shinyのファイルが2つに分かれていることもあり、ui.Rやserver.R中にアプリの準備に関わるコードを書き込んでしまうと理解しにくくなります。</span>
<span id="cb26-296"><a href="#cb26-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-297"><a href="#cb26-297" aria-hidden="true" tabindex="-1"></a>このような変数・関数の設定やライブラリの読み込みを分離して記載するために用いられるのが**global.R**というファイルです。これは通常のRファイルであり、ui.Rやserver.Rを作成する時のようにRStudioの操作で作成するものではありません。作成中のアプリのフォルダ、ui.Rやserver.Rが保管されている場所にglobal.Rを作成し、変数・関数の設定、ライブラリの読み込み等を書き込みます。このglobal.RはShinyアプリを起動する際に実行されるため、ui.Rやserver.Rに余分なスクリプトを書き込む必要がなくなります。</span>
<span id="cb26-298"><a href="#cb26-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-299"><a href="#cb26-299" aria-hidden="true" tabindex="-1"></a>また、Shinyで表示するための画像や動画、javascriptのコードなどは、ui.Rやserver.Rと同じフォルダ内にwwwという名前のフォルダを作成し、wwwフォルダ内に保存することで、Shinyで呼び出すことができます。必要に応じてglobal.Rやwwwフォルダを作成することで、コードを整理し、画像等をShinyで取り扱うことができるようになります。</span>
<span id="cb26-300"><a href="#cb26-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-301"><a href="#cb26-301" aria-hidden="true" tabindex="-1"></a><span class="fu">## observerとreactive</span></span>
<span id="cb26-302"><a href="#cb26-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-303"><a href="#cb26-303" aria-hidden="true" tabindex="-1"></a><span class="fu">### observer</span></span>
<span id="cb26-304"><a href="#cb26-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-305"><a href="#cb26-305" aria-hidden="true" tabindex="-1"></a>Shinyでは上記の通り、inputが変更されるとserver.Rに書いたスクリプトが自動的に実行されます。Shinyでは、inputに対する変更を読み取り、自動的にそのinputが関与しているserver.R内のコードを実行するようになっています。このような仕組みは**observer**と呼ばれるものによって行われています。observerはその名の通り、inputの変更を「観察」していて、変更に応じて必要なコードをすぐに実行するShinyの内部的な機能です。</span>
<span id="cb26-306"><a href="#cb26-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-307"><a href="#cb26-307" aria-hidden="true" tabindex="-1"></a>このobserverの代表的なものが、<span class="in">`output$outputId&lt;-renderXX()`</span>という表現と、<span class="in">`observe`</span>関数です。<span class="in">`output$outputId&lt;-renderXX()`</span>は上に示した通り、<span class="in">`output$outputId`</span>に<span class="in">`render`</span>関数を代入する表現です。この表現が書かれている部分は<span class="in">`render`</span>関数内の<span class="in">`inputId`</span>の変更を捉えて、変更があればすぐに<span class="in">`render`</span>関数内のコードが実行されます。<span class="in">`observe`</span>関数はそれ自体は何もしませんが、<span class="in">`observe`</span>関数内に存在する<span class="in">`inputId`</span>が変更されると<span class="in">`inputId`</span>に関わるコードを即実行するという機能を持ちます。</span>
<span id="cb26-308"><a href="#cb26-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-309"><a href="#cb26-309" aria-hidden="true" tabindex="-1"></a><span class="in">`render`</span>関数、<span class="in">`observe`</span>関数のどちらのobserverもShinyを使っているときにも作成するときにも特に意識する必要はありません。ただし、重めの計算を含むShinyではこのobserverだけを用いていると、Shinyのレスポンスが悪くなってしまいます。</span>
<span id="cb26-310"><a href="#cb26-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-311"><a href="#cb26-311" aria-hidden="true" tabindex="-1"></a>簡単な例として、以下のui.R、server.RからなるShinyアプリを実行するとします。</span>
<span id="cb26-312"><a href="#cb26-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-313"><a href="#cb26-313" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, filename="ui.R"}</span></span>
<span id="cb26-314"><a href="#cb26-314" aria-hidden="true" tabindex="-1"></a><span class="in"># 実際にはuiにlayoutが必要</span></span>
<span id="cb26-315"><a href="#cb26-315" aria-hidden="true" tabindex="-1"></a><span class="in">sliderInput("n1","N of rpois 1:",min = 1000000,max = 5000000,value = 2000000),</span></span>
<span id="cb26-316"><a href="#cb26-316" aria-hidden="true" tabindex="-1"></a><span class="in">sliderInput("n2","N of rpois 2:",min = 1000000,max = 5000000,value = 2000000),</span></span>
<span id="cb26-317"><a href="#cb26-317" aria-hidden="true" tabindex="-1"></a><span class="in">verbatimTextOutput("output_rpois")</span></span>
<span id="cb26-318"><a href="#cb26-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-319"><a href="#cb26-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-320"><a href="#cb26-320" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, filename="server.R"}</span></span>
<span id="cb26-321"><a href="#cb26-321" aria-hidden="true" tabindex="-1"></a><span class="in">#実際にはserverに`function`が必要</span></span>
<span id="cb26-322"><a href="#cb26-322" aria-hidden="true" tabindex="-1"></a><span class="in">r1 &lt;- input$n1 |&gt; rpois(5)</span></span>
<span id="cb26-323"><a href="#cb26-323" aria-hidden="true" tabindex="-1"></a><span class="in">r2 &lt;- input$n2 |&gt; rpois(5)</span></span>
<span id="cb26-324"><a href="#cb26-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-325"><a href="#cb26-325" aria-hidden="true" tabindex="-1"></a><span class="in">output$output_rpois({</span></span>
<span id="cb26-326"><a href="#cb26-326" aria-hidden="true" tabindex="-1"></a><span class="in">  paste(mean(r1), mean(r2))</span></span>
<span id="cb26-327"><a href="#cb26-327" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb26-328"><a href="#cb26-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-329"><a href="#cb26-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-330"><a href="#cb26-330" aria-hidden="true" tabindex="-1"></a>上記は、平均値5のポアソン分布に従う乱数を100万～500万個、2セット作成し、その平均値を文字列として返すだけのShinyアプリです。返ってくる値はほぼ5になるので何の意味もないアプリですが、このShinyを走らせた場合、1つ目の<span class="in">`sliderInput`</span>（<span class="in">`input$n1`</span>）を変更すると、1つ目の<span class="in">`sliderInput`</span>の返り値（<span class="in">`mean(r1)`</span>）だけでなく、2つ目の<span class="in">`sliderInput`</span>の返り値（<span class="in">`mean(r2)`</span>）も計算され、値が変化します。</span>
<span id="cb26-331"><a href="#cb26-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-332"><a href="#cb26-332" aria-hidden="true" tabindex="-1"></a>だから何なのか、という感じですが、<span class="in">`input$n1`</span>のみ変更しているのに、<span class="in">`input$n1`</span>が含まれる<span class="in">`r1`</span>の演算だけでなく、<span class="in">`input$n2`</span>のみが含まれる<span class="in">`r2`</span>の演算も勝手に行われている、ということになります。これがobserverが行っている演算の仕組みで、必要となるコードを自動的に検出し、すべての演算を実行します。図で示すと、以下のような流れで演算が行われていることになります。</span>
<span id="cb26-333"><a href="#cb26-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-334"><a href="#cb26-334" aria-hidden="true" tabindex="-1"></a><span class="al">![](./image/shiny_observer.png)</span></span>
<span id="cb26-335"><a href="#cb26-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-336"><a href="#cb26-336" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span><span class="in">`input$n1`</span>が変更されると、<span class="in">`input$n1`</span>に依存しているserver.R側の<span class="in">`r1`</span>が演算されます。</span>
<span id="cb26-337"><a href="#cb26-337" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>次に、<span class="in">`r1`</span>に依存している<span class="in">`output$output_rpois`</span>が演算されるわけですが、この<span class="in">`output$output_rpois`</span>の演算には<span class="in">`r2`</span>が必要です。</span>
<span id="cb26-338"><a href="#cb26-338" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>そこで、Shinyは<span class="in">`r2`</span>を読みに行きますが、<span class="in">`r2`</span>は<span class="in">`input$n2`</span>に依存しています。</span>
<span id="cb26-339"><a href="#cb26-339" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>ですので、次にshinyは<span class="in">`input$n2`</span>を読みに行きます。</span>
<span id="cb26-340"><a href="#cb26-340" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span><span class="in">`input$n2`</span>は変更されていませんが、値はありますので、<span class="in">`r2`</span>を演算します。</span>
<span id="cb26-341"><a href="#cb26-341" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span><span class="in">`r1`</span>、<span class="in">`r2`</span>がそろったので、<span class="in">`output$output_rpois`</span>を演算します。</span>
<span id="cb26-342"><a href="#cb26-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-343"><a href="#cb26-343" aria-hidden="true" tabindex="-1"></a><span class="in">`input$n2`</span>には変更がなく、<span class="in">`r2`</span>を演算する必要はなさそうに見えますが、observerは必要なコードをすべて、即時に演算するため、<span class="in">`input$n2`</span>から<span class="in">`r2`</span>を演算することになります。</span>
<span id="cb26-344"><a href="#cb26-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-345"><a href="#cb26-345" aria-hidden="true" tabindex="-1"></a>このような演算は<span class="in">`r2`</span>に当たる部分の演算が軽いうちは大きな問題にはなりませんが、<span class="in">`r2`</span>の演算がとても重いとき、例えばデータベースに問い合わせて大きなデータを読み出し、時系列分析した結果が代入されている、といった場合には演算に非常に時間がかかるようになり、Shinyアプリのレスポンスが悪くなります。ですので、重めの演算はできれば演算回数を減らしたいところです。</span>
<span id="cb26-346"><a href="#cb26-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-347"><a href="#cb26-347" aria-hidden="true" tabindex="-1"></a><span class="fu">### reactive</span></span>
<span id="cb26-348"><a href="#cb26-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-349"><a href="#cb26-349" aria-hidden="true" tabindex="-1"></a>上記のように、observerでは必要のない演算を繰り返し行うことになります。このように演算を繰り返したくない場合に用いるのが、<span class="in">`reactive`</span>関数です。<span class="in">`reactive`</span>関数は、</span>
<span id="cb26-350"><a href="#cb26-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-351"><a href="#cb26-351" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`reactive`</span>関数内の<span class="in">`input$inputId`</span>に変更があった場合には演算を行う</span>
<span id="cb26-352"><a href="#cb26-352" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`reactive`</span>関数内の<span class="in">`input$inputId`</span>に変更がない場合は、以前に演算した値（<span class="co">[</span><span class="ot">cache</span><span class="co">]</span>(https://ja.wikipedia.org/wiki/%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5_(%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0))）を返す</span>
<span id="cb26-353"><a href="#cb26-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-354"><a href="#cb26-354" aria-hidden="true" tabindex="-1"></a>という特徴を持った関数です。この<span class="in">`reactive`</span>関数を用いて以下のようにserver.Rを書き直します。</span>
<span id="cb26-355"><a href="#cb26-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-356"><a href="#cb26-356" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, filename="server.R（reactive関数を用いた方法）"}</span></span>
<span id="cb26-357"><a href="#cb26-357" aria-hidden="true" tabindex="-1"></a><span class="in">r1 &lt;- reactive(input$n1 |&gt; rpois(5))</span></span>
<span id="cb26-358"><a href="#cb26-358" aria-hidden="true" tabindex="-1"></a><span class="in">r2 &lt;- reactive(input$n2 |&gt; rpois(5))</span></span>
<span id="cb26-359"><a href="#cb26-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-360"><a href="#cb26-360" aria-hidden="true" tabindex="-1"></a><span class="in">output$output_rpois({</span></span>
<span id="cb26-361"><a href="#cb26-361" aria-hidden="true" tabindex="-1"></a><span class="in">  paste(mean(r1()), mean(r2()))</span></span>
<span id="cb26-362"><a href="#cb26-362" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb26-363"><a href="#cb26-363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-364"><a href="#cb26-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-365"><a href="#cb26-365" aria-hidden="true" tabindex="-1"></a>上のコードでは、<span class="in">`reactive`</span>関数の引数として<span class="in">`input$n1 |&gt; rpois(5)`</span>を取り、<span class="in">`r1`</span>に代入しています。この<span class="in">`r1`</span>は関数オブジェクトになっており、値を呼び出す場合にはカッコを付ける（<span class="in">`r1()`</span>）必要があります。同様に<span class="in">`r2`</span>を<span class="in">`reactive`</span>関数を用いて準備しています。</span>
<span id="cb26-366"><a href="#cb26-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-367"><a href="#cb26-367" aria-hidden="true" tabindex="-1"></a>このようなserver.Rを用いた場合、Shinyの初回起動時にはすべての変数（<span class="in">`r1`</span>、<span class="in">`r2`</span>、<span class="in">`output$output_rpois`</span>）が演算されます。これは<span class="in">`reactive`</span>を用いない場合と同じです。</span>
<span id="cb26-368"><a href="#cb26-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-369"><a href="#cb26-369" aria-hidden="true" tabindex="-1"></a>Shinyアプリの起動後に、<span class="in">`input$n1`</span>を変更した場合には、上記の<span class="in">`reactive`</span>を用いない場合とは演算の経路が異なってきます。<span class="in">`reactive`</span>を用いた場合の演算の経路を以下の図に示します。</span>
<span id="cb26-370"><a href="#cb26-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-371"><a href="#cb26-371" aria-hidden="true" tabindex="-1"></a><span class="al">![](./image/shiny_reactive.png)</span></span>
<span id="cb26-372"><a href="#cb26-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-373"><a href="#cb26-373" aria-hidden="true" tabindex="-1"></a>1、2に関してはobserverの時と同じです。<span class="in">`output$output_rpois`</span>を準備する際に<span class="in">`r2`</span>を読みに行きますが、この際に<span class="in">`r2`</span>が<span class="in">`reactive`</span>で包まれていると、前回演算した時の<span class="in">`r2`</span>（cache）の値を<span class="in">`output$output_rpois`</span>の準備に用いることができ、<span class="in">`r2`</span>を<span class="in">`input$n2`</span>から再演算しなくなります。</span>
<span id="cb26-374"><a href="#cb26-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-375"><a href="#cb26-375" aria-hidden="true" tabindex="-1"></a>上記のような<span class="in">`r1`</span>、<span class="in">`r2`</span>の演算コストの低いShinyアプリでは<span class="in">`reactive`</span>を設定する必要は必ずしもありませんが、<span class="in">`reactive`</span>関数をうまく用いることでよりレスポンスのよいアプリを作成することができるでしょう。</span>
<span id="cb26-376"><a href="#cb26-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-377"><a href="#cb26-377" aria-hidden="true" tabindex="-1"></a><span class="fu">### observeEventとeventReactive</span></span>
<span id="cb26-378"><a href="#cb26-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-379"><a href="#cb26-379" aria-hidden="true" tabindex="-1"></a><span class="fu">#### observeEvent</span></span>
<span id="cb26-380"><a href="#cb26-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-381"><a href="#cb26-381" aria-hidden="true" tabindex="-1"></a><span class="in">`reactive`</span>は比較的使い方を理解しやすいのですが、<span class="in">`observe`</span>は何も返さず、使い方のわからない関数です。これは、<span class="in">`observe`</span>が他の関数を準備するために作成されたprimitiveな（大元の）関数であるためです。<span class="in">`observe`</span>をより分かりやすく、実用的に利用するための関数が<span class="in">`observeEvent`</span>関数です。<span class="in">`observeEvent`</span>関数は第一引数に<span class="in">`input$inputId`</span>、第二引数にスクリプトを取ります。<span class="in">`observeEvent`</span>は主に<span class="in">`actionButton`</span>と共に用い、<span class="in">`actionButton`</span>を押した時に後ろに記載したコード実行されるような場合に用います。<span class="in">`observeEvent`</span>自体は返り値を返さないので、この関数自体を<span class="in">`output$outputId`</span>に代入することはできません。</span>
<span id="cb26-382"><a href="#cb26-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-383"><a href="#cb26-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, filename="server.R: observeEvent関数"}</span></span>
<span id="cb26-384"><a href="#cb26-384" aria-hidden="true" tabindex="-1"></a><span class="in">observeEvent(input$inputButton1, {message("button pressed.")})</span></span>
<span id="cb26-385"><a href="#cb26-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-386"><a href="#cb26-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-387"><a href="#cb26-387" aria-hidden="true" tabindex="-1"></a><span class="fu">#### eventReactive</span></span>
<span id="cb26-388"><a href="#cb26-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-389"><a href="#cb26-389" aria-hidden="true" tabindex="-1"></a>一方で、ボタンを押すなどのイベントによってreactiveに応答を求める時には<span class="in">`eventReactive`</span>を用います。<span class="in">`eventReactive`</span>の返り値は関数オブジェクトで、<span class="in">`reactive`</span>と同じようにカッコをつけることでserver.R内で呼び出すことができます。</span>
<span id="cb26-390"><a href="#cb26-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-391"><a href="#cb26-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, filename="server.R: eventReactive関数"}</span></span>
<span id="cb26-392"><a href="#cb26-392" aria-hidden="true" tabindex="-1"></a><span class="in">buttonpressed &lt;- eventReactive(input$inputButton1, {print("button pressed.")})</span></span>
<span id="cb26-393"><a href="#cb26-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-394"><a href="#cb26-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-395"><a href="#cb26-395" aria-hidden="true" tabindex="-1"></a><span class="fu">### reactiveValとreactiveValue</span></span>
<span id="cb26-396"><a href="#cb26-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-397"><a href="#cb26-397" aria-hidden="true" tabindex="-1"></a><span class="in">`reavtive`</span>の名前がついている関数は他にもあります（<span class="in">`reactiveVal`</span>、<span class="in">`reactiveValue`</span>、<span class="in">`reactiveTimer`</span>）。名前が紛らわしい上にレスポンスが分かりにくい関数群ですが、それぞれに特徴があります。</span>
<span id="cb26-398"><a href="#cb26-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-399"><a href="#cb26-399" aria-hidden="true" tabindex="-1"></a>まず、<span class="in">`reactiveVal`</span>と<span class="in">`reactiveValues`</span>です。この2つは値を記録しておくために用いる関数ですが、<span class="in">`reactive`</span>の特徴（cacheなど）と、**参照渡し**の特徴を持ちます。</span>
<span id="cb26-400"><a href="#cb26-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-401"><a href="#cb26-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, error=TRUE, filename="reactiveValとreactiveValue", eval=FALSE}</span></span>
<span id="cb26-402"><a href="#cb26-402" aria-hidden="true" tabindex="-1"></a><span class="in">x &lt;- y &lt;- reactiveVal(5) # xとyにreactiveVal(5)を代入</span></span>
<span id="cb26-403"><a href="#cb26-403" aria-hidden="true" tabindex="-1"></a><span class="in">x # xは5（Quartoでは演算されない）</span></span>
<span id="cb26-404"><a href="#cb26-404" aria-hidden="true" tabindex="-1"></a><span class="in">y # yも5（Quartoでは演算されない）</span></span>
<span id="cb26-405"><a href="#cb26-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-406"><a href="#cb26-406" aria-hidden="true" tabindex="-1"></a><span class="in">x(10) # xの値を10に更新</span></span>
<span id="cb26-407"><a href="#cb26-407" aria-hidden="true" tabindex="-1"></a><span class="in">x # xは10（Quartoでは演算されない）</span></span>
<span id="cb26-408"><a href="#cb26-408" aria-hidden="true" tabindex="-1"></a><span class="in">y # yも10になる（Quartoでは演算されない）</span></span>
<span id="cb26-409"><a href="#cb26-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-410"><a href="#cb26-410" aria-hidden="true" tabindex="-1"></a><span class="in">z &lt;- reactiveValues(a = 10, b = 15) # reactiveValuesには複数の値を設定できる</span></span>
<span id="cb26-411"><a href="#cb26-411" aria-hidden="true" tabindex="-1"></a><span class="in">z$a # render関数などの中で呼び出さないとエラー</span></span>
<span id="cb26-412"><a href="#cb26-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-413"><a href="#cb26-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-414"><a href="#cb26-414" aria-hidden="true" tabindex="-1"></a>値渡し（Rの変数はほぼすべてこちら）とは異なり、上記の例であれば<span class="in">`x`</span>が変更されると<span class="in">`y`</span>も変更される、参照渡しが行われます。</span>
<span id="cb26-415"><a href="#cb26-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-416"><a href="#cb26-416" aria-hidden="true" tabindex="-1"></a><span class="in">`reactiveVal`</span>は1つの値のみ、<span class="in">`reactiveValues`</span>はリストのように複数の値を保存することができます。<span class="in">`reactiveVal`</span>は通常のRのコンソールでも呼び出すことができますが、<span class="in">`reactiveValues`</span>は<span class="in">`reactive`</span>/observerの中でしか呼び出せません。<span class="in">`reactiveValues`</span>ではリストのように、<span class="in">`$`</span>を用いて値を呼び出します。</span>
<span id="cb26-417"><a href="#cb26-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-418"><a href="#cb26-418" aria-hidden="true" tabindex="-1"></a><span class="in">`reactiveVal`</span>も<span class="in">`reactiveValues`</span>もいまいち使い方が難しい関数ですが、数値を一時的に保存する場合には単なる<span class="in">`reactive`</span>や通常の変数ではなく、こちらを使うことを想定されているのかもしれません。</span>
<span id="cb26-419"><a href="#cb26-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-420"><a href="#cb26-420" aria-hidden="true" tabindex="-1"></a><span class="fu">### reactiveTimerとinvalidatedLater</span></span>
<span id="cb26-421"><a href="#cb26-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-422"><a href="#cb26-422" aria-hidden="true" tabindex="-1"></a>Shinyアプリの作成時には、単にinputに対して応答を求めるようなものだけではなく、一定時間ごとに演算や表示を行ってほしい場合もあります。このように、一定時間ごとに演算を行うような場合には、<span class="in">`reactiveTimer`</span>関数を用います。<span class="in">`reactiveTimer`</span>関数は引数に時間（<span class="in">`intervalMs`</span>、ミリ秒単位）を取ります。<span class="in">`reactiveTimer`</span>関数を用いることで、引数で指定した時間ごとに演算が行われるような仕組みをShinyに持ち込むことができます。</span>
<span id="cb26-423"><a href="#cb26-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-424"><a href="#cb26-424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, filename="reactiveTimer"}</span></span>
<span id="cb26-425"><a href="#cb26-425" aria-hidden="true" tabindex="-1"></a><span class="in">a &lt;- reactiveTimer(2000)</span></span>
<span id="cb26-426"><a href="#cb26-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-427"><a href="#cb26-427" aria-hidden="true" tabindex="-1"></a><span class="in">output$outputId &lt;- renderText({</span></span>
<span id="cb26-428"><a href="#cb26-428" aria-hidden="true" tabindex="-1"></a><span class="in">  a() # reactiveTimerをrender関数内で呼び出す</span></span>
<span id="cb26-429"><a href="#cb26-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-430"><a href="#cb26-430" aria-hidden="true" tabindex="-1"></a><span class="in">  # 2秒ごとに表示される</span></span>
<span id="cb26-431"><a href="#cb26-431" aria-hidden="true" tabindex="-1"></a><span class="in">  paste0("Hello world, ", input$inputId, "! ", Sys.time()) </span></span>
<span id="cb26-432"><a href="#cb26-432" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb26-433"><a href="#cb26-433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-434"><a href="#cb26-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-435"><a href="#cb26-435" aria-hidden="true" tabindex="-1"></a>上記の例では、<span class="in">`input$inputId`</span>の変更が<span class="in">`output$outputId`</span>の更新を引き起こさず、2秒（2000ミリ秒）おきに<span class="in">`output$outputId`</span>が更新されるようになります。この<span class="in">`reactiveTimer`</span>と類似した関数として、<span class="in">`invalidateLater`</span>関数があります。<span class="in">`invalidateLater`</span>関数は<span class="in">`reactiveTimer`</span>と同じく初期のShinyから実装されている関数で、より安全でシンプルな関数であるとされています。<span class="in">`invalidateLater`</span>関数は直接<span class="in">`render`</span>関数内に書いて用います。ですので、上のコードと同じ演算を以下のような形で実装することができます。</span>
<span id="cb26-436"><a href="#cb26-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-437"><a href="#cb26-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, filename="invalidatedLater"}</span></span>
<span id="cb26-438"><a href="#cb26-438" aria-hidden="true" tabindex="-1"></a><span class="in">output$outputId &lt;- renderText({</span></span>
<span id="cb26-439"><a href="#cb26-439" aria-hidden="true" tabindex="-1"></a><span class="in">  invalidatedLater(2000)</span></span>
<span id="cb26-440"><a href="#cb26-440" aria-hidden="true" tabindex="-1"></a><span class="in">  paste0("Hello world, ", input$inputId, "! ", Sys.time())</span></span>
<span id="cb26-441"><a href="#cb26-441" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb26-442"><a href="#cb26-442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-443"><a href="#cb26-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-444"><a href="#cb26-444" aria-hidden="true" tabindex="-1"></a><span class="fu">## app.R</span></span>
<span id="cb26-445"><a href="#cb26-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-446"><a href="#cb26-446" aria-hidden="true" tabindex="-1"></a>ココまではShinyアプリをui.R、server.Rの2つのファイルで開発する方法について説明してきました。複雑なShinyアプリを作成したい場合には、この2つのファイルを用いる方法が有効です。一方で、小規模のアプリを作る場合には2つのファイルを行き来するのが煩雑となる場合もあります。小規模アプリの開発では、app.Rという1つのファイルでShinyアプリを作成することもできます。</span>
<span id="cb26-447"><a href="#cb26-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-448"><a href="#cb26-448" aria-hidden="true" tabindex="-1"></a>app.Rを準備する場合には、上記の図2に示したファイル作成のウインドウで、「Single file (app.R)」を選択します。</span>
<span id="cb26-449"><a href="#cb26-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-450"><a href="#cb26-450" aria-hidden="true" tabindex="-1"></a><span class="al">![図10：Shinyのファイルを作成する](./image/newfile_shiny2.png)</span></span>
<span id="cb26-451"><a href="#cb26-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-452"><a href="#cb26-452" aria-hidden="true" tabindex="-1"></a>app.Rを作成すると、以下のように1ファイル内に<span class="in">`ui`</span>と<span class="in">`server`</span>が記載されたファイルが表示されます。<span class="in">`ui`</span>には<span class="in">`fluidPage`</span>や<span class="in">`fixedPage`</span>、<span class="in">`TabsetPanel`</span>から始まるレイアウトを代入し、この中身にuiのレイアウト、<span class="in">`input`</span>、<span class="in">`Output`</span>等を記載していきます。</span>
<span id="cb26-453"><a href="#cb26-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-454"><a href="#cb26-454" aria-hidden="true" tabindex="-1"></a><span class="in">`server`</span>には、server.Rと同様に<span class="in">`function(input, output)`</span>を代入し、<span class="in">`function`</span>の<span class="in">`{}`</span>の中に実行したいコードを記載していきます。</span>
<span id="cb26-455"><a href="#cb26-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-456"><a href="#cb26-456" aria-hidden="true" tabindex="-1"></a>最後の<span class="in">`shinyApp(ui=ui, server=server)`</span>はShinyアプリを実行するための関数です。ですので、app.Rでもui.R/server.Rでも、uiとserverの中身を作成していくことには違いはありません。</span>
<span id="cb26-457"><a href="#cb26-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-458"><a href="#cb26-458" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, filename="app.Rの構成"}</span></span>
<span id="cb26-459"><a href="#cb26-459" aria-hidden="true" tabindex="-1"></a><span class="in">ui &lt;- fluidPage(</span></span>
<span id="cb26-460"><a href="#cb26-460" aria-hidden="true" tabindex="-1"></a><span class="in">  # ....コードを記載....</span></span>
<span id="cb26-461"><a href="#cb26-461" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb26-462"><a href="#cb26-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-463"><a href="#cb26-463" aria-hidden="true" tabindex="-1"></a><span class="in">server &lt;- function(input, output){</span></span>
<span id="cb26-464"><a href="#cb26-464" aria-hidden="true" tabindex="-1"></a><span class="in">  # .....コードを記載....</span></span>
<span id="cb26-465"><a href="#cb26-465" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb26-466"><a href="#cb26-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-467"><a href="#cb26-467" aria-hidden="true" tabindex="-1"></a><span class="in">shinyApp(ui = ui, server = server)</span></span>
<span id="cb26-468"><a href="#cb26-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-469"><a href="#cb26-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-470"><a href="#cb26-470" aria-hidden="true" tabindex="-1"></a><span class="fu">## Shinyに機能を追加する（Extensions）</span></span>
<span id="cb26-471"><a href="#cb26-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-472"><a href="#cb26-472" aria-hidden="true" tabindex="-1"></a>Shinyには、上記の<span class="in">`layout`</span>、<span class="in">`Input`</span>、<span class="in">`Output`</span>、<span class="in">`render`</span>などの基本的な関数だけでなく、追加の機能を与えるためのライブラリ（Extensions）が豊富に存在します。以下に代表的なExtensionsの例を示します。</span>
<span id="cb26-473"><a href="#cb26-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-474"><a href="#cb26-474" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">shinythemes</span><span class="co">](https://rstudio.github.io/shinythemes/)[</span><span class="ot">@shinythemes_bib</span><span class="co">]</span></span>
<span id="cb26-475"><a href="#cb26-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-476"><a href="#cb26-476" aria-hidden="true" tabindex="-1"></a>ShinyのデザインをBootstrapに従って変更するためのライブラリです。</span>
<span id="cb26-477"><a href="#cb26-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-478"><a href="#cb26-478" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">shinydashboard</span><span class="co">](https://rstudio.github.io/shinydashboard/)[</span><span class="ot">@shinydashboard_bib</span><span class="co">]</span></span>
<span id="cb26-479"><a href="#cb26-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-480"><a href="#cb26-480" aria-hidden="true" tabindex="-1"></a>Shinyで<span class="co">[</span><span class="ot">ダッシュボード</span><span class="co">](https://www.google.com/search?sca_esv=a526368c5945871d&amp;sxsrf=ADLYWIK4gJvNmzBBQh-pQzFeWnI_SKxx2A:1724140556539&amp;q=%E3%83%87%E3%82%B8%E3%82%BF%E3%83%AB%E3%83%80%E3%83%83%E3%82%B7%E3%83%A5%E3%83%9C%E3%83%BC%E3%83%89&amp;udm=2&amp;fbs=AEQNm0BqbPbAzSj6PhNr7nv9Ltx-oFh8tVsgXi1MyFbswNtTUOS5b68chsyOj2QEdx4EPnNHj-rfVa2Eb1VCscGX2ZUj9zg7pD9WhuxXJAj12GW6oeBqw4eGvVgzQxyKznl1ExGJi168qSx2eeXjUNvCmZhFwSaQtcsiZCK7bt8rXXw1KNDgJdghBt7mcicHH5U9gHGYPNgxAD0CsYaK3uh78b4Yn_p-W815iG5byNmUmiBRo1Utr2Q&amp;sa=X&amp;ved=2ahUKEwjP16iLjIOIAxXSslYBHSrNMxYQtKgLegQIGRAB&amp;biw=1912&amp;bih=970&amp;dpr=1)</span>を簡単に作成するためのライブラリです。基本的にはShinyにダッシュボード用のレイアウト関数を追加するライブラリとなっています。</span>
<span id="cb26-481"><a href="#cb26-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-482"><a href="#cb26-482" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">bslib</span><span class="co">](https://rstudio.github.io/bslib/)[</span><span class="ot">@bslib_bib</span><span class="co">]</span></span>
<span id="cb26-483"><a href="#cb26-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-484"><a href="#cb26-484" aria-hidden="true" tabindex="-1"></a><span class="in">`shinythemes`</span>と同様にShinyのデザインを変更するためのライブラリです。こちらは<span class="co">[</span><span class="ot">前章</span><span class="co">](./chapter34.html)</span>で紹介したR markdown・QuartoのHTML出力のデザインを変更することもできます。また、レイアウトの関数をいくつか備えており、これらのレイアウト関数を用いることでダッシュボードを作成することもできます。<span class="in">`shinythemes`</span>と<span class="in">`shinydashboard`</span>はかなり前に開発されたライブラリであるため、この<span class="in">`bslib`</span>に統合されたような形となっているようです。デザイン性の高いShinyアプリを作成するのであれば、まずこのライブラリを用いることを検討するのがよいでしょう。</span>
<span id="cb26-485"><a href="#cb26-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-486"><a href="#cb26-486" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">DT</span><span class="co">](https://rstudio.github.io/DT/)[</span><span class="ot">@DT_bib</span><span class="co">]</span></span>
<span id="cb26-487"><a href="#cb26-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-488"><a href="#cb26-488" aria-hidden="true" tabindex="-1"></a>ShinyやR markdownにJavascript製の表を表示するためのライブラリです。Javascriptで開発され、用いられている<span class="co">[</span><span class="ot">DataTables</span><span class="co">](https://datatables.net/)</span>というライブラリをRに持ち込んだものです。Shinyで用いるための専用の<span class="in">`Output`</span>、<span class="in">`render`</span>関数を備えています。</span>
<span id="cb26-489"><a href="#cb26-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-490"><a href="#cb26-490" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">shinycssloaders</span><span class="co">](https://daattali.com/shiny/shinycssloaders-demo/)[</span><span class="ot">@shinycssloaders_bib</span><span class="co">]</span></span>
<span id="cb26-491"><a href="#cb26-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-492"><a href="#cb26-492" aria-hidden="true" tabindex="-1"></a>Shinyにデータを演算中（ローディング中）であることを示すアニメーションを追加するためのライブラリです。計算が重めのShinyを作成する際に用いるとよいでしょう。</span>
<span id="cb26-493"><a href="#cb26-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-494"><a href="#cb26-494" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">shinymanager</span><span class="co">](https://datastorm-open.github.io/shinymanager/)[</span><span class="ot">@shinymanager_bib</span><span class="co">]</span></span>
<span id="cb26-495"><a href="#cb26-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-496"><a href="#cb26-496" aria-hidden="true" tabindex="-1"></a>ShinyにIDとパスワードによるログイン機構を追加するためのライブラリです。セキュリティ的には怪しいので、あまり信用はできませんが、社内のシステムで用いるぐらいなら耐えられるかもしれません。</span>
<span id="cb26-497"><a href="#cb26-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-498"><a href="#cb26-498" aria-hidden="true" tabindex="-1"></a>Shinyにはこの他にもたくさんのExtensionsが存在します。この<span class="co">[</span><span class="ot">Githubのページ</span><span class="co">](https://github.com/nanxstats/awesome-shiny-extensions)</span>に一覧が示されていますので、参考にされるとよいでしょう。</span>
<span id="cb26-499"><a href="#cb26-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-500"><a href="#cb26-500" aria-hidden="true" tabindex="-1"></a>また、Shinyの開発を行っている企業である<span class="co">[</span><span class="ot">appsilon</span><span class="co">](https://www.appsilon.com/)</span>は、Shiny開発のフレームワークやデザインに関するライブラリを多数開発しています。ハイエンドなShinyアプリを開発したいのであればチャレンジする価値があるかと思います。</span>
<span id="cb26-501"><a href="#cb26-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-502"><a href="#cb26-502" aria-hidden="true" tabindex="-1"></a><span class="fu">## アプリをデプロイする</span></span>
<span id="cb26-503"><a href="#cb26-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-504"><a href="#cb26-504" aria-hidden="true" tabindex="-1"></a>Shinyアプリを作成したら、他の人に使ってもらってデータを共有・説明したいはずです。Shinyアプリを自分のPCで動かすだけであれば、Rから実行するのが最も簡単ですが、Webを通じてShinyアプリを公表したい場合には、アプリを**デプロイ**する必要があります。</span>
<span id="cb26-505"><a href="#cb26-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-506"><a href="#cb26-506" aria-hidden="true" tabindex="-1"></a>デプロイとは、インターネットでアクセスできるPC（Webサーバー）にWebアプリを実行する環境を整えることを指します。我々が使っている多くのWebサービス（Webアプリ）は、<span class="co">[</span><span class="ot">Amazon Web Services（AWS）</span><span class="co">](https://aws.amazon.com/jp/)</span>や<span class="co">[</span><span class="ot">Google Cloud</span><span class="co">](https://cloud.google.com/)</span>などのWebサーバーで実行されています。Shinyアプリも同様にWebサーバーにデプロイすることで、Webブラウザからアクセスし、利用することができます。</span>
<span id="cb26-507"><a href="#cb26-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-508"><a href="#cb26-508" aria-hidden="true" tabindex="-1"></a>Shinyの開発元であるPositはShinyアプリを簡単にデプロイするサービスである、<span class="co">[</span><span class="ot">shinyapps.io</span><span class="co">](https://www.shinyapps.io/)</span>や<span class="co">[</span><span class="ot">Posit Connect</span><span class="co">](https://posit.co/products/enterprise/connect/)</span>を展開しています。また、同じくPositが開発した<span class="co">[</span><span class="ot">Shiny server</span><span class="co">](https://posit.co/products/open-source/shinyserver/)</span>を用いることで、AWSやGoogle Cloudに比較的簡単にデプロイすることができます。</span>
<span id="cb26-509"><a href="#cb26-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-510"><a href="#cb26-510" aria-hidden="true" tabindex="-1"></a>Posit Connectはエンタープライズ版で、セキュリティ面などがしっかりしています。一方で価格が相当高いので（今は公開されていませんが、昔は$5000/monthぐらいからだったと思います）、個人で安価にデプロイしたいのであればShinyapps.ioかShiny serverの2択となります。</span>
<span id="cb26-511"><a href="#cb26-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-512"><a href="#cb26-512" aria-hidden="true" tabindex="-1"></a><span class="fu">### shinyapps.io</span></span>
<span id="cb26-513"><a href="#cb26-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-514"><a href="#cb26-514" aria-hidden="true" tabindex="-1"></a>最も簡単に、無料、もしくは安価にShinyアプリを公開したいのであれば、**Shinyapps.io**を用いるのがよいでしょう。Shinyapps.ioを用いるためには、まずShinyapps.ioのホームページ上でアカウントを作成する必要があります。<span class="co">[</span><span class="ot">shinyapps.io</span><span class="co">](https://www.shinyapps.io/)</span>に移動し、「sign up」からアカウントを作成しましょう。shinyapps.ioのアカウントを作らずに、Googleやfacebookのアカウントを用いてログインすることもできます。</span>
<span id="cb26-515"><a href="#cb26-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-516"><a href="#cb26-516" aria-hidden="true" tabindex="-1"></a><span class="al">![](./image/shinyappsio.png)</span></span>
<span id="cb26-517"><a href="#cb26-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-518"><a href="#cb26-518" aria-hidden="true" tabindex="-1"></a>アカウントが作成できたら、Rstudio上で、エディタの右上にある「Publish」のボタンをクリックします。</span>
<span id="cb26-519"><a href="#cb26-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-520"><a href="#cb26-520" aria-hidden="true" tabindex="-1"></a><span class="al">![図：Publishボタン](./image/publish_button.png)</span></span>
<span id="cb26-521"><a href="#cb26-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-522"><a href="#cb26-522" aria-hidden="true" tabindex="-1"></a>publishボタンを押すと、初回には2つのライブラリ（<span class="in">`packrat`</span><span class="co">[</span><span class="ot">@packrat_bib</span><span class="co">]</span>と<span class="in">`rsconnect`</span><span class="co">[</span><span class="ot">@rsconnect_bib</span><span class="co">]</span>）のインストールが求められますので、RStudioの指示に従いライブラリをインストールします。</span>
<span id="cb26-523"><a href="#cb26-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-524"><a href="#cb26-524" aria-hidden="true" tabindex="-1"></a>次に、接続するアカウントの種類を選択するウインドウが表示されますので、「shinyapps.io」を選択します。</span>
<span id="cb26-525"><a href="#cb26-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-526"><a href="#cb26-526" aria-hidden="true" tabindex="-1"></a><span class="al">![図：サービスの選択画面](./image/select_connectAccount.png)</span></span>
<span id="cb26-527"><a href="#cb26-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-528"><a href="#cb26-528" aria-hidden="true" tabindex="-1"></a>shinyapps.ioを選択すると、Tokenを入力するよう指示が出ますので、<span class="co">[</span><span class="ot">shinyapps.io</span><span class="co">](https://www.shinyapps.io/)</span>にログインし、アカウント名が表示されている部分からTokenを表示、コピーして貼り付けます。</span>
<span id="cb26-529"><a href="#cb26-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-530"><a href="#cb26-530" aria-hidden="true" tabindex="-1"></a><span class="al">![図：Tokenを貼り付ける](./image/connect_shinyapps_account.png)</span></span>
<span id="cb26-531"><a href="#cb26-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-532"><a href="#cb26-532" aria-hidden="true" tabindex="-1"></a>Tokenを貼り付け、Connect Accountを選択すると、shinyapps.ioのアカウントとRStudioが繋がり、簡単にShinyアプリをデプロイできるようになります。</span>
<span id="cb26-533"><a href="#cb26-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-534"><a href="#cb26-534" aria-hidden="true" tabindex="-1"></a>この状態で再び「Publish」をクリックすると、下のようなダイアログが表示されます。Publishポタンを押せばデプロイは完了です。</span>
<span id="cb26-535"><a href="#cb26-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-536"><a href="#cb26-536" aria-hidden="true" tabindex="-1"></a><span class="al">![図：PublishでShinyapps.ioにデプロイする](./image/publish_shinyapp.png)</span></span>
<span id="cb26-537"><a href="#cb26-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-538"><a href="#cb26-538" aria-hidden="true" tabindex="-1"></a>Publishした後にWebブラウザからshinyapps.ioにログインすると、以下のようなページが表示されます。Publishしたアプリのリストが表示されていますので、以下の図の赤枠の部分をクリックするとアプリを起動することができます。</span>
<span id="cb26-539"><a href="#cb26-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-540"><a href="#cb26-540" aria-hidden="true" tabindex="-1"></a><span class="al">![図：アプリケーションの起動](./image/shinyappsio_applist.png)</span></span>
<span id="cb26-541"><a href="#cb26-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-542"><a href="#cb26-542" aria-hidden="true" tabindex="-1"></a>この方法で実行したShinyアプリはローカル（自分のPC）で演算するのではなく、Positが管理しているWebサーバでアプリを実行するようになっています。URLをコピーし、共有したい人にアクセスしてもらうことでShinyアプリをWeb上で実行してもらうことができます。</span>
<span id="cb26-543"><a href="#cb26-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-544"><a href="#cb26-544" aria-hidden="true" tabindex="-1"></a><span class="fu">### shiny server</span></span>
<span id="cb26-545"><a href="#cb26-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-546"><a href="#cb26-546" aria-hidden="true" tabindex="-1"></a>上記のshinyapps.ioを用いる方法は非常に簡単で、お金もかかりませんが、一方で演算速度は遅く、たくさんの人が同時に接続することもできません。また、月あたりの使用時間が制限されています。shinyapps.ioは基本的にすべての人にShinyアプリを公開する形でデプロイするため、秘密情報を含むShinyアプリに利用するのにも向いていません。</span>
<span id="cb26-547"><a href="#cb26-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-548"><a href="#cb26-548" aria-hidden="true" tabindex="-1"></a>このようなサーバーの速度・接続時間・秘密情報の問題を解決するには、自前でWebサーバーを立ち上げ、管理する必要があります。自前でサーバーを立ち上げるには、個人や会社のサーバーを利用する方法とWebサーバー（Amazon Web ServicesやGoogle Cloud）を用いる方法がありますが、いずれの方法においてもShinyアプリのデプロイには<span class="co">[</span><span class="ot">Shiny server</span><span class="co">](https://posit.co/products/open-source/shiny-server/)</span>を用いるのが一般的です。Shiny serverを用いたShinyアプリのデプロイには<span class="co">[</span><span class="ot">コンテナ</span><span class="co">](https://ja.wikipedia.org/wiki/Docker)</span>を用いることが多いかと思います。Shiny server、コンテナやコンテナを用いたデプロイの方法はこの入門書の範囲を超えてしまいますので、<span class="co">[</span><span class="ot">こちらの記事</span><span class="co">](https://qiita.com/amori/items/425e44d6a7c1e0fbec84)</span>や<span class="co">[</span><span class="ot">この記事</span><span class="co">](https://qiita.com/xjorv/items/947ca01b45d6207bc4e3)</span>などを参照下さい。</span>
<span id="cb26-549"><a href="#cb26-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-550"><a href="#cb26-550" aria-hidden="true" tabindex="-1"></a><span class="fu">### GitHubで共有する</span></span>
<span id="cb26-551"><a href="#cb26-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-552"><a href="#cb26-552" aria-hidden="true" tabindex="-1"></a>上記の方法では、Webサーバーを用いてRでの演算をしており、自分のPC（ローカル）では演算を行いません。Webサーバーを用いる方法では、サーバーを借りる必要があり、お金がかかります。サーバーを借りず、アプリを使用する方のPCで直接Shinyアプリを実行する方法であれば、このようなサーバーを準備する必要はありません。</span>
<span id="cb26-553"><a href="#cb26-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-554"><a href="#cb26-554" aria-hidden="true" tabindex="-1"></a>Shinyのコードだけを準備して、アプリを使用する方のPCでShinyアプリを実行する場合には、<span class="co">[</span><span class="ot">GitHub</span><span class="co">](https://github.com/)</span>を用いるのが簡単です。GitHubは<span class="co">[</span><span class="ot">Git</span><span class="co">](https://git-scm.com/)</span>と呼ばれるバージョン管理システムのうち、<span class="co">[</span><span class="ot">リモートレポシトリ</span><span class="co">](https://ja.wikipedia.org/wiki/%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA)</span>と呼ばれるものを取り扱うWebサービスです。GitHubには公開・非公開のリモートレポジトリが多数登録されており、他者とコードを共有してプログラミングを行う際の重要なツールとなっています。</span>
<span id="cb26-555"><a href="#cb26-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-556"><a href="#cb26-556" aria-hidden="true" tabindex="-1"></a>GitやGitHubの詳しい説明は<span class="co">[</span><span class="ot">他の参考資料</span><span class="co">](https://backlog.com/ja/git-tutorial/)</span>をご参照下さい。</span>
<span id="cb26-557"><a href="#cb26-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-558"><a href="#cb26-558" aria-hidden="true" tabindex="-1"></a>GitHubでは通常Gitのシステムを用いて、リモートレポジトリを作成・更新・アップロードするようにできていますが、Shinyアプリを共有する場合には、直接GitHubにコードを書き込んでも問題はありません。</span>
<span id="cb26-559"><a href="#cb26-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-560"><a href="#cb26-560" aria-hidden="true" tabindex="-1"></a>GitHubにShinyアプリのコードを登録すると、<span class="in">`Shiny::runGitHub`</span>関数でそのアプリを実行できるようになります。この章の一番始めに紹介した以下のコードは、この<span class="in">`runGitHub`</span>関数を用いてShinyアプリを実行するものとなっています。</span>
<span id="cb26-561"><a href="#cb26-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-562"><a href="#cb26-562" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="runGitHub関数", eval=FALSE}</span></span>
<span id="cb26-563"><a href="#cb26-563" aria-hidden="true" tabindex="-1"></a><span class="in">if(!require(shiny)) install.packages(("shiny")) # shinyの読み込み</span></span>
<span id="cb26-564"><a href="#cb26-564" aria-hidden="true" tabindex="-1"></a><span class="in">shiny::runGitHub("surv_sim", "sb8001at") # runGitHub関数で"surv_sim"というレポジトリのアプリを読み込み、実行</span></span>
<span id="cb26-565"><a href="#cb26-565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-566"><a href="#cb26-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-567"><a href="#cb26-567" aria-hidden="true" tabindex="-1"></a>上記の例では、<span class="in">`"sb8001at"`</span>というアカウントのGitHubのレポジトリである<span class="in">`"surv_sim"`</span>を読み込み、Rで実行させるためのコードです。GitHubではこのようなレポジトリを通常<span class="in">`sb8001at/surv_sim`</span>という形で表現します。このレポジトリは公開されているもので、<span class="co">[</span><span class="ot">このページ</span><span class="co">](https://github.com/sb8001at/surv_sim)</span>でコードを確認することができます。</span>
<span id="cb26-568"><a href="#cb26-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-569"><a href="#cb26-569" aria-hidden="true" tabindex="-1"></a><span class="al">![](./image/github_repo.png)</span></span>
<span id="cb26-570"><a href="#cb26-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-571"><a href="#cb26-571" aria-hidden="true" tabindex="-1"></a>上記ページの「ui.R」を選択すると、以下のようにui.Rのコードを読むことができます。</span>
<span id="cb26-572"><a href="#cb26-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-573"><a href="#cb26-573" aria-hidden="true" tabindex="-1"></a><span class="al">![](./image/github_uiR.png)</span></span>
<span id="cb26-574"><a href="#cb26-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-575"><a href="#cb26-575" aria-hidden="true" tabindex="-1"></a>上記の<span class="in">`runGitHub`</span>関数はこのページのui.R、server.R、global.Rを読み込み、Shinyアプリを実行する関数です。GitHubでのアカウント作成・レポジトリの準備やコードの入力方法に関しては、この教科書の範囲から外れるためココでは詳細を説明しませんので、<span class="co">[</span><span class="ot">この記事</span><span class="co">](https://yoshitaku-jp.hatenablog.com/entry/2018/07/07/225642)</span>などを参考にしていただければと思います。</span>
<span id="cb26-576"><a href="#cb26-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-577"><a href="#cb26-577" aria-hidden="true" tabindex="-1"></a>最後に、Shinyアプリで用いられるUI、Serverのコードと実行時のページをイメージするためのShinyアプリを以下に示します。以下のコードをコピペしてRで実行していただければ、UIやServerのイメージがつかみやすいかと思います。</span>
<span id="cb26-578"><a href="#cb26-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-579"><a href="#cb26-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, filename="Shinyのサンプルアプリ", eval=FALSE}</span></span>
<span id="cb26-580"><a href="#cb26-580" aria-hidden="true" tabindex="-1"></a><span class="in">if(!require(shiny)) install.packages(("shiny")) # shinyの読み込み</span></span>
<span id="cb26-581"><a href="#cb26-581" aria-hidden="true" tabindex="-1"></a><span class="in">shiny::runGitHub("shiny_sample", "sb8001at")</span></span>
<span id="cb26-582"><a href="#cb26-582" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><a href="https://quarto.org/">Quarto</a>を用いてこの本を作成しました</p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","selector":".lightbox","loop":false,"descPosition":"bottom","openEffect":"zoom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




</body></html>